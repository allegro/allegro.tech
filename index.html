<!DOCTYPE html><html lang="pl"><head><meta charSet="utf-8"/><link rel="prefetch" href="https://allegrotechio.disqus.com/count.js"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="description" content="Allegro Tech to miejsce, w którym nasi inżynierowie dzielą się wiedzą oraz case study z wybranych projektów w firmie - w formie artykułów, podcastów oraz eventów."/><title>Allegro Tech</title><meta property="og:site_name" content="allegro.tech"/><meta property="og:title" content="allegro.tech"/><meta property="og:url" content="https://allegro.tech"/><meta property="og:type" content="site"/><meta property="og:image" content="https://allegro.tech/images/allegro-tech.png"/><link rel="shortcut icon" href="favicon.ico"/><link rel="canonical" href="https://allegro.tech" itemProp="url"/><link rel="preload" href="images/splash.jpg" as="image"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1M1FJ5PXWW"></script><script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    gtag('js', new Date());
                    gtag('config', 'G-1M1FJ5PXWW');
                </script><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/66933eaa547aae51.css" as="style"/><link rel="stylesheet" href="/_next/static/css/66933eaa547aae51.css" data-n-g=""/><link rel="preload" href="/_next/static/css/79db8b1e27b0a093.css" as="style"/><link rel="stylesheet" href="/_next/static/css/79db8b1e27b0a093.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-6e4ba497ae0c8a3f.js" defer=""></script><script src="/_next/static/chunks/main-5db96132b59ddfd8.js" defer=""></script><script src="/_next/static/chunks/pages/_app-179adf437ae674f2.js" defer=""></script><script src="/_next/static/chunks/206-77505f9d798e66aa.js" defer=""></script><script src="/_next/static/chunks/pages/index-f037c91132ed6a0a.js" defer=""></script><script src="/_next/static/7NeFYoooUiLSluflm6XKZ/_buildManifest.js" defer=""></script><script src="/_next/static/7NeFYoooUiLSluflm6XKZ/_ssgManifest.js" defer=""></script><script src="/_next/static/7NeFYoooUiLSluflm6XKZ/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><header class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card Header_navbar__Zc5aN m-color-bg_card"><nav class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-display-flex m-flex-justify-between m-flex-items-center"><a href="/"><img src="images/logo.svg" alt="Allegro Tech" width="205" height="45"/></a><div><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0 m-display-flex@lg m-display-none"><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://blog.allegro.tech">Blog</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://ml.allegro.tech">Machine Learning</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://podcast.allegro.tech">Podcast</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://github.com/Allegro">Open Source</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://www.meetup.com/allegrotech/events">Wydarzenia</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://praca.allegro.pl">Praca</a></li></ul><button class="m-display-none@lg m-height_40 m-line-height_40 m-border-style-top_none m-border-style-right_none m-border-style-bottom_none m-border-style-left_none m-border-radius-top-left_2 m-border-radius-top-right_2 m-border-radius-bottom-left_2 m-border-radius-bottom-right_2 m-cursor_pointer m-overflow_hidden m-appearance_none m-padding-left_4 m-padding-right_4 m-padding-top_4 m-padding-bottom_4 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button" style="background:transparent" aria-label="Otwórz menu"><img src="https://assets.allegrostatic.com/metrum/icon/menu-23e046bf68.svg" alt="" class="m-icon" width="32" height="32"/></button></div></nav></header><div class="Header_hero__PYE0B"><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-display-flex m-flex-column m-flex-justify-end Header_image__Cj6ZF"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-color-bg_desk"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text  m-font-weight_100 m-font-size_32 m-font-size_43_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125">O nas</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Allegro to jedna z najbardziej zaawansowanych technologicznie firm w naszej części Europy. Allegro to również ponad 1000 specjalistów IT, różnych specjalizacji, rozwijających nasz serwis. Unikatowa skala i złożoność problemów, które rozwiązujemy na co dzień, dają nam możliwość rozwoju przy bardzo różnorodnych projektach. Allegro Tech to miejsce, w którym nasi inżynierowie dzielą się wiedzą oraz case study z wybranych projektów w firmie – w formie artykułów, podcastów oraz eventów.</p></div></div></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Blog</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2022/02/why-we-should-rewrite-enzymejs-to-rtl-and-how-to-do-that.html" title="Why should we rewrite enzyme.js to react-testing-library and how to do that?"><img width="388" src="images/post-headers/javascript.png" alt="Why should we rewrite enzyme.js to react-testing-library and how to do that?" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2022/02/why-we-should-rewrite-enzymejs-to-rtl-and-how-to-do-that.html" title="Why should we rewrite enzyme.js to react-testing-library and how to do that?" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Why should we rewrite enzyme.js to react-testing-library and how to do that?</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">12 dni temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/tech">#<!-- -->tech</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/frontend">#<!-- -->frontend</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/javascript">#<!-- -->javascript</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/jest">#<!-- -->jest</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/enzyme">#<!-- -->enzyme</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/react-testing-library">#<!-- -->react-testing-library</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/rtl">#<!-- -->rtl</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/react">#<!-- -->react</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">Everyone repeats like a mantra that tests are an indispensable element of development work. Is there anything to it?
Well, I need to admit that as…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__FHMgb"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Magdalena Mazur" src="https://blog.allegro.tech/img/authors/magdalena.mazur.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/magdalena.mazur">Magdalena Mazur</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2022/02/why-we-should-rewrite-enzymejs-to-rtl-and-how-to-do-that.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2022/02/why-we-should-rewrite-enzymejs-to-rtl-and-how-to-do-that.html">przejdź do wpisu</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2022/01/how-do-coroutines-work-internally-in-python.html" title="How do coroutines work internally in Python?"><img width="388" src="images/post-headers/python.png" alt="How do coroutines work internally in Python?" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2022/01/how-do-coroutines-work-internally-in-python.html" title="How do coroutines work internally in Python?" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">How do coroutines work internally in Python?</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">29 dni temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/tech">#<!-- -->tech</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/python">#<!-- -->python</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/async">#<!-- -->async</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/coroutines">#<!-- -->coroutines</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">Most of applications we create are basically loops. An average program waits
for an event, then processes it following some business logic. Afterwards it
begins waiting for…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__FHMgb"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Tomasz Szewczyk" src="https://blog.allegro.tech/img/authors/tomasz.szewczyk.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/tomasz.szewczyk">Tomasz Szewczyk</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2022/01/how-do-coroutines-work-internally-in-python.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2022/01/how-do-coroutines-work-internally-in-python.html">przejdź do wpisu</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2022/01/shrinking-size-of-monorepo.html" title="Shrinking the size of a monorepo"><img width="388" src="images/post-headers/ios.png" alt="Shrinking the size of a monorepo" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2022/01/shrinking-size-of-monorepo.html" title="Shrinking the size of a monorepo" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Shrinking the size of a monorepo</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">około miesiąc temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/tech">#<!-- -->tech</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/ios">#<!-- -->ios</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/git">#<!-- -->git</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/mobile">#<!-- -->mobile</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/swift">#<!-- -->swift</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/objectivec">#<!-- -->objectivec</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">The source code of Allegro iOS app for buyers used to be divided into separate modules hosted in multiple repositories
(polyrepo). The
source code was migrated to…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__FHMgb"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Maciej Piotrowski" src="https://blog.allegro.tech/img/authors/maciej.piotrowski.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/maciej.piotrowski">Maciej Piotrowski</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2022/01/shrinking-size-of-monorepo.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2022/01/shrinking-size-of-monorepo.html">przejdź do wpisu</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2021/12/performance-evaluation-of-timeseries.html" title="Evaluating performance of time series collections"><img width="388" src="images/post-headers/mongodb.png" alt="Evaluating performance of time series collections" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2021/12/performance-evaluation-of-timeseries.html" title="Evaluating performance of time series collections" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Evaluating performance of time series collections</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">2 miesiące temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/tech">#<!-- -->tech</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/mongodb">#<!-- -->mongodb</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/performance">#<!-- -->performance</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/time series">#<!-- -->time series</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">A few years ago, I was working on a new version of Allegro purchase ratings.
It was a time of a pretty large revolution in the…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__FHMgb"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Michał Knasiecki" src="https://blog.allegro.tech/img/authors/michal.knasiecki.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/michal.knasiecki">Michał Knasiecki</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2021/12/performance-evaluation-of-timeseries.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2021/12/performance-evaluation-of-timeseries.html">przejdź do wpisu</a></div></article></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech">Zobacz więcej wpisów</a></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Podcasty</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/rola_architekta_w_allegro/" title="S02E12 - Piotr Betkier - Rola architekta w Allegro"><img src="images/podcast.png" alt="S02E12 - Piotr Betkier - Rola architekta w Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/rola_architekta_w_allegro/" title="S02E12 - Piotr Betkier - Rola architekta w Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">S02E12 - Piotr Betkier - Rola architekta w Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">8 miesięcy temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Od kodowania do tworzenia strategii technicznej... Jak wygląda rola architekta w Allegro? Ile takich osób pracuje w naszej firmie i dlaczego ta rola jest tak różnorodna? Czym jest Andamio i jak rozwijamy naszą platformę – o tym wszystkim opowie Piotr Betkier – Inżynier, Architekt Platformy Technicznej w Allegro oraz twórca piosenek o IT :)</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/rola_architekta_w_allegro/">Posłuchaj odcinka</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/infrastruktura_Allegro/" title="S02E11 - Piotr Michoński - Infrastruktura Allegro"><img src="images/podcast.png" alt="S02E11 - Piotr Michoński - Infrastruktura Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/infrastruktura_Allegro/" title="S02E11 - Piotr Michoński - Infrastruktura Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">S02E11 - Piotr Michoński - Infrastruktura Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">9 miesięcy temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Jak jest zbudowane środowisko uruchomienia aplikacji Allegro? Jak działają serwerownie firmy i ile ich potrzeba, a które elementy Allegro działają w chmurze publicznej? Jak przebiegała transformacja w Allegro i co zmieniało się przez lata? Jak wzrost biznesu wpływa na wielkość infrastruktury i jak infrastruktura Allegro odczuła przyjście pandemii? O tym, a także o rozwoju liderów technologii w Allegro oraz o historii powstania dżingla do naszych podcastów, opowie Piotr Michoński - menadżer Zespołów tworzących infrastrukturę Allegro.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/infrastruktura_Allegro/">Posłuchaj odcinka</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/praca_architekta_ekosystemu_big_data_w_Allegro/" title="S02E10 - Dariusz Eliasz - Praca architekta ekosystemu big data w Allegro"><img src="images/podcast.png" alt="S02E10 - Dariusz Eliasz - Praca architekta ekosystemu big data w Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/praca_architekta_ekosystemu_big_data_w_Allegro/" title="S02E10 - Dariusz Eliasz - Praca architekta ekosystemu big data w Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">S02E10 - Dariusz Eliasz - Praca architekta ekosystemu big data w Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">9 miesięcy temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Jak wygląda praca architekta ekosystemu big data w Allegro? Jakie zadania realizuje nasz zespół odpowiedzialny za narzędzia i infrastrukturę dla przetwarzania danych? Kiedy możemy mówić o dużych danych i ile petabajtów przetwarza Allegro? Skąd pochodzą dane Allegro i dlaczego jest ich tak dużo oraz z jakiego powodu dopiero teraz przenosimy się do chmury? O tym wszystkim opowie zdobywca statuetki Allegro Tech Hero - Dariusz Eliasz – Team Manager &amp; Platform Architect w Allegro.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/praca_architekta_ekosystemu_big_data_w_Allegro/">Posłuchaj odcinka</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/od_inzyniera_do_lidera_w_allegro/" title="S02E09 - Bartosz Gałek - Od inżyniera do lidera w Allegro"><img src="images/podcast.png" alt="S02E09 - Bartosz Gałek - Od inżyniera do lidera w Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/od_inzyniera_do_lidera_w_allegro/" title="S02E09 - Bartosz Gałek - Od inżyniera do lidera w Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">S02E09 - Bartosz Gałek - Od inżyniera do lidera w Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">10 miesięcy temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Czym jest Opbox i jakie wyzwania przed nim stoją? Jak w Allegro angażujemy się w rozwój kultury Open Source? Ile mamy projektów na GitHubie i jak świętujemy Hacktoberfest? W jaki sposób można rozwinąć się od inżyniera do lidera? Na te pytania w najnowszym Allegro Tech Podcast odpowie Bartek Gałek, Team Leader w Allegro.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/od_inzyniera_do_lidera_w_allegro/">Posłuchaj odcinka</a></div></article></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech">Zobacz więcej podcastów</a></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Wydarzenia</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/283913049/" title="Allegro Tech Live #25 - Przetwarzanie danych w ogromnej skali" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Live #25 - Przetwarzanie danych w ogromnej skali"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/283913049/" title="Allegro Tech Live #25 - Przetwarzanie danych w ogromnej skali" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Live #25 - Przetwarzanie danych w ogromnej skali</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">za 2 dni</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">!!! REJESTRACJA NA WYDARZENIE!!! https://app.evenea.pl/event/allegro-tech-live-25/ Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Kiedyś spotykaliśmy się w naszych biurach,…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/283913049/">Szczegóły</a></article></div></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/283335598/" title="Allegro Tech Live #24 - Automatyzacja i usługi biznesowe w Allegro" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Live #24 - Automatyzacja i usługi biznesowe w Allegro"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/283335598/" title="Allegro Tech Live #24 - Automatyzacja i usługi biznesowe w Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Live #24 - Automatyzacja i usługi biznesowe w Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">19 dni temu<!-- -->, Online event</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">REJESTRACJA NA WYDARZENIE ---&amp;gt; https://app.evenea.pl/event/allegro-tech-live-24/ Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Kiedyś spotykaliśmy się w naszych biurach,…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/283335598/">Szczegóły</a></article></div></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/282421464/" title="Allegro Tech Labs #9 Online: System design workshop" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Labs #9 Online: System design workshop"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/282421464/" title="Allegro Tech Labs #9 Online: System design workshop" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Labs #9 Online: System design workshop</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">2 miesiące temu<!-- -->, Online event</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">❗NA WYDARZENIE OBOWIĄZUJE REJESTRACJA: Liczba miejsc jest organiczona: https://app.evenea.pl/event/allegro-tech-labs-9/ ❗ To już druga edycja naszych warsztatów System Design Workshop! Czy chcesz poznać tajniki tworzenia systemów?…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/282421464/">Szczegóły</a></article></div></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/281692274/" title="Allegro Tech Live #23 - Przygody backendowców w C#" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Live #23 - Przygody backendowców w C#"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/281692274/" title="Allegro Tech Live #23 - Przygody backendowców w C#" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Live #23 - Przygody backendowców w C#</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">4 miesiące temu</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">------ Rejestracja: https://app.evenea.pl/event/allegro-tech-live-23/------- Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Kiedyś spotykaliśmy się w naszych biurach, a teraz…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/281692274/">Szczegóły</a></article></div></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/">Zobacz więcej wydarzeń</a></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Oferty pracy</h2><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto"><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Research Engineer - Machine Learning (Reinforcement Learning)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Kraków, Poznań, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999785422127-research-engineer-machine-learning-reinforcement-learning?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Research Engineer - Machine Learning (Ranking and Recommendations)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Poznań, Kraków, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999785421861-research-engineer-machine-learning-ranking-and-recommendations?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Research Engineer - Machine Learning (Reinforcement Learning)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Kraków, Poznań, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999779448775-research-engineer-machine-learning-reinforcement-learning?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Research Engineer - Machine Learning (Ranking and Recommendations)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Poznań, Kraków, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999779448676-research-engineer-machine-learning-ranking-and-recommendations?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Team Leader (Java/Kotlin) - Consumer Technology Experience</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Kraków, Poznań</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999777347284-team-leader-javakotlin-consumer-technology-experience?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://allegro.pl/praca">Zobacz więcej ofert</a></div><footer class="m-color-bg_navy m-margin-top-32"><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24 m-padding-bottom-24 m-display-flex@sm m-flex-justify-between m-flex-items-center m-text-align_center"><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-color_white m-padding-left-24@sm">Proudly built by Allegro Tech engineers</p><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0 m-display-flex m-flex-justify-center"><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://github.com/allegro"><img src="https://assets.allegrostatic.com/metrum/icon/github-6a18df1729.svg" alt="Github" class="m-icon"/></a></li><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://www.facebook.com/allegro.tech/"><img src="https://assets.allegrostatic.com/metrum/icon/facebook-a2b92f9dcb.svg" alt="Facebook" class="m-icon"/></a></li><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/allegrotech"><img src="https://assets.allegrostatic.com/metrum/icon/twitter-25164a58aa.svg" alt="Twitter" class="m-icon"/></a></li></ul></div></footer><div style="visibility:hidden;height:0;overflow:hidden;position:relative"><img alt="doubleclick" width="1" height="1" style="position:absolute" src="https://pubads.g.doubleclick.net/activity;dc_iu=/21612525419/DFPAudiencePixel;ord=4155881160534.5205;dc_seg=507368552?"/><img alt="fb" height="1" width="1" style="position:absolute" src="https://www.facebook.com/tr?id=1650870088530325&amp;ev=PageView&amp;noscript=1"/></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"title":"Why should we rewrite enzyme.js to react-testing-library and how to do that?","link":"https://blog.allegro.tech/2022/02/why-we-should-rewrite-enzymejs-to-rtl-and-how-to-do-that.html","pubDate":"Thu, 10 Feb 2022 00:00:00 +0100","authors":{"author":[{"name":["Magdalena Mazur"],"photo":["https://blog.allegro.tech/img/authors/magdalena.mazur.jpg"],"url":["https://blog.allegro.tech/authors/magdalena.mazur"]}]},"content":"\u003cp\u003eEveryone repeats like a mantra that tests are an indispensable element of development work. Is there anything to it?\nWell, I need to admit that as a developer, I rather often want to skip the test writing stage. I assume I’m not the\nonly one. I’m aware that it’s a mistake, even with testers on board. Effective and efficient testing of your own\ncode can help with catching bugs in new functionalities, as well as in changes to already existing ones. It cannot\nbe questioned. Sometimes tests also help to understand how some long-unused functionality or component works. And\nthat’s a small bonus too. \u003cstrong\u003eCan a large project cope without testing? Probably so. But the number of errors and\ntheir severity will probably be much higher.\u003c/strong\u003e That’s why in Allegro Ads we pay attention to writing tests.\u003c/p\u003e\n\n\u003ch2 id=\"frameworks\"\u003eFrameworks\u003c/h2\u003e\n\u003cp\u003eWe have a fairly large number of frameworks that are used to write tests in JavaScript. We can list tools like:\n\u003ca href=\"https://mochajs.org/\"\u003eMochaJS\u003c/a\u003e, \u003ca href=\"https://jestjs.io/\"\u003eJest\u003c/a\u003e, \u003ca href=\"https://karma-runner.github.io\"\u003eKarma\u003c/a\u003e,\n\u003ca href=\"https://jasmine.github.io/\"\u003eJasmine\u003c/a\u003e, \u003ca href=\"https://www.cypress.io/\"\u003eCypress\u003c/a\u003e. However, in this article, we will pay\nspecial attention and compare two javascript testing libraries: \u003ca href=\"https://enzymejs.github.io/enzyme/\"\u003eEnzyme.js\u003c/a\u003e\nand \u003ca href=\"https://testing-library.com/docs/react-testing-library/intro/\"\u003eReact Testing Library\u003c/a\u003e (often called RTL).\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2022-02-10-why-we-should-rewrite-enzymejs-to-rtl-and-how-to-do-that/01.png\" alt=\"npm trends screen\" /\u003e\n\u003cem\u003eSource \u003ca href=\"https://www.npmtrends.com/@testing-library/react-vs-enzyme\"\u003enpm trends\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\n\u003ch2 id=\"enzymejs\"\u003eEnzymeJS\u003c/h2\u003e\n\u003cp\u003eFrom the Enzyme documentation we can read a short description:\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eEnzyme is a JavaScript Testing utility for React that makes it easier to test your React Components’ output.\nYou can also manipulate, traverse, and in some ways simulate runtime given the output.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eEnzyme was released in \u003cstrong\u003e2015 by AirBnB\u003c/strong\u003e. And let’s face it, Enzyme has gained a lot of popularity. Last year, the\nlibrary was moved from AirBnB space to external Github space as a separate independent organization. This step was\nintended to encourage the community to further develop the library.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2022-02-10-why-we-should-rewrite-enzymejs-to-rtl-and-how-to-do-that/02.png\" alt=\"commit diffrences\" /\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2022-02-10-why-we-should-rewrite-enzymejs-to-rtl-and-how-to-do-that/03.png\" alt=\"commit diffrences\" /\u003e\n\u003cem\u003eSource \u003ca href=\"https://github.com/enzymejs/enzyme/commit/b06750bb5f6248ceb9c3fae903a71d0747a420d6\"\u003eEnzyme github\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eWhen it comes to raw data, the latest version of \u003cstrong\u003eEnzyme 3.11.0\u003c/strong\u003e has a bundle size of \u003cstrong\u003e463.2kB minified (127.5 kB\nminified + gzipped)\u003c/strong\u003e and was released on \u003cstrong\u003e20 December 2019\u003c/strong\u003e. Currently it has 258\n\u003ca href=\"https://github.com/enzymejs/enzyme/issues\"\u003eopen issues\u003c/a\u003e and 31 open PR’s.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2022-02-10-why-we-should-rewrite-enzymejs-to-rtl-and-how-to-do-that/04.png\" alt=\"bundlephobia Enzyme sreen\" /\u003e\n\u003cem\u003eSource \u003ca href=\"https://bundlephobia.com/package/enzyme@3.11.0\"\u003eBundle Phobia\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eInteresting fact:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003eThere are also Enzyme Adapter Packages for React. So you need to install adapter package and its dependencies\nrelated to the version of React that you are using. For example, for version 16, it also needs\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eenzyme-adapter-react-16\u003c/code\u003e to be installed. Unfortunately, it does not support all features completely.\nIt should be mentioned that there is not offical adapter for React 17 yet, which has been released in\nOctober 2020 (so it is more than a year!). If you don’t want to use community version you are still blocked and you\ncannot use the new React features.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"react-testing-library-often-called-rtl\"\u003eReact Testing Library (often called RTL)\u003c/h2\u003e\n\u003cp\u003eRTL says about itself:\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eThe React Testing Library is a very light-weight solution for testing React components. It provides light utility\n functions on top of \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ereact-dom\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ereact-dom/test-utils\u003c/code\u003e, in a way that encourages better testing practices.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eReleased in \u003cstrong\u003eApril 2018 by Kent C. Dodds\u003c/strong\u003e. The latest stable version \u003cstrong\u003e12.1.2\u003c/strong\u003e of RTL has a bundle size of \u003cstrong\u003e215.8kB\nminified (47.3kB minified + gzipped)\u003c/strong\u003e . The RTL repository has 26\n\u003ca href=\"https://github.com/enzymejs/enzyme/issues\"\u003eopen issues\u003c/a\u003e and 2 open PR’s.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2022-02-10-why-we-should-rewrite-enzymejs-to-rtl-and-how-to-do-that/05.png\" alt=\"bundlephobia RTL screen\" /\u003e\n\u003cem\u003eSource \u003ca href=\"https://bundlephobia.com/package/@testing-library/react@12.1.2\"\u003eBundle Phobia\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eInteresting facts:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003eWhen you create a project by Create React App, you will get support for React Testing Library right away.\u003c/li\u003e\n  \u003cli\u003eJest documentation links to the RTL website in the\n\u003ca href=\"https://jestjs.io/docs/testing-frameworks#react\"\u003e\u003cem\u003eTesting Web Framework\u003c/em\u003e\u003c/a\u003e section as well as React documentation in\nthe \u003ca href=\"https://reactjs.org/docs/testing.html#tools\"\u003e\u003cem\u003eRecommended Tools\u003c/em\u003e\u003c/a\u003e.\u003c/li\u003e\n  \u003cli\u003eTesting library allows us to test with the same API not only React but also other frameworks like Vue\n(\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etesting-library/vue\u003c/code\u003e), Angular (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etesting-library/angular\u003c/code\u003e), Svelte (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etesting-library/svelte\u003c/code\u003e) etc. This could bring\nsome advantage for people working on several projects in different technologies. There is also\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003edom-testing-library\u003c/code\u003e which allows writing tests without any framework!\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"basic-differences\"\u003eBasic differences\u003c/h2\u003e\n\n\u003cp\u003eThe main differences between the two libraries that I can notice:\u003c/p\u003e\n\u003col\u003e\n  \u003cli\u003e\u003cstrong\u003eDifferent approaches to testing\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eWhat distinguishes RTL is that we find elements by their labels or texts, almost like a user would. The point is to\nreplicate and simulate the user’s behavior. RTL renders components to the DOM and doesn’t give us access\ndirectly to the component’s internals. While Enzyme uses shallow rendering (or sometimes deep rendering) and\nencourages us to test the components instance using its state and props. Enzyme also allows full rendering of DOM\nbut it is not the basic assumption of the library’s operation.\u003c/p\u003e\n\u003col\u003e\n  \u003cli\u003e\u003cstrong\u003eAge\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eEnzyme is 6 years old, RTL is 3 years old\u003c/p\u003e\n\n\u003ch2 id=\"comparison-of-downloads\"\u003eComparison of downloads\u003c/h2\u003e\n\n\u003cp\u003eBelow we can see a comparison of the number of downloads of both libraries in the last 5 years. Between August and\nSeptember 2020, the number of RTL downloads exceeded the number of Enzyme downloads.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2022-02-10-why-we-should-rewrite-enzymejs-to-rtl-and-how-to-do-that/06.png\" alt=\"Enzyme and RTL dowloands graph\" /\u003e\n\u003cem\u003eSource \u003ca href=\"https://www.npmtrends.com/@testing-library/react-vs-enzyme\"\u003enpm trends\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eIn the case of RTL, it is clear that the number of downloads is still growing strongly. On the other hand, it can be\nsuspected that the highest peak of Enzyme downloads is already behind.\u003c/p\u003e\n\n\u003ch2 id=\"reasons-to-change-the-testing-library\"\u003eReasons to change the testing library\u003c/h2\u003e\n\n\u003cp\u003eWell, let’s be honest, Enzyme.js is a powerful library which has helped us test our React Components in an easier way\nfor a long time. But maybe… too long? The first official release was in December 2015. Do not get me wrong, I don’t\nwant to say that everything old is bad. But the frontend world is changing constantly, just as the approach to\ntesting it. I know that the Enzyme.js library hasn’t been deprecated yet, but there are a lot of reasons to switch\nyour test library right now. \u003cstrong\u003eIf you haven’t read it I highly recommend you to take a look at\n\u003ca href=\"https://www.piotrstaniow.pl/goodbye-enzyme\"\u003ethis article\u003c/a\u003e by Piotr Staniów\u003c/strong\u003e (it takes about 10 minutes to read).\u003c/p\u003e\n\n\u003cp\u003eThe main reasons for me to think about slowly rewriting my tests and switching to another library from this article\nare:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003eone developer maintaining the entire Enzyme package,\u003c/li\u003e\n  \u003cli\u003enot keeping up with React changes.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIf you ask me, these are big blockers in using this tool.\u003c/p\u003e\n\n\u003ch2 id=\"case-study-of-rewriting\"\u003eCase study of rewriting\u003c/h2\u003e\n\n\u003cp\u003eBelow I will present my own example created for the purposes of this article. It should present the minimal effort to\nrewrite tests from one library to another.\u003c/p\u003e\n\n\u003ch3 id=\"component\"\u003eComponent:\u003c/h3\u003e\n\n\u003cdiv class=\"language-js highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eReact\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003euseState\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ereact\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003edefaultCounter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eheader\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eDefault header\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ecounter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetCounter\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edefaultCounter\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eincrement\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003esetCounter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecounter\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003edecrement\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003esetCounter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecounter\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ediv\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eh1\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/h1\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ep\u003c/span\u003e \u003cspan class=\"nx\"\u003eclassName\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ecounter\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ecounter\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/p\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e \u003cspan class=\"nx\"\u003eonClick\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eIncrement\u003c/span\u003e \u003cspan class=\"nx\"\u003ecounter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/button\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e \u003cspan class=\"nx\"\u003eonClick\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003edecrement\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eDecrement\u003c/span\u003e \u003cspan class=\"nx\"\u003ecounter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/button\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/div\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"enzyme-example\"\u003eEnzyme example:\u003c/h3\u003e\n\n\u003cdiv class=\"language-js highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eReact\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ereact\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003emount\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eenzyme\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e../Test\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003edescribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026lt;Test /\u0026gt;\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eshould render default header\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// when\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003emount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// then\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoContain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eDefault header\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eshould render header from props\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// when\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003emount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"nx\"\u003eheader\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eMy simple calculator\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// then\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoContain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eMy simple calculator\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"nx\"\u003enot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etoContain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eDefault header\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eshould render default defaultCounter\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// when\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003emount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// then\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e.counter\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e0\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eshould render defaultCounter from props\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// when\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003emount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"nx\"\u003edefaultCounter\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"sr\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"err\"\u003e;\n\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// then\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e.counter\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e100\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eshould increment counter on click\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// given\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003emount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"nx\"\u003edefaultCounter\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"sr\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"err\"\u003e;\n\u003c/span\u003e    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ebutton\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// when\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esimulate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eclick\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// then\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e.counter\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e101\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eshould decrement counter on click\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// given\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003emount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"nx\"\u003edefaultCounter\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"sr\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"err\"\u003e;\n\u003c/span\u003e    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ebutton\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// when\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esimulate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eclick\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// then\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ewrapper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e.counter\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e99\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"what-needs-to-be-changed\"\u003eWhat needs to be changed:\u003c/h3\u003e\n\u003cul\u003e\n  \u003cli\u003eremove \u003ccode class=\"language-plaintext highlighter-rouge\"\u003emount\u003c/code\u003e and use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003erender\u003c/code\u003e instead\u003c/li\u003e\n  \u003cli\u003eremove \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ewrapper\u003c/code\u003e variable and use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003escreen\u003c/code\u003e to get elements\u003c/li\u003e\n  \u003cli\u003ereplace \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esimulate(’click’)\u003c/code\u003e with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003euserEvent\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3 id=\"react-testing-library-example\"\u003eReact Testing Library example:\u003c/h3\u003e\n\n\u003cdiv class=\"language-js highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eReact\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ereact\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003escreen\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e@testing-library/react\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003euserEvent\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e@testing-library/user-event\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e../Test\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003edescribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026lt;Test /\u0026gt;\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eshould render default header\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// when\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// then\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetByRole\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eheading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eDefault header\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"p\"\u003e})).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBeInTheDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eshould render header from props\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// when\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"nx\"\u003eheader\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eMy simple calculator\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// then\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetByRole\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eheading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eMy simple calculator\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"p\"\u003e})).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBeInTheDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equeryByText\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eDefault header\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)).\u003c/span\u003e\u003cspan class=\"nx\"\u003enot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBeInTheDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eshould render default defaultCounter\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// when\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// then\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetByText\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e0\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBeInTheDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eshould render defaultCounter from props\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// when\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"nx\"\u003edefaultCounter\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"sr\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"err\"\u003e;\n\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// then\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetByText\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e100\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBeInTheDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eshould increment counter on click\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// given\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"nx\"\u003edefaultCounter\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"sr\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"err\"\u003e;\n\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003escreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetByRole\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ebutton\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eIncrement counter\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// when\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003euserEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eclick\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// then\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetByText\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e101\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBeInTheDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eshould decrement counter on click\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// given\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e \u003cspan class=\"nx\"\u003edefaultCounter\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"sr\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"err\"\u003e;\n\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003escreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetByRole\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ebutton\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eDecrement counter\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// when\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003euserEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eclick\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// then\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetByText\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e99\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBeInTheDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"enzyme-and-rtl-in-allegro-ads\"\u003eEnzyme and RTL in Allegro Ads\u003c/h2\u003e\n\n\u003cp\u003eMy team is currently working on the development of \u003ca href=\"https://allegro.pl/ads\"\u003eAllegro Ads\u003c/a\u003e, which is an advertising tool\nfor our e-commerce platform sellers. It is a whole panel for viewing statistics, displaying advertising campaigns. We\nprovide sponsored offers for our Allegro site, Facebook, Google and recently even the partner websites. Our sellers\npay us for the opportunity to advertise their products, and at the same time we strive to ensure that these ads\naccurately reach people potentially interested in buying, thereby generating profits for sellers.\u003c/p\u003e\n\n\u003cp\u003eThe main technology stack is standard and still pretty cool. The core of the project is written in React, and\nsignificant parts have been rewritten to TypeScript. For testing purposes, we use Jest. In my opinion this is a very\ngood and stable tool, easy to work with. It has quite a low entry barrier, even if someone hasn’t had too much\nexperience with tests before. The main advantages of Jest for me are minimal configuration and quite good\ndocumentation. But for testing React components we currently have two libraries and I’ll explain why in a moment.\u003c/p\u003e\n\n\u003cp\u003eThe 2.0 version of platform Allegro Ads was released about 6 years ago. A year ago\nthe team added React Testing Library to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003epackage.json\u003c/code\u003e. We have both packages so far. \u003cstrong\u003eRecently we officially\ndecided to slowly rewrite the Enzyme tests and get rid of the library for good.\u003c/strong\u003e We added the rule to our\nDeclaration of Code Convention that the new components are tested just in RTL, the old ones will be rewritten\nduring the development of specific parts.\u003c/p\u003e\n\n\u003ch2 id=\"migration-effects-so-far\"\u003eMigration effects so far\u003c/h2\u003e\n\n\u003cp\u003eCurrently we have got \u003cstrong\u003e592 test files\u003c/strong\u003e (counting after the file names with “spec” phrase). In these files we can also\nfind \u003cstrong\u003e709 of unique “describe”\u003c/strong\u003e usage, and \u003cstrong\u003e1796 unique test cases\u003c/strong\u003e. Half of tests\nare written only in Jest, but a significant number of tests for better testing use extra libraries.\u003c/p\u003e\n\n\u003cp\u003eReact Testing Library is used in \u003cstrong\u003e131 files\u003c/strong\u003e, which is around \u003cstrong\u003e22% of all test files\u003c/strong\u003e.\nEnzyme tests are in \u003cstrong\u003e137 files\u003c/strong\u003e which is around \u003cstrong\u003e23%\u003c/strong\u003e.\u003c/p\u003e\n\n\u003cp\u003eSo Enzyme is still used more often. However, keep in mind that we have been using Enzyme in this project from the\nbeginning and RTL for a year. So I’m quite stunned by these numbers. I did not think that the use of RTL would\nincrease so significantly in a year. Of course, there is still a long way to completely eliminate Enzyme, especially\namong other project priorities, but now I’m convinced that small steps will be enough to do that.\u003c/p\u003e\n\n\u003ch2 id=\"summary\"\u003eSummary\u003c/h2\u003e\n\n\u003cp\u003eHopefully this article showed you that switching from one library to another doesn’t have to be difficult. As\nprogrammers, we will encounter such situations frequently. I think that the effort put into replacing old libraries\nwith newer ones and keeping your code free of technological debt will bring tangible results for developers, project\nand, finally, users.\u003c/p\u003e\n\n\u003cp\u003eI hope that I was able to show you why we rewrite the Enzyme tests to RTL, how we do it and what stage we are at.\nProbably it is not the end. What are we going to replace RTL with in the future? We’ll see. :)\u003c/p\u003e\n","contentSnippet":"Everyone repeats like a mantra that tests are an indispensable element of development work. Is there anything to it?\nWell, I need to admit that as a developer, I rather often want to skip the test writing stage. I assume I’m not the\nonly one. I’m aware that it’s a mistake, even with testers on board. Effective and efficient testing of your own\ncode can help with catching bugs in new functionalities, as well as in changes to already existing ones. It cannot\nbe questioned. Sometimes tests also help to understand how some long-unused functionality or component works. And\nthat’s a small bonus too. Can a large project cope without testing? Probably so. But the number of errors and\ntheir severity will probably be much higher. That’s why in Allegro Ads we pay attention to writing tests.\nFrameworks\nWe have a fairly large number of frameworks that are used to write tests in JavaScript. We can list tools like:\nMochaJS, Jest, Karma,\nJasmine, Cypress. However, in this article, we will pay\nspecial attention and compare two javascript testing libraries: Enzyme.js\nand React Testing Library (often called RTL).\n\nSource npm trends\nEnzymeJS\nFrom the Enzyme documentation we can read a short description:\nEnzyme is a JavaScript Testing utility for React that makes it easier to test your React Components’ output.\nYou can also manipulate, traverse, and in some ways simulate runtime given the output.\nEnzyme was released in 2015 by AirBnB. And let’s face it, Enzyme has gained a lot of popularity. Last year, the\nlibrary was moved from AirBnB space to external Github space as a separate independent organization. This step was\nintended to encourage the community to further develop the library.\n\n\nSource Enzyme github\nWhen it comes to raw data, the latest version of Enzyme 3.11.0 has a bundle size of 463.2kB minified (127.5 kB\nminified + gzipped) and was released on 20 December 2019. Currently it has 258\nopen issues and 31 open PR’s.\n\nSource Bundle Phobia\nInteresting fact:\nThere are also Enzyme Adapter Packages for React. So you need to install adapter package and its dependencies\nrelated to the version of React that you are using. For example, for version 16, it also needs\nenzyme-adapter-react-16 to be installed. Unfortunately, it does not support all features completely.\nIt should be mentioned that there is not offical adapter for React 17 yet, which has been released in\nOctober 2020 (so it is more than a year!). If you don’t want to use community version you are still blocked and you\ncannot use the new React features.\nReact Testing Library (often called RTL)\nRTL says about itself:\nThe React Testing Library is a very light-weight solution for testing React components. It provides light utility\n functions on top of react-dom and react-dom/test-utils, in a way that encourages better testing practices.\nReleased in April 2018 by Kent C. Dodds. The latest stable version 12.1.2 of RTL has a bundle size of 215.8kB\nminified (47.3kB minified + gzipped) . The RTL repository has 26\nopen issues and 2 open PR’s.\n\nSource Bundle Phobia\nInteresting facts:\nWhen you create a project by Create React App, you will get support for React Testing Library right away.\nJest documentation links to the RTL website in the\nTesting Web Framework section as well as React documentation in\nthe Recommended Tools.\nTesting library allows us to test with the same API not only React but also other frameworks like Vue\n(testing-library/vue), Angular (testing-library/angular), Svelte (testing-library/svelte) etc. This could bring\nsome advantage for people working on several projects in different technologies. There is also\ndom-testing-library which allows writing tests without any framework!\nBasic differences\nThe main differences between the two libraries that I can notice:\nDifferent approaches to testing\nWhat distinguishes RTL is that we find elements by their labels or texts, almost like a user would. The point is to\nreplicate and simulate the user’s behavior. RTL renders components to the DOM and doesn’t give us access\ndirectly to the component’s internals. While Enzyme uses shallow rendering (or sometimes deep rendering) and\nencourages us to test the components instance using its state and props. Enzyme also allows full rendering of DOM\nbut it is not the basic assumption of the library’s operation.\nAge\nEnzyme is 6 years old, RTL is 3 years old\nComparison of downloads\nBelow we can see a comparison of the number of downloads of both libraries in the last 5 years. Between August and\nSeptember 2020, the number of RTL downloads exceeded the number of Enzyme downloads.\n\nSource npm trends\nIn the case of RTL, it is clear that the number of downloads is still growing strongly. On the other hand, it can be\nsuspected that the highest peak of Enzyme downloads is already behind.\nReasons to change the testing library\nWell, let’s be honest, Enzyme.js is a powerful library which has helped us test our React Components in an easier way\nfor a long time. But maybe… too long? The first official release was in December 2015. Do not get me wrong, I don’t\nwant to say that everything old is bad. But the frontend world is changing constantly, just as the approach to\ntesting it. I know that the Enzyme.js library hasn’t been deprecated yet, but there are a lot of reasons to switch\nyour test library right now. If you haven’t read it I highly recommend you to take a look at\nthis article by Piotr Staniów (it takes about 10 minutes to read).\nThe main reasons for me to think about slowly rewriting my tests and switching to another library from this article\nare:\none developer maintaining the entire Enzyme package,\nnot keeping up with React changes.\nIf you ask me, these are big blockers in using this tool.\nCase study of rewriting\nBelow I will present my own example created for the purposes of this article. It should present the minimal effort to\nrewrite tests from one library to another.\nComponent:\n\nimport React, { useState } from 'react';\n\nexport const Test = ({ defaultCounter = 0, header = 'Default header' }) =\u003e {\n    const [counter, setCounter] = useState(defaultCounter)\n    const increment = () =\u003e setCounter(counter + 1)\n    const decrement = () =\u003e setCounter(counter - 1)\n\n    return (\n        \u003cdiv\u003e\n            \u003ch1\u003e{header}\u003c/h1\u003e\n            \u003cp className='counter'\u003e{counter}\u003c/p\u003e\n            \u003cbutton onClick={increment}\u003eIncrement counter\u003c/button\u003e\n            \u003cbutton onClick={decrement}\u003eDecrement counter\u003c/button\u003e\n        \u003c/div\u003e\n    )\n};\n\n\n\nEnzyme example:\n\nimport React from 'react';\nimport { mount } from 'enzyme';\n\nimport { Test } from '../Test';\n\ndescribe('\u003cTest /\u003e', () =\u003e {\n  it('should render default header', () =\u003e {\n    // when\n    const wrapper = mount(\u003cTest /\u003e);\n\n    // then\n    expect(wrapper.text()).toContain('Default header');\n  });\n\n  it('should render header from props', () =\u003e {\n    // when\n    const wrapper = mount(\u003cTest header=\"My simple calculator\" /\u003e);\n\n    // then\n    expect(wrapper.text()).toContain('My simple calculator');\n    expect(wrapper.text()).not.toContain('Default header');\n  });\n\n  it('should render default defaultCounter', () =\u003e {\n    // when\n    const wrapper = mount(\u003cTest /\u003e);\n\n    // then\n    expect(wrapper.find('.counter').text()).toBe('0');\n  });\n\n  it('should render defaultCounter from props', () =\u003e {\n    // when\n    const wrapper = mount(\u003cTest defaultCounter={100} /\u003e);\n\n    // then\n    expect(wrapper.find('.counter').text()).toBe('100');\n  });\n\n  it('should increment counter on click', () =\u003e {\n    // given\n    const wrapper = mount(\u003cTest defaultCounter={100} /\u003e);\n    const button = wrapper.find('button').at(0);\n\n    // when\n    button.simulate('click');\n\n    // then\n    expect(wrapper.find('.counter').text()).toBe('101');\n  });\n\n  it('should decrement counter on click', () =\u003e {\n    // given\n    const wrapper = mount(\u003cTest defaultCounter={100} /\u003e);\n    const button = wrapper.find('button').at(1);\n\n    // when\n    button.simulate('click');\n\n    // then\n    expect(wrapper.find('.counter').text()).toBe('99');\n  });\n});\n\n\nWhat needs to be changed:\nremove mount and use render instead\nremove wrapper variable and use screen to get elements\nreplace simulate(’click’) with userEvent\nReact Testing Library example:\n\nimport React from 'react';\nimport { render, screen } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\n\nimport { Test } from '../Test';\n\ndescribe('\u003cTest /\u003e', () =\u003e {\n  it('should render default header', () =\u003e {\n    // when\n    render(\u003cTest /\u003e);\n\n    // then\n    expect(screen.getByRole('heading', { name: 'Default header' })).toBeInTheDocument();\n  });\n\n  it('should render header from props', () =\u003e {\n    // when\n    render(\u003cTest header=\"My simple calculator\" /\u003e);\n\n    // then\n    expect(screen.getByRole('heading', { name: 'My simple calculator' })).toBeInTheDocument();\n    expect(screen.queryByText('Default header')).not.toBeInTheDocument();\n  });\n\n  it('should render default defaultCounter', () =\u003e {\n    // when\n    render(\u003cTest /\u003e);\n\n    // then\n    expect(screen.getByText('0')).toBeInTheDocument();\n  });\n\n  it('should render defaultCounter from props', () =\u003e {\n    // when\n    render(\u003cTest defaultCounter={100} /\u003e);\n\n    // then\n    expect(screen.getByText('100')).toBeInTheDocument();\n  });\n\n  it('should increment counter on click', () =\u003e {\n    // given\n    render(\u003cTest defaultCounter={100} /\u003e);\n\n    const button = screen.getByRole('button', { name: 'Increment counter' });\n\n    // when\n    userEvent.click(button);\n\n    // then\n    expect(screen.getByText('101')).toBeInTheDocument();\n  });\n\n  it('should decrement counter on click', () =\u003e {\n    // given\n    render(\u003cTest defaultCounter={100} /\u003e);\n\n    const button = screen.getByRole('button', { name: 'Decrement counter' });\n\n    // when\n    userEvent.click(button);\n\n    // then\n    expect(screen.getByText('99')).toBeInTheDocument();\n  });\n});\n\n\n\nEnzyme and RTL in Allegro Ads\nMy team is currently working on the development of Allegro Ads, which is an advertising tool\nfor our e-commerce platform sellers. It is a whole panel for viewing statistics, displaying advertising campaigns. We\nprovide sponsored offers for our Allegro site, Facebook, Google and recently even the partner websites. Our sellers\npay us for the opportunity to advertise their products, and at the same time we strive to ensure that these ads\naccurately reach people potentially interested in buying, thereby generating profits for sellers.\nThe main technology stack is standard and still pretty cool. The core of the project is written in React, and\nsignificant parts have been rewritten to TypeScript. For testing purposes, we use Jest. In my opinion this is a very\ngood and stable tool, easy to work with. It has quite a low entry barrier, even if someone hasn’t had too much\nexperience with tests before. The main advantages of Jest for me are minimal configuration and quite good\ndocumentation. But for testing React components we currently have two libraries and I’ll explain why in a moment.\nThe 2.0 version of platform Allegro Ads was released about 6 years ago. A year ago\nthe team added React Testing Library to package.json. We have both packages so far. Recently we officially\ndecided to slowly rewrite the Enzyme tests and get rid of the library for good. We added the rule to our\nDeclaration of Code Convention that the new components are tested just in RTL, the old ones will be rewritten\nduring the development of specific parts.\nMigration effects so far\nCurrently we have got 592 test files (counting after the file names with “spec” phrase). In these files we can also\nfind 709 of unique “describe” usage, and 1796 unique test cases. Half of tests\nare written only in Jest, but a significant number of tests for better testing use extra libraries.\nReact Testing Library is used in 131 files, which is around 22% of all test files.\nEnzyme tests are in 137 files which is around 23%.\nSo Enzyme is still used more often. However, keep in mind that we have been using Enzyme in this project from the\nbeginning and RTL for a year. So I’m quite stunned by these numbers. I did not think that the use of RTL would\nincrease so significantly in a year. Of course, there is still a long way to completely eliminate Enzyme, especially\namong other project priorities, but now I’m convinced that small steps will be enough to do that.\nSummary\nHopefully this article showed you that switching from one library to another doesn’t have to be difficult. As\nprogrammers, we will encounter such situations frequently. I think that the effort put into replacing old libraries\nwith newer ones and keeping your code free of technological debt will bring tangible results for developers, project\nand, finally, users.\nI hope that I was able to show you why we rewrite the Enzyme tests to RTL, how we do it and what stage we are at.\nProbably it is not the end. What are we going to replace RTL with in the future? We’ll see. :)","guid":"https://blog.allegro.tech/2022/02/why-we-should-rewrite-enzymejs-to-rtl-and-how-to-do-that.html","categories":["tech","frontend","javascript","jest","enzyme","react-testing-library","rtl","react"],"isoDate":"2022-02-09T23:00:00.000Z","thumbnail":"images/post-headers/javascript.png"},{"title":"How do coroutines work internally in Python?","link":"https://blog.allegro.tech/2022/01/how-do-coroutines-work-internally-in-python.html","pubDate":"Mon, 24 Jan 2022 00:00:00 +0100","authors":{"author":[{"name":["Tomasz Szewczyk"],"photo":["https://blog.allegro.tech/img/authors/tomasz.szewczyk.jpg"],"url":["https://blog.allegro.tech/authors/tomasz.szewczyk"]}]},"content":"\u003cp\u003eMost of applications we create are basically loops. An average program waits\nfor an event, then processes it following some business logic. Afterwards it\nbegins waiting for another event to arrive. Java Servlets work this way too.\nPopular frameworks such as Spring allow us to only care about the business logic,\nwhile the framework takes care of the application main loop.\u003c/p\u003e\n\n\u003ch3 id=\"the-problem-with-blocking-operations\"\u003eThe problem with blocking operations\u003c/h3\u003e\n\u003cp\u003eImagine a very simple web application whose task is to calculate currency\nexchange rates. It uses no framework, only operating system API or methods from\nyour favourite language standard library. It waits for a request with the amount,\nbase and target currencies and responds with a calculated output. In its simplest\nform it could have all the exchange rates hardcoded, so the operation is very\nfast and efficient. We can assume that such an application uses all the\navailable processing power when handling requests.\u003c/p\u003e\n\n\u003cp\u003eBut in the next iteration we want our app to query another service for current\nrates instead of relying on hardcoded values. We will soon discover our app is\nspending most of its time waiting for a response from the other service.\u003c/p\u003e\n\n\u003cp\u003eNetwork communication is very slow after all. Let’s assume that a simple request\ntakes at least 1ms to complete. Modern processors have clock frequencies up to\n5GHz and, provided the data and code are already cached, they are capable of\nat least one simple operation per cycle. This means we could have done at least\n5 million simple operations while waiting for the request to complete! What a\nwaste of resources!\u003c/p\u003e\n\n\u003ch3 id=\"classic-approach-with-threads\"\u003eClassic approach with threads\u003c/h3\u003e\n\u003cp\u003eThe most obvious solution to this issue are threads. We could refactor our\napplication so that when it receives the request it passes it to a separate\nthread. This way we don’t have to worry about blocking operations in the\nbusiness logic. It is the operating system’s responsibility to allocate CPU to\nsomething meaningful while our thread is blocked waiting for the other service.\nFrom my experience this is how most of the applications work.\u003c/p\u003e\n\n\u003cp\u003eUnfortunately this approach has some drawbacks as well. Threads consume a lot of\nresources and you can only create a limited number of them. Very soon you\ndiscover threads are a precious resource on their own and you can hardly afford\nthem sitting and waiting for a request to complete. You need to consider your\nthread pool allocation policy in order not to starve some part of your\napplication. Add race conditions and other concurrency related issues and it\nsuddenly gets overcomplicated.\u003c/p\u003e\n\n\u003ch3 id=\"how-about-we-dont-block\"\u003eHow about we don’t block\u003c/h3\u003e\n\u003cp\u003eLet’s assume you decide threads are too expensive, too cumbersome or they are\nsimply not available on your platform, because for example you are writing bare\nmetal applications and there is no operating system. When we decide not to use\nthreading we have to keep in mind we cannot afford having any blocking operations\nin our application, because they are wasting our resources. Having no threads\nmeans there is no way to use time when something blocks.\u003c/p\u003e\n\n\u003cp\u003eThe new idea for the program architecture is as follows:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003eWait for an event to happen.\u003c/li\u003e\n  \u003cli\u003eIf the event is a new request arriving to an endpoint, then we only setup\nthe request to another service and return.\u003c/li\u003e\n  \u003cli\u003eIf the event is a response from the other service, then\nwe consume the received data and we setup a response to the original request.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThis way we don’t have any blocking operation in our application, hence it is\nvery efficient.\u003c/p\u003e\n\n\u003ch2 id=\"low-level-async-api\"\u003eLow level async API\u003c/h2\u003e\n\u003cp\u003eLinux and similar operating systems provide us with a convenient API for many\nblocking operations. For example, the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eaccept\u003c/code\u003e system call is used to get an\nincoming TCP connection from a queue of pending connections or wait for one\nto show up. You can read more about \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eaccept\u003c/code\u003e in \u003ca href=\"https://man7.org/linux/man-pages/man2/accept.2.html\"\u003ethe Linux manual\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eSimilarly \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ewrite\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eread\u003c/code\u003e functions, defined by POSIX standard, are used\nto send and receive data over the created connection. Both can also block\nwaiting for the I/O operation to become possible. You can read more about these\nfunctions in the Linux manual: \u003ca href=\"https://man7.org/linux/man-pages/man2/read.2.html\"\u003eread\u003c/a\u003e,\n\u003ca href=\"https://man7.org/linux/man-pages/man3/write.3p.html\"\u003ewrite\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eAs you may have already noticed, our asynchronous application only makes sense\nwhen there is only one blocking operation in the whole program. Earlier we\ncalled it “waiting for an event to happen”. In Linux we can achieve such a\nbehaviour using \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eselect\u003c/code\u003e or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003epoll\u003c/code\u003e system calls. \u003ccode class=\"language-plaintext highlighter-rouge\"\u003epoll\u003c/code\u003e is basically a more modern\nversion of \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eselect\u003c/code\u003e. In practice we can provide them with a set of event\ndescriptors and they will block until one of expected events occurs. You can\nread more about these calls in the Linux manual: \u003ca href=\"https://man7.org/linux/man-pages/man2/select.2.html\"\u003eselect\u003c/a\u003e,\n\u003ca href=\"https://man7.org/linux/man-pages/man2/poll.2.html\"\u003epoll\u003c/a\u003e.\u003c/p\u003e\n\n\u003ch2 id=\"select-in-python\"\u003eSelect in Python\u003c/h2\u003e\n\u003cp\u003eThis API can be accessed in Python with a convenient wrapper provided by the\nPython standard library. It hides some complicated low level aspects of the\noperating system API which is good for this article. Read more about\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eselectors\u003c/code\u003e module in \u003ca href=\"https://docs.python.org/3/library/selectors.html#module-selectors\"\u003ethe Python documentation\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eFirstly we can register an event we want to wait for using the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eregister\u003c/code\u003e\nmethod, then we wait for any registered event to happen using the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eselect\u003c/code\u003e\nmethod. Python standard library provides us with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eDefaultSelector\u003c/code\u003e which is an\nalias for the most efficient implementation on the current platform, so that we\ndon’t have to dive into low level details if we don’t want to.\u003c/p\u003e\n\n\u003ch3 id=\"the-simplest-async-application\"\u003eThe simplest async application\u003c/h3\u003e\n\u003cp\u003eFor the sake of simplicity of the examples I won’t use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eSelector\u003c/code\u003e and I won’t\ntry to create an async http client from scratch. There are plainly too many\nunrelated low level details. Surprisingly, event the most common GET request consists\nof numerous blocking operations. Instead, I propose the most basic and most easily\ncontrollable blocking operation there is: waiting for user input.\u003c/p\u003e\n\n\u003cp\u003eLet’s replace the complicated \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eselector\u003c/code\u003e with a simple \u003ccode class=\"language-plaintext highlighter-rouge\"\u003einput\u003c/code\u003e function and\nmodel events with letters. Here is how such an app could look like:\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eprocess_a\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Processing event A\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eprocess_b\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Processing event B\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eprocess_c\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Processing event C\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003estrip\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"A\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eprocess_a\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"B\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eprocess_b\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"C\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eprocess_c\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"__main__\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e$ python manual_async_simple.py\n\u0026gt; A\nProcessing event A\n\u0026gt; B\nProcessing event B\n\u0026gt; C\nProcessing event C\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAs you can see we created an event loop listening for events (user input),\nthen it dispatches the event to the relevant handler. Note how the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003einput\u003c/code\u003e\nfunction inside the event loop is the only blocking operation in the whole\nprogram.\u003c/p\u003e\n\n\u003ch3 id=\"more-complex-flow-of-execution\"\u003eMore complex flow of execution\u003c/h3\u003e\n\u003cp\u003eAs I already mentioned, creating asynchronous applications is easy as long as\nthere is no blocking operation while processing events. The aforementioned\nexample was so simple because there weren’t any. When there is some blocking\noperation we have to split our processing logic into parts, each one ending\nwhen there is a need for some blocking operation.\u003c/p\u003e\n\n\u003cp\u003eFor example imagine a \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eTask\u003c/code\u003e which is triggered with event A, but then it has\nto wait for events B and C in order to complete. You need separate chunks of\ncode to process each event and some way to hold the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eTask\u003c/code\u003e state. One could\ncode it that way:\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eCOUNTER\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"AWAITING A\"\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCOUNTER\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCOUNTER\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eprocess_a\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e Processing event A, blocking on B\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"AWAITING B\"\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eprocess_b\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e Processing event B, blocking on C\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"AWAITING C\"\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eprocess_c\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e Processing event C, task done\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"DONE\"\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eprocess_new_event\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"AWAITING A\"\u003c/span\u003e \u003cspan class=\"ow\"\u003eand\u003c/span\u003e \u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"A\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprocess_a\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"AWAITING B\"\u003c/span\u003e \u003cspan class=\"ow\"\u003eand\u003c/span\u003e \u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"B\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprocess_b\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"AWAITING C\"\u003c/span\u003e \u003cspan class=\"ow\"\u003eand\u003c/span\u003e \u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"C\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprocess_c\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etasks\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Task queue size \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003estrip\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"A\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprocess_new_event\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"DONE\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eremove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"__main__\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e$ python manual_async_with_state.py\nTask queue size 0\n\u0026gt; A\n0 Processing event A, blocking on B\nTask queue size 1\n\u0026gt; A\n1 Processing event A, blocking on B\nTask queue size 2\n\u0026gt; A\n2 Processing event A, blocking on B\nTask queue size 3\n\u0026gt; B\n0 Processing event B, blocking on C\nTask queue size 3\n\u0026gt; C\n0 Processing event C, task done\nTask queue size 2\n\u0026gt; B\n1 Processing event B, blocking on C\nTask queue size 2\n\u0026gt; C\n1 Processing event C, task done\nTask queue size 1\n\u0026gt; B\n2 Processing event B, blocking on C\nTask queue size 1\n\u0026gt; C\n2 Processing event C, task done\nTask queue size 0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ePay attention to how hard it is to extract the actual flow of the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eTask\u003c/code\u003e from\nthe example. The \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eTask\u003c/code\u003e is split into three separate methods, each one\nresponsible for a part of the process. There is also a state persisted through\nconsecutive events.\u003c/p\u003e\n\n\u003cp\u003eThe bright side is the code actually works. You can go through a \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eTask\u003c/code\u003e\ntriggering events A, B and C, but you can also start a number of \u003cem\u003eTasks\u003c/em\u003e in\nparallel by sending a lot of A events in a row. You can then advance these\n\u003cem\u003eTasks\u003c/em\u003e by sending events they are waiting for.\u003c/p\u003e\n\n\u003cp\u003eWith classic threaded approach it would be most likely easy to saturate thread\npool even by hand. With our asynchronous example you can have a ton of \u003cem\u003eTasks\u003c/em\u003e\nin progress without any overhead, so the main goal is accomplished.\u003c/p\u003e\n\n\u003ch2 id=\"disadvantages-of-asynchronous-approach\"\u003eDisadvantages of asynchronous approach\u003c/h2\u003e\n\u003cp\u003eWe learned that asynchronous approach results in an efficient application, but\nalso has some drawbacks. For starters, your code does not reflect your program\nlogic directly. Instead, you have to manually control the flow, maintain state\nand pass requests’ context around which is cumbersome and error prone.\u003c/p\u003e\n\n\u003cp\u003eYour application business logic is hidden under implementation details and the\narchitecture of your solution is determined by the way you decided to deal with\nasynchronous operations. You have to stick to a set of complicated rules when\ndeveloping new features.\u003c/p\u003e\n\n\u003cp\u003eIf only there were functions that could be easily suspended! We then could\ncreate our business logic in a convenient way and achieve asynchronous\nbehaviour at the same time. Instead of passing context around fragments of our\nprogram, we could just suspend the execution of a function while there is some\nblocking operation going on. That would be great, wouldn’t it?\u003c/p\u003e\n\n\u003ch2 id=\"generators\"\u003eGenerators\u003c/h2\u003e\n\u003cp\u003eAccording to the glossary of Python official documentation a generator is a\nfunction which contains \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eyield\u003c/code\u003e expressions. Each \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eyield\u003c/code\u003e temporarily suspends\nprocessing, remembering the location execution state. When the generator\nresumes, it picks up where it left off. It seems generators are indeed\nfunctions that can be easily suspended. That is exactly what we were looking\nfor!\u003c/p\u003e\n\n\u003ch3 id=\"a-closer-look-at-generators\"\u003eA closer look at generators\u003c/h3\u003e\n\u003cp\u003eLet’s take a closer look at generators. How do they work and what is their\npurpose? First let’s write a function that prints Fibonacci numbers.\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eprint_fibonacci\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"__main__\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprint_fibonacci\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e$ python print_fibonnaci.py\n1\n1\n2\n3\n5\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eNext, replace the call to print function with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eyield\u003c/code\u003e expressions and use our\nfunction as an iterable.\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eyield_fibonacci\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"__main__\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eyield_fibonacci\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e$ python yield_fibonnaci.py\n1\n1\n2\n3\n5\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAs you can see, the function became a generator when we used \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eyield\u003c/code\u003e expression\ninside it. When the program reaches \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eyield\u003c/code\u003e expression, the execution is suspended\nand a value is used as an output. From the outside, the generator behaves like\nan iterable or even like a stream, because the values we iterate over are not\nstored in memory. They are generated when needed.\u003c/p\u003e\n\n\u003cp\u003eThere can be multiple \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eyield\u003c/code\u003e expressions in the generator. When execution reaches\nthe end of the generator, the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eStopIteration\u003c/code\u003e exception is thrown, just like\nwith iterators.\u003c/p\u003e\n\n\u003ch3 id=\"yield-from-and-return\"\u003eYield from and return\u003c/h3\u003e\n\u003cp\u003eYou can embed one generator inside another with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eyield from\u003c/code\u003e expression. In the\nfollowing example there is a generator using another generator twice to\ngenerate increasing and decreasing numbers.\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003estep_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estep\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"n\"\u003estart\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003estep\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003estop\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"n\"\u003estart\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003estep\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ewrapper_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estop\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003estep_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003estep_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"__main__\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ewrapper_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e$ python yield_twice.py\n0\n1\n2\n3\n4\n5\n4\n3\n2\n1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWhat is more, a generator can also have a return statement. The returned value\nwill be used as a payload to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eStopIteration\u003c/code\u003e exception raised when the iteration\nis over or (much more usefully) it can be used as a result of \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eyield from\u003c/code\u003e\nexpression.\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003estep_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estep\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"n\"\u003estart\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003estep\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003estop\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"n\"\u003estart\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003estep\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ewrapper_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003estep_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Generated \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e numbers\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"__main__\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ewrapper_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e$ python returning_generator.py\n0\n2\n4\n6\n8\nGenerated 5 numbers\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"exceptions-inside-generators\"\u003eExceptions inside generators\u003c/h3\u003e\n\u003cp\u003eIf an exception is raised within the generator it can be caught using the\nregular try/except statement in the wrapping generator.\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efailing_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eraise\u003c/span\u003e \u003cspan class=\"nb\"\u003eException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Generator error\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ewrapper_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003efailing_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Something went wrong\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"__main__\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ewrapper_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e$ python failing_generator.py\n0\nSomething went wrong\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eYou can read more about generators in the \u003ca href=\"https://docs.python.org/3/howto/functional.html#generators\"\u003ePython documentation\u003c/a\u003e.\u003c/p\u003e\n\n\u003ch2 id=\"async-code-using-generators\"\u003eAsync code using generators\u003c/h2\u003e\n\u003cp\u003eSo we know that generators superficially behave like a stream of values.\nOn the inside they look very similar to regular functions. Their execution\nflow is easy to understand, because they work just like our standard imperative\ncode. And we know they can be easily suspended. What if we model asynchronous\noperations as generators of events to be waited for? We could \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eyield\u003c/code\u003e all the\nevents from generators and still have readable and maintainable logic inside.\u003c/p\u003e\n\n\u003cp\u003eOur generators could be kept in a map, connecting the generator to the event it\nis waiting for. When the event occurs we can simply take the next event from\nthe generator and again wait for it to happen.\u003c/p\u003e\n\n\u003cp\u003eInside the generator we can have any amount of logic among \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eyield\u003c/code\u003e expressions as\nlong as there are no blocking operations. Basically, we write our logic as if it\nwas synchronous code but instead of blocking on some operation we \u003cem\u003eyield\u003c/em\u003e what we\nare waiting for.\u003c/p\u003e\n\n\u003cp\u003eLet’s rewrite the example with tasks waiting for user input using the new\napproach.\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ecounter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ewait_for_b\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"s\"\u003e\"B\"\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ewait_for_c\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"s\"\u003e\"C\"\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003etask_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eglobal\u003c/span\u003e \u003cspan class=\"n\"\u003ecounter\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecounter\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecounter\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e Processing event A, blocking on B\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003ewait_for_b\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e Processing event B, blocking on C\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003ewait_for_c\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e Processing event C, task done\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etasks\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"A\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[],\u003c/span\u003e \u003cspan class=\"s\"\u003e\"B\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[],\u003c/span\u003e \u003cspan class=\"s\"\u003e\"C\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[]}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Task queue size \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'A'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'B'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'C'\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003estrip\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"A\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003enew_task\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etask_generator\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ewaiting_for\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enew_task\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ewaiting_for\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_task\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e]):\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etask\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eremove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ewaiting_for\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ewaiting_for\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e \u003cspan class=\"nb\"\u003eStopIteration\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"k\"\u003epass\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"__main__\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e$ python yield_based_coroutines.py\nTask queue size 0\n\u0026gt; A\n0 Processing event A, blocking on B\nTask queue size 1\n\u0026gt; A\n1 Processing event A, blocking on B\nTask queue size 2\n\u0026gt; A\n2 Processing event A, blocking on B\nTask queue size 3\n\u0026gt; B\n0 Processing event B, blocking on C\nTask queue size 3\n\u0026gt; B\n1 Processing event B, blocking on C\nTask queue size 3\n\u0026gt; C\n0 Processing event C, task done\nTask queue size 2\n\u0026gt; C\n1 Processing event C, task done\nTask queue size 1\n\u0026gt; B\n2 Processing event B, blocking on C\nTask queue size 1\n\u0026gt; C\n2 Processing event C, task done\nTask queue size 0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eBy simply replacing our complicated \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eTask\u003c/code\u003e class with a short generator\nfunction and queue of tasks with a map of generators and their previously\nyielded values we manage to get very convenient, yet still very efficient\nasynchronous code. Actually, these are called coroutines!\u003c/p\u003e\n\n\u003ch2 id=\"replace-yield-with-await\"\u003eReplace yield with await\u003c/h2\u003e\n\u003cp\u003eDo you think I’m stretching reality a little bit by calling generators\ncoroutines? Let’s see. First replace all \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eyield from\u003c/code\u003e expressions with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eawait\u003c/code\u003e.\nNext add an \u003ccode class=\"language-plaintext highlighter-rouge\"\u003easync\u003c/code\u003e keyword to the generator definition. Finally wrap the\nevents we await into classes with the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e__await__\u003c/code\u003e operator method.\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ecounter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eWaitB\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003e__await__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"s\"\u003e\"B\"\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eWaitC\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003e__await__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"s\"\u003e\"C\"\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ecoroutine\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eglobal\u003c/span\u003e \u003cspan class=\"n\"\u003ecounter\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecounter\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecounter\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e Processing event A, blocking on B\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eWaitB\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e Processing event B, blocking on C\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eWaitC\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e Processing event C, task done\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etasks\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"A\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[],\u003c/span\u003e \u003cspan class=\"s\"\u003e\"B\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[],\u003c/span\u003e \u003cspan class=\"s\"\u003e\"C\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[]}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Task queue size \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'A'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'B'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'C'\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003estrip\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"A\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003enew_task\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecoroutine\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ewaiting_for\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enew_task\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ewaiting_for\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_task\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e]):\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etask\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eremove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ewaiting_for\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ewaiting_for\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e \u003cspan class=\"nb\"\u003eStopIteration\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"k\"\u003epass\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"__main__\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e$ python yield_based_coroutines.py\nTask queue size 0\n\u0026gt; A\n0 Processing event A, blocking on B\nTask queue size 1\n\u0026gt; A\n1 Processing event A, blocking on B\nTask queue size 2\n\u0026gt; A\n2 Processing event A, blocking on B\nTask queue size 3\n\u0026gt; B\n0 Processing event B, blocking on C\nTask queue size 3\n\u0026gt; B\n1 Processing event B, blocking on C\nTask queue size 3\n\u0026gt; C\n0 Processing event C, task done\nTask queue size 2\n\u0026gt; C\n1 Processing event C, task done\nTask queue size 1\n\u0026gt; B\n2 Processing event B, blocking on C\nTask queue size 1\n\u0026gt; C\n2 Processing event C, task done\nTask queue size 0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThis code still runs OK! We can have a ton of opened tasks and we won’t\nsaturate any precious resource. What is more, you wouldn’t guess that\nwe had implemented this ourselves by looking at the actual coroutine.\u003c/p\u003e\n\n\u003cp\u003eNow you can just replace \u003ccode class=\"language-plaintext highlighter-rouge\"\u003einput\u003c/code\u003e with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eselect\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eyield\u003c/code\u003e descriptors of\nactual blocking operations like reading from socket and you can create your own\nasynchronous HTTP application.\u003c/p\u003e\n\n\u003ch2 id=\"python-asyncio\"\u003ePython asyncio\u003c/h2\u003e\n\u003cp\u003eIn fact, the async/await syntax is present only since Python 3.7. Prior to 3.7\ncoroutines were actually written as generators with special annotation attached\nto them.\u003c/p\u003e\n\n\u003cp\u003ePython standard library provides us with a ready-to-use event loop to run our\ncoroutines as well as a set of convenient awaitable operations covering all the\nlowest level blocking operations we usually deal with. If you want to learn more\nabout low level async API in Python,\n\u003ca href=\"https://www.python.org/dev/peps/pep-3156/\"\u003ePEP3156\u003c/a\u003e is a great place to start.\u003c/p\u003e\n\n\u003cp\u003eFurthermore, there is a huge number of libraries making use of this low level\nAPI. They implement HTTP clients, web frameworks, database drivers and many\nothers. My favourite asynchronous libraries in Python are:\nasynchronous HTTP client \u003ca href=\"https://docs.aiohttp.org/en/stable/\"\u003eaiohttp\u003c/a\u003e,\nweb framework \u003ca href=\"https://fastapi.tiangolo.com/\"\u003eFastAPI\u003c/a\u003e and\nMongoDB driver \u003ca href=\"https://motor.readthedocs.io/en/stable/\"\u003eMotor\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eIn reality, the Python event loop runs on futures, also known as promises\nin other languages. Coroutines are implemented with tasks which rely on\nfutures. Our implementation is actually simplified as it bypasses some abstraction\nlayers. You should remember that when looking into Python sources, \nso you don’t get confused!\u003c/p\u003e\n\n\u003cp\u003eWhen I first started learning coroutines I had hard times trying to figure out\nall the strange behaviours myself. It was only the understanding of how things\nwork inside that helped me finally feel it. I hope my explanation will help you\nnot only understand how to use coroutines, but also let you gain\nconfidence and intuition about how asynchronous programming works.\u003c/p\u003e\n\n\u003cp\u003eHappy coding!\u003c/p\u003e\n","contentSnippet":"Most of applications we create are basically loops. An average program waits\nfor an event, then processes it following some business logic. Afterwards it\nbegins waiting for another event to arrive. Java Servlets work this way too.\nPopular frameworks such as Spring allow us to only care about the business logic,\nwhile the framework takes care of the application main loop.\nThe problem with blocking operations\nImagine a very simple web application whose task is to calculate currency\nexchange rates. It uses no framework, only operating system API or methods from\nyour favourite language standard library. It waits for a request with the amount,\nbase and target currencies and responds with a calculated output. In its simplest\nform it could have all the exchange rates hardcoded, so the operation is very\nfast and efficient. We can assume that such an application uses all the\navailable processing power when handling requests.\nBut in the next iteration we want our app to query another service for current\nrates instead of relying on hardcoded values. We will soon discover our app is\nspending most of its time waiting for a response from the other service.\nNetwork communication is very slow after all. Let’s assume that a simple request\ntakes at least 1ms to complete. Modern processors have clock frequencies up to\n5GHz and, provided the data and code are already cached, they are capable of\nat least one simple operation per cycle. This means we could have done at least\n5 million simple operations while waiting for the request to complete! What a\nwaste of resources!\nClassic approach with threads\nThe most obvious solution to this issue are threads. We could refactor our\napplication so that when it receives the request it passes it to a separate\nthread. This way we don’t have to worry about blocking operations in the\nbusiness logic. It is the operating system’s responsibility to allocate CPU to\nsomething meaningful while our thread is blocked waiting for the other service.\nFrom my experience this is how most of the applications work.\nUnfortunately this approach has some drawbacks as well. Threads consume a lot of\nresources and you can only create a limited number of them. Very soon you\ndiscover threads are a precious resource on their own and you can hardly afford\nthem sitting and waiting for a request to complete. You need to consider your\nthread pool allocation policy in order not to starve some part of your\napplication. Add race conditions and other concurrency related issues and it\nsuddenly gets overcomplicated.\nHow about we don’t block\nLet’s assume you decide threads are too expensive, too cumbersome or they are\nsimply not available on your platform, because for example you are writing bare\nmetal applications and there is no operating system. When we decide not to use\nthreading we have to keep in mind we cannot afford having any blocking operations\nin our application, because they are wasting our resources. Having no threads\nmeans there is no way to use time when something blocks.\nThe new idea for the program architecture is as follows:\nWait for an event to happen.\nIf the event is a new request arriving to an endpoint, then we only setup\nthe request to another service and return.\nIf the event is a response from the other service, then\nwe consume the received data and we setup a response to the original request.\nThis way we don’t have any blocking operation in our application, hence it is\nvery efficient.\nLow level async API\nLinux and similar operating systems provide us with a convenient API for many\nblocking operations. For example, the accept system call is used to get an\nincoming TCP connection from a queue of pending connections or wait for one\nto show up. You can read more about accept in the Linux manual.\nSimilarly write and read functions, defined by POSIX standard, are used\nto send and receive data over the created connection. Both can also block\nwaiting for the I/O operation to become possible. You can read more about these\nfunctions in the Linux manual: read,\nwrite.\nAs you may have already noticed, our asynchronous application only makes sense\nwhen there is only one blocking operation in the whole program. Earlier we\ncalled it “waiting for an event to happen”. In Linux we can achieve such a\nbehaviour using select or poll system calls. poll is basically a more modern\nversion of select. In practice we can provide them with a set of event\ndescriptors and they will block until one of expected events occurs. You can\nread more about these calls in the Linux manual: select,\npoll.\nSelect in Python\nThis API can be accessed in Python with a convenient wrapper provided by the\nPython standard library. It hides some complicated low level aspects of the\noperating system API which is good for this article. Read more about\nselectors module in the Python documentation.\nFirstly we can register an event we want to wait for using the register\nmethod, then we wait for any registered event to happen using the select\nmethod. Python standard library provides us with DefaultSelector which is an\nalias for the most efficient implementation on the current platform, so that we\ndon’t have to dive into low level details if we don’t want to.\nThe simplest async application\nFor the sake of simplicity of the examples I won’t use Selector and I won’t\ntry to create an async http client from scratch. There are plainly too many\nunrelated low level details. Surprisingly, event the most common GET request consists\nof numerous blocking operations. Instead, I propose the most basic and most easily\ncontrollable blocking operation there is: waiting for user input.\nLet’s replace the complicated selector with a simple input function and\nmodel events with letters. Here is how such an app could look like:\n\ndef process_a():\n    print(\"Processing event A\")\n\n\ndef process_b():\n    print(\"Processing event B\")\n\n\ndef process_c():\n    print(\"Processing event C\")\n\n\ndef app():\n    while True:\n        event = input(\"\u003e \").strip()\n\n        if event == \"A\":\n            process_a()\n        elif event == \"B\":\n            process_b()\n        elif event == \"C\":\n            process_c()\n\n\nif __name__ == \"__main__\":\n    app()\n\n\n\n$ python manual_async_simple.py\n\u003e A\nProcessing event A\n\u003e B\nProcessing event B\n\u003e C\nProcessing event C\n\n\nAs you can see we created an event loop listening for events (user input),\nthen it dispatches the event to the relevant handler. Note how the input\nfunction inside the event loop is the only blocking operation in the whole\nprogram.\nMore complex flow of execution\nAs I already mentioned, creating asynchronous applications is easy as long as\nthere is no blocking operation while processing events. The aforementioned\nexample was so simple because there weren’t any. When there is some blocking\noperation we have to split our processing logic into parts, each one ending\nwhen there is a need for some blocking operation.\nFor example imagine a Task which is triggered with event A, but then it has\nto wait for events B and C in order to complete. You need separate chunks of\ncode to process each event and some way to hold the Task state. One could\ncode it that way:\n\nclass Task:\n    COUNTER = 0\n\n    def __init__(self):\n        self.state = \"AWAITING A\"\n        self.id = Task.COUNTER\n        Task.COUNTER += 1\n\n    def process_a(self):\n        print(f\"{self.id} Processing event A, blocking on B\")\n        self.state = \"AWAITING B\"\n        return True\n\n    def process_b(self):\n        print(f\"{self.id} Processing event B, blocking on C\")\n        self.state = \"AWAITING C\"\n        return True\n\n    def process_c(self):\n        print(f\"{self.id} Processing event C, task done\")\n        self.state = \"DONE\"\n        return True\n\n    def process_new_event(self, event):\n        if self.state == \"AWAITING A\" and event == \"A\":\n            return self.process_a()\n\n        if self.state == \"AWAITING B\" and event == \"B\":\n            return self.process_b()\n\n        if self.state == \"AWAITING C\" and event == \"C\":\n            return self.process_c()\n\n        return False\n\n\ndef app():\n    tasks = []\n    while True:\n        print(f\"Task queue size {len(tasks)}\")\n        event = input(\"\u003e \").strip()\n\n        if event == \"A\":\n            tasks.append(Task())\n\n        for task in tasks:\n            if task.process_new_event(event):\n                if task.state == \"DONE\":\n                    tasks.remove(task)\n                break\n\n\nif __name__ == \"__main__\":\n    app()\n\n\n\n$ python manual_async_with_state.py\nTask queue size 0\n\u003e A\n0 Processing event A, blocking on B\nTask queue size 1\n\u003e A\n1 Processing event A, blocking on B\nTask queue size 2\n\u003e A\n2 Processing event A, blocking on B\nTask queue size 3\n\u003e B\n0 Processing event B, blocking on C\nTask queue size 3\n\u003e C\n0 Processing event C, task done\nTask queue size 2\n\u003e B\n1 Processing event B, blocking on C\nTask queue size 2\n\u003e C\n1 Processing event C, task done\nTask queue size 1\n\u003e B\n2 Processing event B, blocking on C\nTask queue size 1\n\u003e C\n2 Processing event C, task done\nTask queue size 0\n\n\nPay attention to how hard it is to extract the actual flow of the Task from\nthe example. The Task is split into three separate methods, each one\nresponsible for a part of the process. There is also a state persisted through\nconsecutive events.\nThe bright side is the code actually works. You can go through a Task\ntriggering events A, B and C, but you can also start a number of Tasks in\nparallel by sending a lot of A events in a row. You can then advance these\nTasks by sending events they are waiting for.\nWith classic threaded approach it would be most likely easy to saturate thread\npool even by hand. With our asynchronous example you can have a ton of Tasks\nin progress without any overhead, so the main goal is accomplished.\nDisadvantages of asynchronous approach\nWe learned that asynchronous approach results in an efficient application, but\nalso has some drawbacks. For starters, your code does not reflect your program\nlogic directly. Instead, you have to manually control the flow, maintain state\nand pass requests’ context around which is cumbersome and error prone.\nYour application business logic is hidden under implementation details and the\narchitecture of your solution is determined by the way you decided to deal with\nasynchronous operations. You have to stick to a set of complicated rules when\ndeveloping new features.\nIf only there were functions that could be easily suspended! We then could\ncreate our business logic in a convenient way and achieve asynchronous\nbehaviour at the same time. Instead of passing context around fragments of our\nprogram, we could just suspend the execution of a function while there is some\nblocking operation going on. That would be great, wouldn’t it?\nGenerators\nAccording to the glossary of Python official documentation a generator is a\nfunction which contains yield expressions. Each yield temporarily suspends\nprocessing, remembering the location execution state. When the generator\nresumes, it picks up where it left off. It seems generators are indeed\nfunctions that can be easily suspended. That is exactly what we were looking\nfor!\nA closer look at generators\nLet’s take a closer look at generators. How do they work and what is their\npurpose? First let’s write a function that prints Fibonacci numbers.\n\ndef print_fibonacci(i):\n    a, b = 1, 1\n    for _ in range(i):\n        print(a)\n        b, a = a + b, b\n\n\nif __name__ == \"__main__\":\n    print_fibonacci(5)\n\n\n\n$ python print_fibonnaci.py\n1\n1\n2\n3\n5\n\n\nNext, replace the call to print function with yield expressions and use our\nfunction as an iterable.\n\ndef yield_fibonacci(i):\n    a, b = 1, 1\n    for _ in range(i):\n        yield a\n        b, a = a + b, b\n\n\nif __name__ == \"__main__\":\n    for f in yield_fibonacci(5):\n        print(f)\n\n\n\n$ python yield_fibonnaci.py\n1\n1\n2\n3\n5\n\n\nAs you can see, the function became a generator when we used yield expression\ninside it. When the program reaches yield expression, the execution is suspended\nand a value is used as an output. From the outside, the generator behaves like\nan iterable or even like a stream, because the values we iterate over are not\nstored in memory. They are generated when needed.\nThere can be multiple yield expressions in the generator. When execution reaches\nthe end of the generator, the StopIteration exception is thrown, just like\nwith iterators.\nYield from and return\nYou can embed one generator inside another with yield from expression. In the\nfollowing example there is a generator using another generator twice to\ngenerate increasing and decreasing numbers.\n\ndef step_generator(start, stop, step):\n    i = 0\n    while start + step * i != stop:\n        yield start + step * i\n        i += 1\n\n\ndef wrapper_generator(start, stop):\n    yield from step_generator(start, stop, 1)\n    yield from step_generator(stop, start, -1)\n\n\nif __name__ == \"__main__\":\n    for f in wrapper_generator(0, 5):\n        print(f)\n\n\n\n$ python yield_twice.py\n0\n1\n2\n3\n4\n5\n4\n3\n2\n1\n\n\nWhat is more, a generator can also have a return statement. The returned value\nwill be used as a payload to StopIteration exception raised when the iteration\nis over or (much more usefully) it can be used as a result of yield from\nexpression.\n\ndef step_generator(start, stop, step):\n    i = 0\n    while start + step * i != stop:\n        yield start + step * i\n        i += 1\n    return i\n\n\ndef wrapper_generator():\n    count = yield from step_generator(0, 10, 2)\n    print(f\"Generated {count} numbers\")\n\n\nif __name__ == \"__main__\":\n    for f in wrapper_generator():\n        print(f)\n\n\n\n$ python returning_generator.py\n0\n2\n4\n6\n8\nGenerated 5 numbers\n\n\nExceptions inside generators\nIf an exception is raised within the generator it can be caught using the\nregular try/except statement in the wrapping generator.\n\ndef failing_generator():\n    yield 0\n    raise Exception(\"Generator error\")\n    yield 1\n\n\ndef wrapper_generator():\n    try:\n        yield from failing_generator()\n    except:\n        print(\"Something went wrong\")\n\n\nif __name__ == \"__main__\":\n    for f in wrapper_generator():\n        print(f)\n\n\n\n$ python failing_generator.py\n0\nSomething went wrong\n\n\nYou can read more about generators in the Python documentation.\nAsync code using generators\nSo we know that generators superficially behave like a stream of values.\nOn the inside they look very similar to regular functions. Their execution\nflow is easy to understand, because they work just like our standard imperative\ncode. And we know they can be easily suspended. What if we model asynchronous\noperations as generators of events to be waited for? We could yield all the\nevents from generators and still have readable and maintainable logic inside.\nOur generators could be kept in a map, connecting the generator to the event it\nis waiting for. When the event occurs we can simply take the next event from\nthe generator and again wait for it to happen.\nInside the generator we can have any amount of logic among yield expressions as\nlong as there are no blocking operations. Basically, we write our logic as if it\nwas synchronous code but instead of blocking on some operation we yield what we\nare waiting for.\nLet’s rewrite the example with tasks waiting for user input using the new\napproach.\n\ncounter = 0\n\n\ndef wait_for_b():\n    yield \"B\"\n\n\ndef wait_for_c():\n    yield \"C\"\n\n\ndef task_generator():\n    global counter\n    id = counter\n    counter += 1\n\n    print(f\"{id} Processing event A, blocking on B\")\n    yield from wait_for_b()\n    print(f\"{id} Processing event B, blocking on C\")\n    yield from wait_for_c()\n    print(f\"{id} Processing event C, task done\")\n\n\ndef app():\n    tasks = {\"A\": [], \"B\": [], \"C\": []}\n    while True:\n        print(f\"Task queue size {len(tasks['A'] + tasks['B'] + tasks['C'])}\")\n        event = input(\"\u003e \").strip()\n\n        if event == \"A\":\n            new_task = task_generator()\n            waiting_for = new_task.send(None)\n            tasks[waiting_for].append(new_task)\n\n        if len(tasks[event]):\n            task = tasks[event][0]\n            tasks[event].remove(task)\n            try:\n                waiting_for = task.send(None)\n                tasks[waiting_for].append(task)\n            except StopIteration:\n                pass\n\n\nif __name__ == \"__main__\":\n    app()\n\n\n\n$ python yield_based_coroutines.py\nTask queue size 0\n\u003e A\n0 Processing event A, blocking on B\nTask queue size 1\n\u003e A\n1 Processing event A, blocking on B\nTask queue size 2\n\u003e A\n2 Processing event A, blocking on B\nTask queue size 3\n\u003e B\n0 Processing event B, blocking on C\nTask queue size 3\n\u003e B\n1 Processing event B, blocking on C\nTask queue size 3\n\u003e C\n0 Processing event C, task done\nTask queue size 2\n\u003e C\n1 Processing event C, task done\nTask queue size 1\n\u003e B\n2 Processing event B, blocking on C\nTask queue size 1\n\u003e C\n2 Processing event C, task done\nTask queue size 0\n\n\nBy simply replacing our complicated Task class with a short generator\nfunction and queue of tasks with a map of generators and their previously\nyielded values we manage to get very convenient, yet still very efficient\nasynchronous code. Actually, these are called coroutines!\nReplace yield with await\nDo you think I’m stretching reality a little bit by calling generators\ncoroutines? Let’s see. First replace all yield from expressions with await.\nNext add an async keyword to the generator definition. Finally wrap the\nevents we await into classes with the __await__ operator method.\n\ncounter = 0\n\n\nclass WaitB:\n    def __await__(self):\n        yield \"B\"\n\n\nclass WaitC:\n    def __await__(self):\n        yield \"C\"\n\n\nasync def coroutine():\n    global counter\n    id = counter\n    counter += 1\n\n    print(f\"{id} Processing event A, blocking on B\")\n    await WaitB()\n    print(f\"{id} Processing event B, blocking on C\")\n    await WaitC()\n    print(f\"{id} Processing event C, task done\")\n\n\ndef app():\n    tasks = {\"A\": [], \"B\": [], \"C\": []}\n    while True:\n        print(f\"Task queue size {len(tasks['A'] + tasks['B'] + tasks['C'])}\")\n        event = input(\"\u003e \").strip()\n\n        if event == \"A\":\n            new_task = coroutine()\n            waiting_for = new_task.send(None)\n            tasks[waiting_for].append(new_task)\n\n        if len(tasks[event]):\n            task = tasks[event][0]\n            tasks[event].remove(task)\n            try:\n                waiting_for = task.send(None)\n                tasks[waiting_for].append(task)\n            except StopIteration:\n                pass\n\n\nif __name__ == \"__main__\":\n    app()\n\n\n\n$ python yield_based_coroutines.py\nTask queue size 0\n\u003e A\n0 Processing event A, blocking on B\nTask queue size 1\n\u003e A\n1 Processing event A, blocking on B\nTask queue size 2\n\u003e A\n2 Processing event A, blocking on B\nTask queue size 3\n\u003e B\n0 Processing event B, blocking on C\nTask queue size 3\n\u003e B\n1 Processing event B, blocking on C\nTask queue size 3\n\u003e C\n0 Processing event C, task done\nTask queue size 2\n\u003e C\n1 Processing event C, task done\nTask queue size 1\n\u003e B\n2 Processing event B, blocking on C\nTask queue size 1\n\u003e C\n2 Processing event C, task done\nTask queue size 0\n\n\nThis code still runs OK! We can have a ton of opened tasks and we won’t\nsaturate any precious resource. What is more, you wouldn’t guess that\nwe had implemented this ourselves by looking at the actual coroutine.\nNow you can just replace input with select and yield descriptors of\nactual blocking operations like reading from socket and you can create your own\nasynchronous HTTP application.\nPython asyncio\nIn fact, the async/await syntax is present only since Python 3.7. Prior to 3.7\ncoroutines were actually written as generators with special annotation attached\nto them.\nPython standard library provides us with a ready-to-use event loop to run our\ncoroutines as well as a set of convenient awaitable operations covering all the\nlowest level blocking operations we usually deal with. If you want to learn more\nabout low level async API in Python,\nPEP3156 is a great place to start.\nFurthermore, there is a huge number of libraries making use of this low level\nAPI. They implement HTTP clients, web frameworks, database drivers and many\nothers. My favourite asynchronous libraries in Python are:\nasynchronous HTTP client aiohttp,\nweb framework FastAPI and\nMongoDB driver Motor.\nIn reality, the Python event loop runs on futures, also known as promises\nin other languages. Coroutines are implemented with tasks which rely on\nfutures. Our implementation is actually simplified as it bypasses some abstraction\nlayers. You should remember that when looking into Python sources, \nso you don’t get confused!\nWhen I first started learning coroutines I had hard times trying to figure out\nall the strange behaviours myself. It was only the understanding of how things\nwork inside that helped me finally feel it. I hope my explanation will help you\nnot only understand how to use coroutines, but also let you gain\nconfidence and intuition about how asynchronous programming works.\nHappy coding!","guid":"https://blog.allegro.tech/2022/01/how-do-coroutines-work-internally-in-python.html","categories":["tech","python","async","coroutines"],"isoDate":"2022-01-23T23:00:00.000Z","thumbnail":"images/post-headers/python.png"},{"title":"Shrinking the size of a monorepo","link":"https://blog.allegro.tech/2022/01/shrinking-size-of-monorepo.html","pubDate":"Wed, 12 Jan 2022 00:00:00 +0100","authors":{"author":[{"name":["Maciej Piotrowski"],"photo":["https://blog.allegro.tech/img/authors/maciej.piotrowski.jpg"],"url":["https://blog.allegro.tech/authors/maciej.piotrowski"]}]},"content":"\u003cp\u003eThe source code of Allegro iOS app for buyers used to be divided into separate modules hosted in multiple repositories\n(polyrepo). The\nsource code was migrated to a monorepo a few years back along with the history of all repos that constituted the app.\nUpdating source code of a module on one repository could affect another module hosted on a separate repository.\nVersioning modules and propagation of dependency update led to long release process of the entire application.\nOur main\nrepository for the iOS application thus became our monorepo. After 9 years of development of the app the repo size has\ngrown\nenormously and the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003egit clone\u003c/code\u003e command became a nightmare taking too much time. We had a possibility to shrink the\nproject size during the\nmigration from an on-premise to an external git repo hosting provider.\u003c/p\u003e\n\n\u003ch2 id=\"monorepo-scale\"\u003eMonorepo scale\u003c/h2\u003e\n\n\u003ch3 id=\"general-repo-scale\"\u003eGeneral repo scale\u003c/h3\u003e\n\n\u003cp\u003eThe General scale of our old repository was as follows:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003ealmost 9 years of history with \u003cstrong\u003e91k +\u003c/strong\u003e commits\u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003e440k\u003c/strong\u003e \u003ca href=\"https://en.wikipedia.org/wiki/Binary_large_object\"\u003eBLOBs\u003c/a\u003e were stored in the repo: multiple \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.png\u003c/code\u003e and\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.jpeg\u003c/code\u003e files, 3rd-party frameworks and toolset binaries. The unpacked size of the BLOBs would add up to \u003cstrong\u003e36 GB\u003c/strong\u003e and\nthe biggest BLOB stored was \u003cstrong\u003e100+ MB\u003c/strong\u003e\u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003e680k\u003c/strong\u003e git \u003cem\u003etree\u003c/em\u003e objects\u003c/li\u003e\n  \u003cli\u003ethe unpacked repo size on the main development branch was \u003cstrong\u003e8+ GB\u003c/strong\u003e where the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.git\u003c/code\u003e dir size after a clone was\n\u003cstrong\u003e7+ GB\u003c/strong\u003e. The \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.git\u003c/code\u003e directory contained compressed \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.png\u003c/code\u003e (\u003cstrong\u003e4.5+ GB\u003c/strong\u003e 🤯) and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.pbxproj\u003c/code\u003e (\u003cstrong\u003e600+ MB\u003c/strong\u003e) files\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3 id=\"new-repo-scale\"\u003eNew repo scale\u003c/h3\u003e\n\n\u003cp\u003eAfter the migration and history rewrite we shrank the repo size to:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003cstrong\u003e71k +\u003c/strong\u003e commits\u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003e230k\u003c/strong\u003e \u003ca href=\"https://en.wikipedia.org/wiki/Binary_large_object\"\u003eBLOBs\u003c/a\u003e, where all BLOBs unpacked would add up to\n\u003cstrong\u003e1.6 GB\u003c/strong\u003e - this\nnumber also includes size of source code files, whereas assets and binaries were migrated to an external storage\u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003e455k+\u003c/strong\u003e git \u003cem\u003etree\u003c/em\u003e objects\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"how-did-we-do-it\"\u003eHow did we do it?\u003c/h2\u003e\n\n\u003cp\u003eThe history-rewrite process required proper planning and a few steps:\u003c/p\u003e\n\u003col\u003e\n  \u003cli\u003eAnalysis of the old repo contents and its history\u003c/li\u003e\n  \u003cli\u003eCreating a reproducible procedure for the history rewrite\u003c/li\u003e\n  \u003cli\u003eDry running the procedure to test out the process\u003c/li\u003e\n  \u003cli\u003ePlanning and scheduling activities necessary to migrate the repo\u003c/li\u003e\n  \u003cli\u003eProper communication about the process to stakeholders (a.k.a. developers 👩‍💻👨‍💻)\u003c/li\u003e\n  \u003cli\u003eThe actual migration\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch3 id=\"the-repo-analysis\"\u003eThe repo analysis\u003c/h3\u003e\n\n\u003cp\u003eGoals:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003efind items that can be removed from the history\u003c/li\u003e\n  \u003cli\u003eselect items that can be migrated to an external storage\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWe used tools such as \u003ca href=\"https://github.com/github/git-sizer\"\u003egit-sizer\u003c/a\u003e and\n\u003ca href=\"https://github.com/newren/git-filter-repo\"\u003egit-filter-repo tool\u003c/a\u003e to\nget information about types of files stored in the repository. If you wanted to do the same the workshops from\n\u003ca href=\"https://githubuniverse.com/professional-services-workshop-2-how-to-keep-git-monorepos-manageable/\"\u003eGitHub Universe\u003c/a\u003e and\n\u003ca href=\"https://github.com/githubuniverseworkshops/grafting-monorepos/issues/2\"\u003ethe scripts introduced there\u003c/a\u003e might be a good\nstarting point.\u003c/p\u003e\n\n\u003cp\u003eFrom the analysis we were able to select the following items for complete removal from the history:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003edeleted dirs and files\u003c/li\u003e\n  \u003cli\u003eunwanted paths: e.g. \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePods/\u003c/code\u003e, invalid symlinks causing deep nesting of paths\u003c/li\u003e\n  \u003cli\u003eunwanted history of paths: e.g. \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eVendor\u003c/code\u003e for storing 3rd party dependencies or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eToolset\u003c/code\u003e with binaries\u003c/li\u003e\n  \u003cli\u003eunwanted files: .e.g \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.pbxproj\u003c/code\u003e that can be generated by \u003ca href=\"https://github.com/yonaskolb/XcodeGen\"\u003eXcodeGen\u003c/a\u003e and their\nhistory is meaningless (\u003cstrong\u003e600+ MB\u003c/strong\u003e savings in our case), history of BLOB files such as \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.jpg\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.png\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.a\u003c/code\u003e,\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.dylib\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.pdf\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.zip\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.mp4\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.json\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWe decided to track BLOBs using \u003ca href=\"https://git-lfs.github.com/\"\u003eGit LFS (Large File Storage)\u003c/a\u003e. In our case the\nfollowing were a good use case for it:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003elarge binary files \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.jpg\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.png\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.a\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.dylib\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.pdf\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.zip\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.mp4\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.json\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003eframework binaries\u003c/li\u003e\n  \u003cli\u003etoolset binaries\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3 id=\"reproducible-procedure-and-dry-runs\"\u003eReproducible procedure and dry runs\u003c/h3\u003e\n\n\u003cp\u003eWe created a script that contained all commands that removed redundant items from the history. To remove items we used\n\u003ca href=\"https://github.com/newren/git-filter-repo\"\u003egit filter-repo\u003c/a\u003e - it‘s much more performant than git‘s built-in\n \u003ccode class=\"language-plaintext highlighter-rouge\"\u003egit filter-branch\u003c/code\u003e (do not use it!). Some examples of usage:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003egit filter-repo \u003cspan class=\"nt\"\u003e--invert-paths\u003c/span\u003e \u003cspan class=\"nt\"\u003e--path\u003c/span\u003e Pods/ \u003cspan class=\"nt\"\u003e--force\u003c/span\u003e\ngit filter-repo \u003cspan class=\"nt\"\u003e--invert-paths\u003c/span\u003e \u003cspan class=\"nt\"\u003e--paths-from-file\u003c/span\u003e remove.txt \u003cspan class=\"nt\"\u003e--force\u003c/span\u003e\ngit filter-repo \u003cspan class=\"nt\"\u003e--invert-paths\u003c/span\u003e \u003cspan class=\"nt\"\u003e--path-glob\u003c/span\u003e \u003cspan class=\"s1\"\u003e'*.pbxproj'\u003c/span\u003e \u003cspan class=\"nt\"\u003e--force\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAfter the removal we restored the most-recent version of binaries, frameworks and BLOBs to the repo and we tracked them\nwith Git LFS:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003egit lfs track \u003cspan class=\"s2\"\u003e\"*.png\"\u003c/span\u003e\ngit lfs track \u003cspan class=\"s2\"\u003e\"Vendor/SomeSDK/SomeSDK.framework/SomeSDK\"\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWe ran the script a few times to verify the output size of the repo. One crucial aspect after the run was to verify\nthat \u003cstrong\u003eall plans\u003c/strong\u003e on the CI (Continuous Integration) pass - we did it to check that the app still compiles, tests pass\nand no more files that the ones we had wanted were actually deleted.\u003c/p\u003e\n\n\u003ch3 id=\"communication\"\u003eCommunication\u003c/h3\u003e\n\n\u003cp\u003eThe crucial aspect of introducing any change is communication. It‘s good to prepare it in advance, have team members\nreview it. We used a few channels so that our devs would get important info about the migration and history rewrite\nthrough the channel that suited their working habits best (e-mails, instant messaging tool, dev forums).\u003c/p\u003e\n\n\u003ch2 id=\"some-final-thoughts\"\u003eSome final thoughts\u003c/h2\u003e\n\n\u003cp\u003eIt took a large amount of time to prepare the migration, understand the history of the repository and select proper\nitems and\nstrategies for the migration. The links here might be a good starting point if you wanted to rewrite histories of your\noverweight repos:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ca href=\"https://www.youtube.com/watch?v=bk7akV8nyAM\"\u003eGitHub Universe Workshops\u003c/a\u003e and corresponding\n\u003ca href=\"https://github.com/githubuniverseworkshops/grafting-monorepos\"\u003erepository\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"https://github.com/github/git-sizer\"\u003egit-sizer\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"https://github.com/newren/git-filter-repo\"\u003egit filter-repo\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWhen creating a plan for the rewrite, remember to have a checklist that you can use to verify outcomes and to remember\nall the steps involved in the process. If the repository migration from one provider to another hosting provider is\nrequired execute it together with the history rewrite. Plan the rewrite for a time that folks would not want to\npush code to the repo. We used Friday evening, and yes, we had to fix some issues over the weekend - not everything\nwent smoothly.\u003c/p\u003e\n\n\u003cp\u003eYou can have a copy of your old repository in READ-ONLY mode on the servers - it will serve as a \u003cstrong\u003ebackup\u003c/strong\u003e and will\ncontain the actual history.\u003c/p\u003e\n","contentSnippet":"The source code of Allegro iOS app for buyers used to be divided into separate modules hosted in multiple repositories\n(polyrepo). The\nsource code was migrated to a monorepo a few years back along with the history of all repos that constituted the app.\nUpdating source code of a module on one repository could affect another module hosted on a separate repository.\nVersioning modules and propagation of dependency update led to long release process of the entire application.\nOur main\nrepository for the iOS application thus became our monorepo. After 9 years of development of the app the repo size has\ngrown\nenormously and the git clone command became a nightmare taking too much time. We had a possibility to shrink the\nproject size during the\nmigration from an on-premise to an external git repo hosting provider.\nMonorepo scale\nGeneral repo scale\nThe General scale of our old repository was as follows:\nalmost 9 years of history with 91k + commits\n440k BLOBs were stored in the repo: multiple .png and\n.jpeg files, 3rd-party frameworks and toolset binaries. The unpacked size of the BLOBs would add up to 36 GB and\nthe biggest BLOB stored was 100+ MB\n680k git tree objects\nthe unpacked repo size on the main development branch was 8+ GB where the .git dir size after a clone was\n7+ GB. The .git directory contained compressed .png (4.5+ GB 🤯) and .pbxproj (600+ MB) files\nNew repo scale\nAfter the migration and history rewrite we shrank the repo size to:\n71k + commits\n230k BLOBs, where all BLOBs unpacked would add up to\n1.6 GB - this\nnumber also includes size of source code files, whereas assets and binaries were migrated to an external storage\n455k+ git tree objects\nHow did we do it?\nThe history-rewrite process required proper planning and a few steps:\nAnalysis of the old repo contents and its history\nCreating a reproducible procedure for the history rewrite\nDry running the procedure to test out the process\nPlanning and scheduling activities necessary to migrate the repo\nProper communication about the process to stakeholders (a.k.a. developers 👩‍💻👨‍💻)\nThe actual migration\nThe repo analysis\nGoals:\nfind items that can be removed from the history\nselect items that can be migrated to an external storage\nWe used tools such as git-sizer and\ngit-filter-repo tool to\nget information about types of files stored in the repository. If you wanted to do the same the workshops from\nGitHub Universe and\nthe scripts introduced there might be a good\nstarting point.\nFrom the analysis we were able to select the following items for complete removal from the history:\ndeleted dirs and files\nunwanted paths: e.g. Pods/, invalid symlinks causing deep nesting of paths\nunwanted history of paths: e.g. Vendor for storing 3rd party dependencies or Toolset with binaries\nunwanted files: .e.g .pbxproj that can be generated by XcodeGen and their\nhistory is meaningless (600+ MB savings in our case), history of BLOB files such as .jpg, .png, .a,\n.dylib, .pdf, .zip, .mp4, .json\nWe decided to track BLOBs using Git LFS (Large File Storage). In our case the\nfollowing were a good use case for it:\nlarge binary files .jpg, .png, .a, .dylib, .pdf, .zip, .mp4, .json\nframework binaries\ntoolset binaries\nReproducible procedure and dry runs\nWe created a script that contained all commands that removed redundant items from the history. To remove items we used\ngit filter-repo - it‘s much more performant than git‘s built-in\n git filter-branch (do not use it!). Some examples of usage:\n\ngit filter-repo --invert-paths --path Pods/ --force\ngit filter-repo --invert-paths --paths-from-file remove.txt --force\ngit filter-repo --invert-paths --path-glob '*.pbxproj' --force\n\n\n\nAfter the removal we restored the most-recent version of binaries, frameworks and BLOBs to the repo and we tracked them\nwith Git LFS:\n\ngit lfs track \"*.png\"\ngit lfs track \"Vendor/SomeSDK/SomeSDK.framework/SomeSDK\"\n\n\n\nWe ran the script a few times to verify the output size of the repo. One crucial aspect after the run was to verify\nthat all plans on the CI (Continuous Integration) pass - we did it to check that the app still compiles, tests pass\nand no more files that the ones we had wanted were actually deleted.\nCommunication\nThe crucial aspect of introducing any change is communication. It‘s good to prepare it in advance, have team members\nreview it. We used a few channels so that our devs would get important info about the migration and history rewrite\nthrough the channel that suited their working habits best (e-mails, instant messaging tool, dev forums).\nSome final thoughts\nIt took a large amount of time to prepare the migration, understand the history of the repository and select proper\nitems and\nstrategies for the migration. The links here might be a good starting point if you wanted to rewrite histories of your\noverweight repos:\nGitHub Universe Workshops and corresponding\nrepository\ngit-sizer\ngit filter-repo\nWhen creating a plan for the rewrite, remember to have a checklist that you can use to verify outcomes and to remember\nall the steps involved in the process. If the repository migration from one provider to another hosting provider is\nrequired execute it together with the history rewrite. Plan the rewrite for a time that folks would not want to\npush code to the repo. We used Friday evening, and yes, we had to fix some issues over the weekend - not everything\nwent smoothly.\nYou can have a copy of your old repository in READ-ONLY mode on the servers - it will serve as a backup and will\ncontain the actual history.","guid":"https://blog.allegro.tech/2022/01/shrinking-size-of-monorepo.html","categories":["tech","ios","git","mobile","swift","objectivec"],"isoDate":"2022-01-11T23:00:00.000Z","thumbnail":"images/post-headers/ios.png"},{"title":"Evaluating performance of time series collections","link":"https://blog.allegro.tech/2021/12/performance-evaluation-of-timeseries.html","pubDate":"Mon, 20 Dec 2021 00:00:00 +0100","authors":{"author":[{"name":["Michał Knasiecki"],"photo":["https://blog.allegro.tech/img/authors/michal.knasiecki.jpg"],"url":["https://blog.allegro.tech/authors/michal.knasiecki"]}]},"content":"\u003cp\u003eA few years ago, I was working on a new version of \u003ca href=\"https://allegro.tech\"\u003eAllegro\u003c/a\u003e purchase ratings.\nIt was a time of a pretty large revolution in the rating system when we moved this product away from our monolith, also\nintroducing quite significant changes to the concept of purchase rating itself. Replacing the system of positive, neutral\nor negative rating, we introduced an approach based on “thumbs up” and “thumbs down” as well as the option to rate several\nelements of the purchase separately: the time and cost of delivery, or products’ conformity with its description. The\nproduct-related revolution was accompanied by a major change in technology. Apart from transitioning towards the\nmicroservices architecture, we also decided to migrate data from a large relational database to MongoDB. There were many\nreasons for this decision: from the non-relational nature of our model, through the need for easier scaling, to the wish\nfor cost reduction. Upon completion of the works, we were for the most part content with the decision that we made. The\nnew solution was more user-friendly, easier to maintain and worked smoothly. The sole exception was aggregation queries,\nspecifically: determining the average of seller ratings in a specified period of time. While at the level of the 99th\npercentile times were very low, some queries were much slower. We spent a lot of time optimising both queries and the\ncode, and had to use some programming tricks to achieve satisfactory results. While we were able to solve our problems in\nthe end, the final conclusion was that the aggregation of data in large MongoDB collections is quite challenging.\u003c/p\u003e\n\n\u003ch2 id=\"to-the-rescue-time-series\"\u003eTo the rescue: Time series\u003c/h2\u003e\n\u003cp\u003eA new version of MongoDB, 5.0, has been recently launched. The list of changes included one that I found particularly\ninteresting: the time series collections. It is a method of effective storing and processing of time-ordered value series.\nA classic example for this case is measuring the temperature of air. These measurements are taken\nperiodically (for instance every hour), and their sequence forms time series. We then often review such data in an\nappropriate order, as well as calculate the maximum and minimum values, or the arithmetic mean. Therefore, in the said\ncase of use, a database must be highly efficient when saving the data, store records in a compact manner due to the\nlarge number thereof, and must quickly calculate aggregates. Although in the case of temperature readings database write\noperations are made on a regular basis, it turns out that in the case of time series it is not mandatory, and the only\nthing that truly matters is the presence of time. While reading about this topic, I instantly remembered my countless\nlate nights struggling with slow ratings aggregations. Therefore, I decided to explore this topic and see how the\nsolution works in practice.\u003c/p\u003e\n\n\u003cp\u003eBefore the release of MongoDB 5.0, the only way to efficiently process time series was to store pre-calculated\naggregates, or use a \u003ca href=\"https://www.mongodb.com/blog/post/building-with-patterns-the-bucket-pattern\"\u003ebucket pattern\u003c/a\u003e,\nwhich was obviously associated with additional work and complexity of the\ncode. Now, things have been made much easier as this additional complexity is covered by a convenient abstraction. In\nMongoDB, time series are not actual collections, but materialised views that cover physical collections. This\nabstraction is intended to simplify complicated operations based on “buckets” of documents. You can read more about the\nconcept of storing data in the new kind of collection on the MongoDB \u003ca href=\"https://www.mongodb.com/developer/how-to/new-time-series-collections/\"\u003eofficial blog\u003c/a\u003e.\nEveryone who is interested in using this solution should take a look at it. In my article, on the other hand, I would\nlike to verify whether the processing of time series is really as fast as promised by the authors.\u003c/p\u003e\n\n\u003ch2 id=\"data-preparation\"\u003eData preparation\u003c/h2\u003e\n\u003cp\u003eFor the purposes of our considerations I will use a simple document describing the rating in the form of:\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e{\n    \"timestamp\" : ISODate(\"2021-10-22T00:00:00.000Z\"),\n    \"rating\" : 2.0\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAttentive readers will immediately notice the absence of the field containing the ID of the seller whom the rating\nconcerns. It was done intentionally, otherwise I would have to\ncreate an additional index covering this field. However, I did not want to introduce any additional elements in my\nexperiment that could have any impact on the results. Let’s assume for this experiment that we are rating a\nrestaurant, not Allegro sellers, therefore all ratings in the collection concern the restaurant only.\u003c/p\u003e\n\n\u003cp\u003eNow we can create two collections storing an identical set of data. One will be a standard collection, and the other will\nbe a time series. The time series collection has to be created manually by indicating the field specifying the time label:\u003c/p\u003e\n\n\u003cdiv class=\"language-javascript highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ecoll-ts\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003etimeseries\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003etimeField\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIf you did not install Mongo 5.0 from scratch, but updated its previous version, you should make sure that\nit is set to an adequate level of compatibility. Otherwise, the above command will not create a time series collection.\nYou can check it with this command:\u003c/p\u003e\n\n\u003cdiv class=\"language-javascript highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eadminCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003egetParameter\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003efeatureCompatibilityVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIf the returned value is less than 5.0, you need to issue:\u003c/p\u003e\n\n\u003cdiv class=\"language-javascript highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eadminCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003esetFeatureCompatibilityVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e5.0\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eUpon creating a collection, it is also worth checking that a time series has actually been created:\u003c/p\u003e\n\n\u003cdiv class=\"language-javascript highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erunCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003elistCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWe look for \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\"type\" : \"timeseries\"\u003c/code\u003e entry:\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e{\n    \"name\" : \"coll-ts\",\n    \"type\" : \"timeseries\",\n    \"options\" : {\n        \"timeseries\" : {\n            \"timeField\" : \"timestamp\",\n            \"granularity\" : \"seconds\",\n            \"bucketMaxSpanSeconds\" : 3600\n        }\n    },\n    \"info\" : {\n        \"readOnly\" : false\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWe will also create the second collection manually (although it is not necessary, because it would be created with the\nfirst INSERT command). We will want to check the speed of data search based on time field, so we will create a unique index:\u003c/p\u003e\n\n\u003cdiv class=\"language-javascript highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ecoll-ord\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ecoll-ord\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\u003cspan class=\"na\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"na\"\u003eunique\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eLet’s use the following scripts to fill both collections with 10 million documents:\u003c/p\u003e\n\n\u003cdiv class=\"language-javascript highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Save as fill-ts.js\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ebulk\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ecoll-ts\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003einitializeUnorderedBulkOp\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e2021-10-22T00:00:00.000Z\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ebulk\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n       \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetTime\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e60000\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n       \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003erating\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efloor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erandom\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ebulk\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-javascript highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Save as fill-ord.js\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ebulk\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ecoll-ord\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003einitializeUnorderedBulkOp\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e2021-10-22T00:00:00.000Z\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ebulk\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n       \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetTime\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e60000\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n       \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003erating\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efloor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erandom\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ebulk\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIt is worth to measure the execution time of scripts to compare write times to both collections. For this purpose I use\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etime\u003c/code\u003e command and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003emongo\u003c/code\u003e command-line client, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003etest\u003c/code\u003e is the name of my database.\nTo avoid network latency I perform the measurements on my laptop with a local instance of MongoDB version 5.0.3 running.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003etime \u003c/span\u003emongo \u003cspan class=\"nb\"\u003etest \u003c/span\u003efill-ts.js\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003etime \u003c/span\u003emongo \u003cspan class=\"nb\"\u003etest \u003c/span\u003efill-ord.js\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAs expected, the filling of the time series collection was faster: 3:30,11 vs 4:39,48. Such a difference can be essential\nif our system performs many write operations in a short period of time. At the very beginning of our experiments\ncollection of a new type comes to the forefront.\u003c/p\u003e\n\n\u003cp\u003eNow when our collections already contain data, we can take a look at the size of files. On the\n\u003ca href=\"https://docs.mongodb.com/manual/core/timeseries-collections/\"\u003emanual page\u003c/a\u003e we can read that:\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eCompared to normal collections, storing time series data in time series collections improves query efficiency and\nreduces the disk usage\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eLet’s find out how true that is.\u003c/p\u003e\n\n\u003ch2 id=\"a-closer-look-at-the-data\"\u003eA closer look at the data\u003c/h2\u003e\n\n\u003cp\u003eIn the first place, it is worth making sure that documents in both collections look the same:\u003c/p\u003e\n\n\u003cdiv class=\"language-javascript highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ecoll-ts\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e({}).\u003c/span\u003e\u003cspan class=\"nx\"\u003elimit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ecoll-ord\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e({}).\u003c/span\u003e\u003cspan class=\"nx\"\u003elimit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eBoth documents should be similar to this one:\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e{\n    \"timestamp\" : ISODate(\"2021-10-22T00:00:00.000Z\"),\n    \"_id\" : ObjectId(\"6184126fc42d1ab73d5208e4\"),\n    \"rating\" : 2.0\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe documents have the same schema. In addition, the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e_id\u003c/code\u003e key was automatically generated in both cases, although our\nfilling script did not contain them.\u003c/p\u003e\n\n\u003cp\u003eLet’s move on to indexes now and use the commands: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003edb.getCollection('coll-ord').getIndexes()\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003edb.getCollection('coll-ts').getIndexes()\u003c/code\u003e\nto get the indexes of both collections.\u003c/p\u003e\n\n\u003cp\u003eThe normal collection has two indexes, one that was created automatically for the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e_id\u003c/code\u003e key and the one that we created manually:\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e// coll-ord:\n[\n    {\n        \"v\" : 2,\n        \"key\" : {\n            \"_id\" : 1\n        },\n        \"name\" : \"_id_\"\n    },\n    {\n        \"v\" : 2,\n        \"key\" : {\n            \"timestamp\" : 1.0\n        },\n        \"name\" : \"timestamp_1\",\n        \"unique\" : true\n    }\n]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWhat is interesting is that the time series collection has no index at all:\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e// coll-ts:\n[]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe lack of the index for the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e_id\u003c/code\u003e key of\ncourse means that, by default, the time series collection will have to perform the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eCOLLSCAN\u003c/code\u003e operation if we want to\nsearch documents based on \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e_id\u003c/code\u003e. The index is probably missing simply to save disc space and storage time,\nstemming from the assumption that the time series collections are mainly used to search based on time. The lack of\nthe index for the timestamp field is much more surprising. Does it mean that time-based searches in time series will\nalso cause \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eCOLLCSAN\u003c/code\u003e and work slowly? The answer to this question can be found in the documentation:\u003c/p\u003e\n\u003cblockquote\u003e\n  \u003cp\u003eThe internal index for a time series collection is not displayed\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eSo, there actually is an index, but it is different from those created manually, and even from indexes created\nautomatically for the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e_id\u003c/code\u003e key.\nAs I wrote in another \u003ca href=\"/2021/10/comparing-mongodb-composite-indexes.html\"\u003epost\u003c/a\u003e, indexes are not all the\nsame, so it’s worth taking a closer look at this one. Let’s check the query execution plans:\u003c/p\u003e\n\n\u003cdiv class=\"language-javascript highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ecoll-ord\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eISODate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e2021-10-22T00:00:00.000Z\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)}).\u003c/span\u003e\u003cspan class=\"nx\"\u003eexplain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eexecutionStats\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ecoll-ts\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eISODate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e2021-10-22T00:00:00.000Z\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)}).\u003c/span\u003e\u003cspan class=\"nx\"\u003eexplain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eexecutionStats\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e//coll-ord\n\"winningPlan\" : {\n    \"stage\" : \"FETCH\",\n    \"inputStage\" : {\n        \"stage\" : \"IXSCAN\",\n        \"keyPattern\" : {\n            \"timestamp\" : 1.0\n        }\n    },\n    \"indexName\" : \"timestamp_1\",\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e//coll-ts\n\"winningPlan\" : {\n    \"stage\" : \"COLLSCAN\",\n    \"filter\" : {\n        \"$and\" : [\n            {\n                \"_id\" : {\n                    \"$lte\" : ObjectId(\"6171ff00ffffffffffffffff\")\n                }\n            },\n            {\n                \"_id\" : {\n                    \"$gte\" : ObjectId(\"6171f0f00000000000000000\")\n                }\n            },\n            {\n                \"control.max.timestamp\" : {\n                    \"$_internalExprGte\" : ISODate(\"2021-10-22T00:00:00.000Z\")\n                }\n            },\n            {\n                \"control.min.timestamp\" : {\n                    \"$_internalExprLte\" : ISODate(\"2021-10-22T00:00:00.000Z\")\n                }\n            }\n        ]\n    },\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIt turns out that while in the case of the regular collection the plan shows the use of the index, in the time series\ncollection we see the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eCOLLSCAN\u003c/code\u003e operation. It doesn’t mean that this operation is slow, though. The execution times of\nboth operations were similar. We will move on to a more detailed time comparison in a moment; for now we should only\nnote that the hidden index in the time series collection follows specific rules, it is not only invisible, but it also\ncannot be seen in the execution plan, although it clearly affects the speed of the search.\u003c/p\u003e\n\n\u003cp\u003eAnd what happens if we add sorting?\u003c/p\u003e\n\n\u003cdiv class=\"language-javascript highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ecoll-ts\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e({}).\u003c/span\u003e\u003cspan class=\"nx\"\u003esort\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\u003cspan class=\"na\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e{\n \"ok\" : 0,\n \"errmsg\" : \"PlanExecutor error during aggregation :: caused by :: Sort exceeded memory limit of 104857600 bytes,\n but did not opt in to external sorting.\",\n \"code\" : 292,\n \"codeName\" : \"QueryExceededMemoryLimitNoDiskUseAllowed\"\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eSurprise! The internal index for the time series collection does not have a sorting feature. This means that if we add\nthe sort clause to our query, the operation will take very long, or even fail because of exceeding the memory\nlimit. It is surprising because I did not find any information on this in the documentation. Therefore, if we plan to\nsort our data based on the field with time, we will need to index this field manually. It means, of\ncourse, that the benefits stemming from a lower disc usage and faster saving times will unfortunately diminish.\u003c/p\u003e\n\n\u003cp\u003eSince we are talking about the use of disc space, let’s check the data size:\u003c/p\u003e\n\n\u003cdiv class=\"language-javascript highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ecoll-ts\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003estats\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ecoll-ord\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003estats\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWe will compare several fields:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003esize\u003c/code\u003e: data size before the compression,\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003estorageSize\u003c/code\u003e: size of data after the compression,\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etotalIndexSize\u003c/code\u003e: size of indexes,\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etotalSize\u003c/code\u003e: total size of data and indexes.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eResults are gathered in the table below (in bytes, space is thousand separator):\u003c/p\u003e\n\n\u003ctable\u003e\n  \u003cthead\u003e\n    \u003ctr\u003e\n      \u003cth\u003eField\u003c/th\u003e\n      \u003cth style=\"text-align: right\"\u003eNormal collection\u003c/th\u003e\n      \u003cth style=\"text-align: right\"\u003eTime series collection\u003c/th\u003e\n      \u003cth style=\"text-align: center\"\u003eDiff\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003ctd\u003esize\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e570 000 000\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e747 855 228\u003c/td\u003e\n      \u003ctd style=\"text-align: center\"\u003e+ 31%\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd\u003estorageSize\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e175 407 104\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e119 410 688\u003c/td\u003e\n      \u003ctd style=\"text-align: center\"\u003e-31%\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd\u003etotalIndexSize\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e232 701 952\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e0\u003c/td\u003e\n      \u003ctd style=\"text-align: center\"\u003e-100%\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd\u003etotalSize\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e408 109 056\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e119 410 688\u003c/td\u003e\n      \u003ctd style=\"text-align: center\"\u003e-70%\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eAs you can see, raw data of the time series collection may take up more space, but after their compression the new-type\ncollection turns out to be the winner in the size-on-disc category. After adding the size of indexes created in the\nregular collection, the difference will be even greater. Therefore, we must admit that the way time series data are\npacked on the disc is impressive.\u003c/p\u003e\n\n\u003cp\u003eNow it’s time to compare query execution times for both collections.\u003c/p\u003e\n\n\u003ch2 id=\"speed-is-all-that-matters\"\u003eSpeed is all that matters\u003c/h2\u003e\n\n\u003cp\u003eUsing the script below (saved as \u003ccode class=\"language-plaintext highlighter-rouge\"\u003egen-find.sh\u003c/code\u003e file), I generated two files containing commands getting documents from\nboth collections based on the\ntime label:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e#!/bin/bash\u003c/span\u003e\n\u003cspan class=\"nv\"\u003eRANDOM\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e42\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"o\"\u003e((\u003c/span\u003ei \u003cspan class=\"o\"\u003e=\u003c/span\u003e 1\u003cspan class=\"p\"\u003e;\u003c/span\u003e i \u0026lt;\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e i++ \u003cspan class=\"o\"\u003e))\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003edo\n  \u003c/span\u003e\u003cspan class=\"nv\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$((\u003c/span\u003e \u003cspan class=\"nv\"\u003e$RANDOM\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e10000000\u003c/span\u003e\u003cspan class=\"k\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"nv\"\u003et\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e$(\u003c/span\u003e\u003cspan class=\"nb\"\u003edate\u003c/span\u003e \u003cspan class=\"nt\"\u003e-jv\u003c/span\u003e +\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ex\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003eM \u003cspan class=\"nt\"\u003e-f\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"%Y-%m-%d %H:%M:%S\"\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"2021-10-22 0:00:00\"\u003c/span\u003e +%Y-%m-%dT%H:%M:%S\u003cspan class=\"si\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"db.getCollection('\u003c/span\u003e\u003cspan class=\"nv\"\u003e$2\u003c/span\u003e\u003cspan class=\"s2\"\u003e').find({'timestamp' : new ISODate('\u003c/span\u003e\u003cspan class=\"nv\"\u003e$t\u003c/span\u003e\u003cspan class=\"s2\"\u003e')})\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003edone\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e find-\u003cspan class=\"nv\"\u003e$2\u003c/span\u003e.js\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe script takes as parameters: the number of queries, and the name of the collection that we want to search. I\ngenerated a million queries (it may take some time depending on your hardware, so you can start with a lower amount of\nqueries):\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e./gen-find.sh 1000000 coll-ts\n./gen-find.sh 1000000 coll-ord\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThen I checked the time of the execution of both query sequences using the command:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003etime \u003c/span\u003emongo \u003cspan class=\"nb\"\u003etest \u003c/span\u003efind-coll-ts.js\n\u003cspan class=\"nb\"\u003etime \u003c/span\u003emongo \u003cspan class=\"nb\"\u003etest \u003c/span\u003efind-coll-ord.js\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe standard collection was a bit slower: 16,854 for \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ecoll-ord\u003c/code\u003e vs 16,038 for \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ecoll-ts\u003c/code\u003e. Although the difference is small,\nanother point goes to time series: simple search is slightly faster than in the case of the regular collection.\u003c/p\u003e\n\n\u003cp\u003eBut we’re yet to discuss the most interesting part. Time series is primarily used for quick aggregate counting. Let’s\nsee what the comparison looks like when calculating the arithmetic mean in a given time interval.\u003c/p\u003e\n\n\u003cp\u003eThe script below (saved as \u003ccode class=\"language-plaintext highlighter-rouge\"\u003egen-aggregate.sh\u003c/code\u003e) creates a list of queries calculating the arithmetic mean of ratings for\na randomly selected six-hour interval:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e#!/bin/bash\u003c/span\u003e\n\u003cspan class=\"nv\"\u003eRANDOM\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e42\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"o\"\u003e((\u003c/span\u003ei \u003cspan class=\"o\"\u003e=\u003c/span\u003e 1\u003cspan class=\"p\"\u003e;\u003c/span\u003e i \u0026lt;\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e i++ \u003cspan class=\"o\"\u003e))\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003edo\n  \u003c/span\u003e\u003cspan class=\"nv\"\u003ex1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$((\u003c/span\u003e \u003cspan class=\"nv\"\u003e$RANDOM\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e10000000\u003c/span\u003e\u003cspan class=\"k\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"nv\"\u003ex2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$((\u003c/span\u003e x1 \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e360\u003c/span\u003e\u003cspan class=\"k\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"nv\"\u003et1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e$(\u003c/span\u003e\u003cspan class=\"nb\"\u003edate\u003c/span\u003e \u003cspan class=\"nt\"\u003e-jv\u003c/span\u003e +\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ex1\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003eM \u003cspan class=\"nt\"\u003e-f\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"%Y-%m-%d %H:%M:%S\"\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"2021-10-22 0:00:00\"\u003c/span\u003e +%Y-%m-%dT%H:%M:%S\u003cspan class=\"si\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"nv\"\u003et2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e$(\u003c/span\u003e\u003cspan class=\"nb\"\u003edate\u003c/span\u003e \u003cspan class=\"nt\"\u003e-jv\u003c/span\u003e +\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ex2\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003eM \u003cspan class=\"nt\"\u003e-f\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"%Y-%m-%d %H:%M:%S\"\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"2021-10-22 0:00:00\"\u003c/span\u003e +%Y-%m-%dT%H:%M:%S\u003cspan class=\"si\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"db.getCollection('\u003c/span\u003e\u003cspan class=\"nv\"\u003e$2\u003c/span\u003e\u003cspan class=\"s2\"\u003e').aggregate([{ \u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"s2\"\u003ematch: { \"\u003c/span\u003etimestamp\u003cspan class=\"s2\"\u003e\" : \"\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n    \u003cspan class=\"s2\"\u003e\"{\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"s2\"\u003egte:new ISODate('\u003c/span\u003e\u003cspan class=\"nv\"\u003e$t1\u003c/span\u003e\u003cspan class=\"s2\"\u003e'),\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"s2\"\u003elt:new ISODate('\u003c/span\u003e\u003cspan class=\"nv\"\u003e$t2\u003c/span\u003e\u003cspan class=\"s2\"\u003e')} } },\"\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n    \u003cspan class=\"s2\"\u003e\"{ \u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"s2\"\u003egroup: { _id: null, avg: { \u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"s2\"\u003eavg: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\"\\$\u003c/span\u003e\u003cspan class=\"s2\"\u003erating\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e } } }])\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003edone\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e aggregate-\u003cspan class=\"nv\"\u003e$2\u003c/span\u003e-\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e.js\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eI prepared three script sets with: 10K, 50K and 100K queries for both collections:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e./gen-aggregate.sh 10000 coll-ts\n./gen-aggregate.sh 50000 coll-ts\n./gen-aggregate.sh 100000 coll-ts\n\n./gen-aggregate.sh 10000 coll-ord\n./gen-aggregate.sh 50000 coll-ord\n./gen-aggregate.sh 100000 coll-ord\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eI made the measurements using following commands:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003etime \u003c/span\u003emongo \u003cspan class=\"nb\"\u003etest \u003c/span\u003eaggregate-coll-ts-10000.js\n\u003cspan class=\"nb\"\u003etime \u003c/span\u003emongo \u003cspan class=\"nb\"\u003etest \u003c/span\u003eaggregate-coll-ord-10000.js\n\n\u003cspan class=\"nb\"\u003etime \u003c/span\u003emongo \u003cspan class=\"nb\"\u003etest \u003c/span\u003eaggregate-coll-ts-50000.js\n\u003cspan class=\"nb\"\u003etime \u003c/span\u003emongo \u003cspan class=\"nb\"\u003etest \u003c/span\u003eaggregate-coll-ord-50000.js\n\n\u003cspan class=\"nb\"\u003etime \u003c/span\u003emongo \u003cspan class=\"nb\"\u003etest \u003c/span\u003eaggregate-coll-ts-100000.js\n\u003cspan class=\"nb\"\u003etime \u003c/span\u003emongo \u003cspan class=\"nb\"\u003etest \u003c/span\u003eaggregate-coll-ord-100000.js\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe results are shown in the table below:\u003c/p\u003e\n\n\u003ctable\u003e\n  \u003cthead\u003e\n    \u003ctr\u003e\n      \u003cth style=\"text-align: center\"\u003eNumber of queries\u003c/th\u003e\n      \u003cth style=\"text-align: right\"\u003eNormal collection [min:sec]\u003c/th\u003e\n      \u003cth style=\"text-align: right\"\u003eTime series [min:sec]\u003c/th\u003e\n      \u003cth style=\"text-align: center\"\u003eDiff\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: center\"\u003e10000\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e0:21,947\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e0:16,835\u003c/td\u003e\n      \u003ctd style=\"text-align: center\"\u003e-23%\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: center\"\u003e50000\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e1:37,02\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e1:11,18\u003c/td\u003e\n      \u003ctd style=\"text-align: center\"\u003e-26%\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: center\"\u003e100000\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e4:33,29\u003c/td\u003e\n      \u003ctd style=\"text-align: right\"\u003e2:21,37\u003c/td\u003e\n      \u003ctd style=\"text-align: center\"\u003e-48%\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eAlthough there are far fewer queries this time than in the previous experiment, the differences in times are much\ngreater. It clearly proves that time series collections are indeed spreading their wings when we want to use aggregation\nqueries and have been developed mainly for this purpose. The reason is probably the sequential way of writing data,\nwhich shows a noticeable improvement when running ranged queries. The results clearly show also how much of an impact\nquery performance can have on an element that often doesn’t get the adequate attention: proper modelling the data.\u003c/p\u003e\n\n\u003ch2 id=\"limitations\"\u003eLimitations\u003c/h2\u003e\n\n\u003cp\u003eOf course, time series collections also have their limitations and should not be used as a golden hammer.\nWe have already mentioned the first one — the lack of the primary key index. It stems from the assumption\nthat searches will be primarily based on time, so there is no point in creating an index that will be useful for very\nfew people. Of course, we can create this index ourselves.\u003c/p\u003e\n\n\u003cp\u003eIt is also not possible to sort by time field, which is another inconvenience. If we want to have\nsorting queries, we have to create an additional index.\u003c/p\u003e\n\n\u003cp\u003eAlthough these two missing indexes may seem to be an easy thing to fix, we must remember that it involves additional use\nof disc space as well as longer indexing time during the saving of the document, which means that the benefits\nstemming from the use of time series will be somewhat reduced.\u003c/p\u003e\n\n\u003cp\u003eThe third, and perhaps most import limitation is the immutability of the document. Once saved, documents cannot be\nupdated or deleted. The only way to delete data is to use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003edrop()\u003c/code\u003e command or to define retention for the collection\nusing the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eexpireAfterSeconds\u003c/code\u003e parameter, which, like TTL indexes, will automatically delete documents certain time\nafter creation.\u003c/p\u003e\n\n\u003cp\u003eThe lack of possibility to manipulate the saved documents will probably be the main reason why programmers will be\nhesitant to use time series. We should mention, however, that the authors of MongoDB will probably add the possibility\nto edit and delete documents in the future:\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eWhile we know some of these limitations may be impactful to your current use case, we promise we’re working on this\nright now and would love for you to provide your feedback!\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2 id=\"summary\"\u003eSummary\u003c/h2\u003e\n\u003cp\u003eAdding the ability to store time series in MongoDB is a step in the right direction. First tests show that in certain\ncases the new type of collections really does work better than the regular ones. They use less disc space, are faster at\nsaving and searching by the time. But high performance always comes at a cost, in this case: the cost of reduced flexibility.\nTherefore, the final decision to use time series should be preceded by an analysis of\nadvantages and disadvantages of both in particular cases. We should also hope that the authors of the database are\nworking on improving it and will soon eliminate most limitations.\u003c/p\u003e\n","contentSnippet":"A few years ago, I was working on a new version of Allegro purchase ratings.\nIt was a time of a pretty large revolution in the rating system when we moved this product away from our monolith, also\nintroducing quite significant changes to the concept of purchase rating itself. Replacing the system of positive, neutral\nor negative rating, we introduced an approach based on “thumbs up” and “thumbs down” as well as the option to rate several\nelements of the purchase separately: the time and cost of delivery, or products’ conformity with its description. The\nproduct-related revolution was accompanied by a major change in technology. Apart from transitioning towards the\nmicroservices architecture, we also decided to migrate data from a large relational database to MongoDB. There were many\nreasons for this decision: from the non-relational nature of our model, through the need for easier scaling, to the wish\nfor cost reduction. Upon completion of the works, we were for the most part content with the decision that we made. The\nnew solution was more user-friendly, easier to maintain and worked smoothly. The sole exception was aggregation queries,\nspecifically: determining the average of seller ratings in a specified period of time. While at the level of the 99th\npercentile times were very low, some queries were much slower. We spent a lot of time optimising both queries and the\ncode, and had to use some programming tricks to achieve satisfactory results. While we were able to solve our problems in\nthe end, the final conclusion was that the aggregation of data in large MongoDB collections is quite challenging.\nTo the rescue: Time series\nA new version of MongoDB, 5.0, has been recently launched. The list of changes included one that I found particularly\ninteresting: the time series collections. It is a method of effective storing and processing of time-ordered value series.\nA classic example for this case is measuring the temperature of air. These measurements are taken\nperiodically (for instance every hour), and their sequence forms time series. We then often review such data in an\nappropriate order, as well as calculate the maximum and minimum values, or the arithmetic mean. Therefore, in the said\ncase of use, a database must be highly efficient when saving the data, store records in a compact manner due to the\nlarge number thereof, and must quickly calculate aggregates. Although in the case of temperature readings database write\noperations are made on a regular basis, it turns out that in the case of time series it is not mandatory, and the only\nthing that truly matters is the presence of time. While reading about this topic, I instantly remembered my countless\nlate nights struggling with slow ratings aggregations. Therefore, I decided to explore this topic and see how the\nsolution works in practice.\nBefore the release of MongoDB 5.0, the only way to efficiently process time series was to store pre-calculated\naggregates, or use a bucket pattern,\nwhich was obviously associated with additional work and complexity of the\ncode. Now, things have been made much easier as this additional complexity is covered by a convenient abstraction. In\nMongoDB, time series are not actual collections, but materialised views that cover physical collections. This\nabstraction is intended to simplify complicated operations based on “buckets” of documents. You can read more about the\nconcept of storing data in the new kind of collection on the MongoDB official blog.\nEveryone who is interested in using this solution should take a look at it. In my article, on the other hand, I would\nlike to verify whether the processing of time series is really as fast as promised by the authors.\nData preparation\nFor the purposes of our considerations I will use a simple document describing the rating in the form of:\n\n{\n    \"timestamp\" : ISODate(\"2021-10-22T00:00:00.000Z\"),\n    \"rating\" : 2.0\n}\n\n\nAttentive readers will immediately notice the absence of the field containing the ID of the seller whom the rating\nconcerns. It was done intentionally, otherwise I would have to\ncreate an additional index covering this field. However, I did not want to introduce any additional elements in my\nexperiment that could have any impact on the results. Let’s assume for this experiment that we are rating a\nrestaurant, not Allegro sellers, therefore all ratings in the collection concern the restaurant only.\nNow we can create two collections storing an identical set of data. One will be a standard collection, and the other will\nbe a time series. The time series collection has to be created manually by indicating the field specifying the time label:\n\ndb.createCollection(\"coll-ts\", { timeseries: { timeField: \"timestamp\" } } )\n\n\nIf you did not install Mongo 5.0 from scratch, but updated its previous version, you should make sure that\nit is set to an adequate level of compatibility. Otherwise, the above command will not create a time series collection.\nYou can check it with this command:\n\ndb.adminCommand( { getParameter: 1, featureCompatibilityVersion: 1 } )\n\n\nIf the returned value is less than 5.0, you need to issue:\n\ndb.adminCommand( { setFeatureCompatibilityVersion: \"5.0\" } )\n\n\nUpon creating a collection, it is also worth checking that a time series has actually been created:\n\ndb.runCommand( { listCollections: 1.0 } )\n\n\nWe look for \"type\" : \"timeseries\" entry:\n\n{\n    \"name\" : \"coll-ts\",\n    \"type\" : \"timeseries\",\n    \"options\" : {\n        \"timeseries\" : {\n            \"timeField\" : \"timestamp\",\n            \"granularity\" : \"seconds\",\n            \"bucketMaxSpanSeconds\" : 3600\n        }\n    },\n    \"info\" : {\n        \"readOnly\" : false\n    }\n}\n\n\nWe will also create the second collection manually (although it is not necessary, because it would be created with the\nfirst INSERT command). We will want to check the speed of data search based on time field, so we will create a unique index:\n\ndb.createCollection(\"coll-ord\")\ndb.getCollection('coll-ord').createIndex({timestamp: 1}, {unique: true})\n\n\nLet’s use the following scripts to fill both collections with 10 million documents:\n\n// Save as fill-ts.js\nvar bulk = db.getCollection(\"coll-ts\").initializeUnorderedBulkOp();\nvar startTime = new Date(\"2021-10-22T00:00:00.000Z\")\nfor (let i = 0; i \u003c 10000000; i++) {\n    bulk.insert({\n       \"timestamp\": new Date(startTime.getTime() + i * 60000),\n       \"rating\": Math.floor(1 + Math.random() * 4)\n    })\n}\nbulk.execute();\n\n\n\n// Save as fill-ord.js\nvar bulk = db.getCollection(\"coll-ord\").initializeUnorderedBulkOp();\nvar startTime = new Date(\"2021-10-22T00:00:00.000Z\")\nfor (let i = 0; i \u003c 10000000; i++) {\n    bulk.insert({\n       \"timestamp\": new Date(startTime.getTime() + i * 60000),\n       \"rating\": Math.floor(1 + Math.random() * 4)\n    })\n}\nbulk.execute();\n\n\nIt is worth to measure the execution time of scripts to compare write times to both collections. For this purpose I use\ntime command and mongo command-line client, test is the name of my database.\nTo avoid network latency I perform the measurements on my laptop with a local instance of MongoDB version 5.0.3 running.\n\ntime mongo test fill-ts.js\n\n\n\ntime mongo test fill-ord.js\n\n\nAs expected, the filling of the time series collection was faster: 3:30,11 vs 4:39,48. Such a difference can be essential\nif our system performs many write operations in a short period of time. At the very beginning of our experiments\ncollection of a new type comes to the forefront.\nNow when our collections already contain data, we can take a look at the size of files. On the\nmanual page we can read that:\nCompared to normal collections, storing time series data in time series collections improves query efficiency and\nreduces the disk usage\nLet’s find out how true that is.\nA closer look at the data\nIn the first place, it is worth making sure that documents in both collections look the same:\n\ndb.getCollection('coll-ts').find({}).limit(1)\ndb.getCollection('coll-ord').find({}).limit(1)\n\n\nBoth documents should be similar to this one:\n\n{\n    \"timestamp\" : ISODate(\"2021-10-22T00:00:00.000Z\"),\n    \"_id\" : ObjectId(\"6184126fc42d1ab73d5208e4\"),\n    \"rating\" : 2.0\n}\n\n\nThe documents have the same schema. In addition, the _id key was automatically generated in both cases, although our\nfilling script did not contain them.\nLet’s move on to indexes now and use the commands: db.getCollection('coll-ord').getIndexes() and db.getCollection('coll-ts').getIndexes()\nto get the indexes of both collections.\nThe normal collection has two indexes, one that was created automatically for the _id key and the one that we created manually:\n\n// coll-ord:\n[\n    {\n        \"v\" : 2,\n        \"key\" : {\n            \"_id\" : 1\n        },\n        \"name\" : \"_id_\"\n    },\n    {\n        \"v\" : 2,\n        \"key\" : {\n            \"timestamp\" : 1.0\n        },\n        \"name\" : \"timestamp_1\",\n        \"unique\" : true\n    }\n]\n\n\nWhat is interesting is that the time series collection has no index at all:\n\n// coll-ts:\n[]\n\n\nThe lack of the index for the _id key of\ncourse means that, by default, the time series collection will have to perform the COLLSCAN operation if we want to\nsearch documents based on _id. The index is probably missing simply to save disc space and storage time,\nstemming from the assumption that the time series collections are mainly used to search based on time. The lack of\nthe index for the timestamp field is much more surprising. Does it mean that time-based searches in time series will\nalso cause COLLCSAN and work slowly? The answer to this question can be found in the documentation:\nThe internal index for a time series collection is not displayed\nSo, there actually is an index, but it is different from those created manually, and even from indexes created\nautomatically for the _id key.\nAs I wrote in another post, indexes are not all the\nsame, so it’s worth taking a closer look at this one. Let’s check the query execution plans:\n\ndb.getCollection('coll-ord').find({\"timestamp\" : ISODate(\"2021-10-22T00:00:00.000Z\")}).explain('executionStats')\ndb.getCollection('coll-ts').find({\"timestamp\" : ISODate(\"2021-10-22T00:00:00.000Z\")}).explain('executionStats')\n\n\n\n//coll-ord\n\"winningPlan\" : {\n    \"stage\" : \"FETCH\",\n    \"inputStage\" : {\n        \"stage\" : \"IXSCAN\",\n        \"keyPattern\" : {\n            \"timestamp\" : 1.0\n        }\n    },\n    \"indexName\" : \"timestamp_1\",\n}\n\n\n\n//coll-ts\n\"winningPlan\" : {\n    \"stage\" : \"COLLSCAN\",\n    \"filter\" : {\n        \"$and\" : [\n            {\n                \"_id\" : {\n                    \"$lte\" : ObjectId(\"6171ff00ffffffffffffffff\")\n                }\n            },\n            {\n                \"_id\" : {\n                    \"$gte\" : ObjectId(\"6171f0f00000000000000000\")\n                }\n            },\n            {\n                \"control.max.timestamp\" : {\n                    \"$_internalExprGte\" : ISODate(\"2021-10-22T00:00:00.000Z\")\n                }\n            },\n            {\n                \"control.min.timestamp\" : {\n                    \"$_internalExprLte\" : ISODate(\"2021-10-22T00:00:00.000Z\")\n                }\n            }\n        ]\n    },\n}\n\n\nIt turns out that while in the case of the regular collection the plan shows the use of the index, in the time series\ncollection we see the COLLSCAN operation. It doesn’t mean that this operation is slow, though. The execution times of\nboth operations were similar. We will move on to a more detailed time comparison in a moment; for now we should only\nnote that the hidden index in the time series collection follows specific rules, it is not only invisible, but it also\ncannot be seen in the execution plan, although it clearly affects the speed of the search.\nAnd what happens if we add sorting?\n\ndb.getCollection('coll-ts').find({}).sort({timestamp: 1})\n\n\n\n{\n \"ok\" : 0,\n \"errmsg\" : \"PlanExecutor error during aggregation :: caused by :: Sort exceeded memory limit of 104857600 bytes,\n but did not opt in to external sorting.\",\n \"code\" : 292,\n \"codeName\" : \"QueryExceededMemoryLimitNoDiskUseAllowed\"\n}\n\n\nSurprise! The internal index for the time series collection does not have a sorting feature. This means that if we add\nthe sort clause to our query, the operation will take very long, or even fail because of exceeding the memory\nlimit. It is surprising because I did not find any information on this in the documentation. Therefore, if we plan to\nsort our data based on the field with time, we will need to index this field manually. It means, of\ncourse, that the benefits stemming from a lower disc usage and faster saving times will unfortunately diminish.\nSince we are talking about the use of disc space, let’s check the data size:\n\ndb.getCollection('coll-ts').stats()\ndb.getCollection('coll-ord').stats()\n\n\nWe will compare several fields:\nsize: data size before the compression,\nstorageSize: size of data after the compression,\ntotalIndexSize: size of indexes,\ntotalSize: total size of data and indexes.\nResults are gathered in the table below (in bytes, space is thousand separator):\nField\n      Normal collection\n      Time series collection\n      Diff\n    \nsize\n      570 000 000\n      747 855 228\n      + 31%\n    \nstorageSize\n      175 407 104\n      119 410 688\n      -31%\n    \ntotalIndexSize\n      232 701 952\n      0\n      -100%\n    \ntotalSize\n      408 109 056\n      119 410 688\n      -70%\n    \nAs you can see, raw data of the time series collection may take up more space, but after their compression the new-type\ncollection turns out to be the winner in the size-on-disc category. After adding the size of indexes created in the\nregular collection, the difference will be even greater. Therefore, we must admit that the way time series data are\npacked on the disc is impressive.\nNow it’s time to compare query execution times for both collections.\nSpeed is all that matters\nUsing the script below (saved as gen-find.sh file), I generated two files containing commands getting documents from\nboth collections based on the\ntime label:\n\n#!/bin/bash\nRANDOM=42\nfor ((i = 1; i \u003c= $1; i++ ));\ndo\n  x=$(( $RANDOM % 10000000))\n  t=$(date -jv +${x}M -f \"%Y-%m-%d %H:%M:%S\" \"2021-10-22 0:00:00\" +%Y-%m-%dT%H:%M:%S)\n  echo \"db.getCollection('$2').find({'timestamp' : new ISODate('$t')})\"\ndone \u003e\u003e find-$2.js\n\n\nThe script takes as parameters: the number of queries, and the name of the collection that we want to search. I\ngenerated a million queries (it may take some time depending on your hardware, so you can start with a lower amount of\nqueries):\n\n./gen-find.sh 1000000 coll-ts\n./gen-find.sh 1000000 coll-ord\n\n\nThen I checked the time of the execution of both query sequences using the command:\n\ntime mongo test find-coll-ts.js\ntime mongo test find-coll-ord.js\n\n\nThe standard collection was a bit slower: 16,854 for coll-ord vs 16,038 for coll-ts. Although the difference is small,\nanother point goes to time series: simple search is slightly faster than in the case of the regular collection.\nBut we’re yet to discuss the most interesting part. Time series is primarily used for quick aggregate counting. Let’s\nsee what the comparison looks like when calculating the arithmetic mean in a given time interval.\nThe script below (saved as gen-aggregate.sh) creates a list of queries calculating the arithmetic mean of ratings for\na randomly selected six-hour interval:\n\n#!/bin/bash\nRANDOM=42\nfor ((i = 1; i \u003c= $1; i++ ));\ndo\n  x1=$(( $RANDOM % 10000000))\n  x2=$(( x1 + 360))\n  t1=$(date -jv +${x1}M -f \"%Y-%m-%d %H:%M:%S\" \"2021-10-22 0:00:00\" +%Y-%m-%dT%H:%M:%S)\n  t2=$(date -jv +${x2}M -f \"%Y-%m-%d %H:%M:%S\" \"2021-10-22 0:00:00\" +%Y-%m-%dT%H:%M:%S)\n  echo \"db.getCollection('$2').aggregate([{ \\$match: { \"timestamp\" : \" \\\n    \"{\\$gte:new ISODate('$t1'),\\$lt:new ISODate('$t2')} } },\" \\\n    \"{ \\$group: { _id: null, avg: { \\$avg: \\\"\\$rating\\\" } } }])\"\ndone \u003e\u003e aggregate-$2-$1.js\n\n\nI prepared three script sets with: 10K, 50K and 100K queries for both collections:\n\n./gen-aggregate.sh 10000 coll-ts\n./gen-aggregate.sh 50000 coll-ts\n./gen-aggregate.sh 100000 coll-ts\n\n./gen-aggregate.sh 10000 coll-ord\n./gen-aggregate.sh 50000 coll-ord\n./gen-aggregate.sh 100000 coll-ord\n\n\nI made the measurements using following commands:\n\ntime mongo test aggregate-coll-ts-10000.js\ntime mongo test aggregate-coll-ord-10000.js\n\ntime mongo test aggregate-coll-ts-50000.js\ntime mongo test aggregate-coll-ord-50000.js\n\ntime mongo test aggregate-coll-ts-100000.js\ntime mongo test aggregate-coll-ord-100000.js\n\n\n\nThe results are shown in the table below:\nNumber of queries\n      Normal collection [min:sec]\n      Time series [min:sec]\n      Diff\n    \n10000\n      0:21,947\n      0:16,835\n      -23%\n    \n50000\n      1:37,02\n      1:11,18\n      -26%\n    \n100000\n      4:33,29\n      2:21,37\n      -48%\n    \nAlthough there are far fewer queries this time than in the previous experiment, the differences in times are much\ngreater. It clearly proves that time series collections are indeed spreading their wings when we want to use aggregation\nqueries and have been developed mainly for this purpose. The reason is probably the sequential way of writing data,\nwhich shows a noticeable improvement when running ranged queries. The results clearly show also how much of an impact\nquery performance can have on an element that often doesn’t get the adequate attention: proper modelling the data.\nLimitations\nOf course, time series collections also have their limitations and should not be used as a golden hammer.\nWe have already mentioned the first one — the lack of the primary key index. It stems from the assumption\nthat searches will be primarily based on time, so there is no point in creating an index that will be useful for very\nfew people. Of course, we can create this index ourselves.\nIt is also not possible to sort by time field, which is another inconvenience. If we want to have\nsorting queries, we have to create an additional index.\nAlthough these two missing indexes may seem to be an easy thing to fix, we must remember that it involves additional use\nof disc space as well as longer indexing time during the saving of the document, which means that the benefits\nstemming from the use of time series will be somewhat reduced.\nThe third, and perhaps most import limitation is the immutability of the document. Once saved, documents cannot be\nupdated or deleted. The only way to delete data is to use drop() command or to define retention for the collection\nusing the expireAfterSeconds parameter, which, like TTL indexes, will automatically delete documents certain time\nafter creation.\nThe lack of possibility to manipulate the saved documents will probably be the main reason why programmers will be\nhesitant to use time series. We should mention, however, that the authors of MongoDB will probably add the possibility\nto edit and delete documents in the future:\nWhile we know some of these limitations may be impactful to your current use case, we promise we’re working on this\nright now and would love for you to provide your feedback!\nSummary\nAdding the ability to store time series in MongoDB is a step in the right direction. First tests show that in certain\ncases the new type of collections really does work better than the regular ones. They use less disc space, are faster at\nsaving and searching by the time. But high performance always comes at a cost, in this case: the cost of reduced flexibility.\nTherefore, the final decision to use time series should be preceded by an analysis of\nadvantages and disadvantages of both in particular cases. We should also hope that the authors of the database are\nworking on improving it and will soon eliminate most limitations.","guid":"https://blog.allegro.tech/2021/12/performance-evaluation-of-timeseries.html","categories":["tech","mongodb","performance","time series"],"isoDate":"2021-12-19T23:00:00.000Z","thumbnail":"images/post-headers/mongodb.png"}],"jobs":[{"id":"743999785422127","name":"Research Engineer - Machine Learning (Reinforcement Learning)","uuid":"229d607a-333b-431b-9abe-78137730f5fd","refNumber":"REF2881V","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-11-08T09:56:17.000Z","location":{"city":"Warszawa, Kraków, Poznań, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572821","label":"IT - Machine Learning"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"606235fe248e6f5bea0815ed","fieldLabel":"Katowice","valueId":"185eb5a9-b884-4ee8-8ebc-0e5f3e852b27","valueLabel":"Tak"},{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"606235bcefbac7156d6a470a","fieldLabel":"Łódź","valueId":"7d33e23d-3fa7-4d7d-86ae-7d7caff54fa9","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"6165609ee6b46b6506c66b63","fieldLabel":"Gdańsk","valueId":"cde0f8e7-5c9d-4d78-9f5c-e1c17ee499a8","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"(Archive) IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15788e4b0614667d59733","fieldLabel":"Błonie","valueId":"25f6cb8c-81b3-434a-93ec-6dc851d5808d","valueLabel":"Nie"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"64818201-cdba-422e-8e8c-8ec633b0d327","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572821","valueLabel":"IT - Machine Learning"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"61656102a169ed164d546c31","fieldLabel":"Lublin","valueId":"02d54f00-48b9-4669-b7b3-10c16ac4bada","valueLabel":"Tak"},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"ML, Machine Learning, Python, Deep Learning, AI, Artificial Intelligence"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999785422127","creator":{"name":"Maciej Matwiejczyk"},"language":{"code":"en","label":"English","labelNative":"English (US)"}},{"id":"743999785421861","name":"Research Engineer - Machine Learning (Ranking and Recommendations)","uuid":"a6b2b59e-28e3-4bfa-89ab-b13ab97f06c8","refNumber":"REF2990T","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-11-08T09:54:52.000Z","location":{"city":"Warszawa, Poznań, Kraków, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572821","label":"IT - Machine Learning"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"60cb31a9c87e511299a3a050","fieldLabel":"Department II","valueId":"b8a4596e-d9ce-42bb-8de5-10995e9ccf99","valueLabel":"IT - Machine Learning"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"(Archive) IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15788e4b0614667d59733","fieldLabel":"Błonie","valueId":"25f6cb8c-81b3-434a-93ec-6dc851d5808d","valueLabel":"Nie"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"64818201-cdba-422e-8e8c-8ec633b0d327","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572821","valueLabel":"IT - Machine Learning"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"ML, AI, Ranking, Research, Machine Learning"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999785421861","creator":{"name":"Maciej Matwiejczyk"},"language":{"code":"en","label":"English","labelNative":"English (US)"}},{"id":"743999779448775","name":"Research Engineer - Machine Learning (Reinforcement Learning)","uuid":"c8e577cc-c93a-43e7-8e73-e430989798d7","refNumber":"REF2881V","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-10-14T10:29:36.000Z","location":{"city":"Warszawa, Kraków, Poznań, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572821","label":"IT - Machine Learning"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"606235fe248e6f5bea0815ed","fieldLabel":"Katowice","valueId":"185eb5a9-b884-4ee8-8ebc-0e5f3e852b27","valueLabel":"Tak"},{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"606235bcefbac7156d6a470a","fieldLabel":"Łódź","valueId":"7d33e23d-3fa7-4d7d-86ae-7d7caff54fa9","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"6165609ee6b46b6506c66b63","fieldLabel":"Gdańsk","valueId":"cde0f8e7-5c9d-4d78-9f5c-e1c17ee499a8","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"(Archive) IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15788e4b0614667d59733","fieldLabel":"Błonie","valueId":"25f6cb8c-81b3-434a-93ec-6dc851d5808d","valueLabel":"Nie"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"64818201-cdba-422e-8e8c-8ec633b0d327","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572821","valueLabel":"IT - Machine Learning"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"61656102a169ed164d546c31","fieldLabel":"Lublin","valueId":"02d54f00-48b9-4669-b7b3-10c16ac4bada","valueLabel":"Tak"},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"ML, Machine Learning, Python, Deep Learning, AI, Artificial Intelligence"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999779448775","creator":{"name":"Maciej Matwiejczyk"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999779448676","name":"Research Engineer - Machine Learning (Ranking and Recommendations)","uuid":"7cb35dfc-f53c-4b51-81ac-61b683060f4c","refNumber":"REF2990T","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-10-14T10:29:00.000Z","location":{"city":"Warszawa, Poznań, Kraków, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572821","label":"IT - Machine Learning"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"60cb31a9c87e511299a3a050","fieldLabel":"Department II","valueId":"b8a4596e-d9ce-42bb-8de5-10995e9ccf99","valueLabel":"IT - Machine Learning"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"(Archive) IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15788e4b0614667d59733","fieldLabel":"Błonie","valueId":"25f6cb8c-81b3-434a-93ec-6dc851d5808d","valueLabel":"Nie"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"64818201-cdba-422e-8e8c-8ec633b0d327","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572821","valueLabel":"IT - Machine Learning"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"ML, AI, Ranking, Research, Machine Learning"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999779448676","creator":{"name":"Maciej Matwiejczyk"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999777347284","name":"Team Leader (Java/Kotlin) - Consumer Technology Experience","uuid":"c9925a03-d2ab-4d63-804e-0c06f0b0e87a","refNumber":"REF2902G","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-10-04T08:03:28.000Z","location":{"city":"Warszawa, Kraków, Poznań","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572770","label":"IT - Software Development"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"executive","label":"Executive"},"customField":[{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"a6765624-e047-4a26-9481-9621086d8b96","valueLabel":"Nie"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"(Archive) IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15788e4b0614667d59733","fieldLabel":"Błonie","valueId":"25f6cb8c-81b3-434a-93ec-6dc851d5808d","valueLabel":"Nie"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"31873284-1e97-427d-8918-6ce504344351","valueLabel":"Nie"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572770","valueLabel":"IT - Software Development"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999777347284","creator":{"name":"Aleksandra Sotowska"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}}],"events":[{"created":1644580206000,"duration":7200000,"id":"283913049","name":"Allegro Tech Live #25 - Przetwarzanie danych w ogromnej skali","date_in_series_pattern":false,"status":"upcoming","time":1645722000000,"local_date":"2022-02-24","local_time":"18:00","updated":1644932864000,"utc_offset":3600000,"waitlist_count":0,"yes_rsvp_count":86,"is_online_event":false,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/283913049/","description":"!!! REJESTRACJA NA WYDARZENIE!!! https://app.evenea.pl/event/allegro-tech-live-25/ Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Kiedyś spotykaliśmy się w naszych biurach,…","visibility":"public","member_pay_fee":false},{"created":1642501324000,"duration":5400000,"id":"283335598","name":"Allegro Tech Live #24 - Automatyzacja i usługi biznesowe w Allegro","date_in_series_pattern":false,"status":"past","time":1643907600000,"local_date":"2022-02-03","local_time":"18:00","updated":1643914840000,"utc_offset":3600000,"waitlist_count":0,"yes_rsvp_count":56,"venue":{"id":26906060,"name":"Online event","repinned":false,"country":"","localized_country_name":""},"is_online_event":true,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/283335598/","description":"REJESTRACJA NA WYDARZENIE ---\u0026gt; https://app.evenea.pl/event/allegro-tech-live-24/ Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Kiedyś spotykaliśmy się w naszych biurach,…","how_to_find_us":"https://app.evenea.pl/event/allegro-tech-live-24/","visibility":"public","member_pay_fee":false},{"created":1638356820000,"duration":7200000,"id":"282421464","name":"Allegro Tech Labs #9 Online: System design workshop","date_in_series_pattern":false,"status":"past","time":1639501200000,"local_date":"2021-12-14","local_time":"18:00","updated":1639514166000,"utc_offset":3600000,"waitlist_count":0,"yes_rsvp_count":62,"venue":{"id":26906060,"name":"Online event","repinned":false,"country":"","localized_country_name":""},"is_online_event":true,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/282421464/","description":"❗NA WYDARZENIE OBOWIĄZUJE REJESTRACJA: Liczba miejsc jest organiczona: https://app.evenea.pl/event/allegro-tech-labs-9/ ❗ To już druga edycja naszych warsztatów System Design Workshop! Czy chcesz poznać tajniki tworzenia systemów?…","how_to_find_us":"https://app.evenea.pl/event/allegro-tech-labs-9/","visibility":"public","member_pay_fee":false},{"created":1635344914000,"duration":7200000,"id":"281692274","name":"Allegro Tech Live #23 - Przygody backendowców w C#","date_in_series_pattern":false,"status":"past","time":1636045200000,"local_date":"2021-11-04","local_time":"18:00","updated":1636056125000,"utc_offset":3600000,"waitlist_count":0,"yes_rsvp_count":29,"is_online_event":false,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/281692274/","description":"------ Rejestracja: https://app.evenea.pl/event/allegro-tech-live-23/------- Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Kiedyś spotykaliśmy się w naszych biurach, a teraz…","visibility":"public","member_pay_fee":false}],"podcasts":[{"title":"S02E12 - Piotr Betkier - Rola architekta w Allegro","link":"https://podcast.allegro.tech/rola_architekta_w_allegro/","pubDate":"Wed, 16 Jun 2021 00:00:00 GMT","content":"Od kodowania do tworzenia strategii technicznej... Jak wygląda rola architekta w Allegro? Ile takich osób pracuje w naszej firmie i dlaczego ta rola jest tak różnorodna? Czym jest Andamio i jak rozwijamy naszą platformę – o tym wszystkim opowie Piotr Betkier – Inżynier, Architekt Platformy Technicznej w Allegro oraz twórca piosenek o IT :)","contentSnippet":"Od kodowania do tworzenia strategii technicznej... Jak wygląda rola architekta w Allegro? Ile takich osób pracuje w naszej firmie i dlaczego ta rola jest tak różnorodna? Czym jest Andamio i jak rozwijamy naszą platformę – o tym wszystkim opowie Piotr Betkier – Inżynier, Architekt Platformy Technicznej w Allegro oraz twórca piosenek o IT :)","guid":"https://podcast.allegro.tech/rola_architekta_w_allegro/","isoDate":"2021-06-16T00:00:00.000Z"},{"title":"S02E11 - Piotr Michoński - Infrastruktura Allegro","link":"https://podcast.allegro.tech/infrastruktura_Allegro/","pubDate":"Tue, 01 Jun 2021 00:00:00 GMT","content":"Jak jest zbudowane środowisko uruchomienia aplikacji Allegro? Jak działają serwerownie firmy i ile ich potrzeba, a które elementy Allegro działają w chmurze publicznej? Jak przebiegała transformacja w Allegro i co zmieniało się przez lata? Jak wzrost biznesu wpływa na wielkość infrastruktury i jak infrastruktura Allegro odczuła przyjście pandemii? O tym, a także o rozwoju liderów technologii w Allegro oraz o historii powstania dżingla do naszych podcastów, opowie Piotr Michoński - menadżer Zespołów tworzących infrastrukturę Allegro.","contentSnippet":"Jak jest zbudowane środowisko uruchomienia aplikacji Allegro? Jak działają serwerownie firmy i ile ich potrzeba, a które elementy Allegro działają w chmurze publicznej? Jak przebiegała transformacja w Allegro i co zmieniało się przez lata? Jak wzrost biznesu wpływa na wielkość infrastruktury i jak infrastruktura Allegro odczuła przyjście pandemii? O tym, a także o rozwoju liderów technologii w Allegro oraz o historii powstania dżingla do naszych podcastów, opowie Piotr Michoński - menadżer Zespołów tworzących infrastrukturę Allegro.","guid":"https://podcast.allegro.tech/infrastruktura_Allegro/","isoDate":"2021-06-01T00:00:00.000Z"},{"title":"S02E10 - Dariusz Eliasz - Praca architekta ekosystemu big data w Allegro","link":"https://podcast.allegro.tech/praca_architekta_ekosystemu_big_data_w_Allegro/","pubDate":"Thu, 20 May 2021 00:00:00 GMT","content":"Jak wygląda praca architekta ekosystemu big data w Allegro? Jakie zadania realizuje nasz zespół odpowiedzialny za narzędzia i infrastrukturę dla przetwarzania danych? Kiedy możemy mówić o dużych danych i ile petabajtów przetwarza Allegro? Skąd pochodzą dane Allegro i dlaczego jest ich tak dużo oraz z jakiego powodu dopiero teraz przenosimy się do chmury? O tym wszystkim opowie zdobywca statuetki Allegro Tech Hero - Dariusz Eliasz – Team Manager \u0026 Platform Architect w Allegro.","contentSnippet":"Jak wygląda praca architekta ekosystemu big data w Allegro? Jakie zadania realizuje nasz zespół odpowiedzialny za narzędzia i infrastrukturę dla przetwarzania danych? Kiedy możemy mówić o dużych danych i ile petabajtów przetwarza Allegro? Skąd pochodzą dane Allegro i dlaczego jest ich tak dużo oraz z jakiego powodu dopiero teraz przenosimy się do chmury? O tym wszystkim opowie zdobywca statuetki Allegro Tech Hero - Dariusz Eliasz – Team Manager \u0026 Platform Architect w Allegro.","guid":"https://podcast.allegro.tech/praca_architekta_ekosystemu_big_data_w_Allegro/","isoDate":"2021-05-20T00:00:00.000Z"},{"title":"S02E09 - Bartosz Gałek - Od inżyniera do lidera w Allegro","link":"https://podcast.allegro.tech/od_inzyniera_do_lidera_w_allegro/","pubDate":"Thu, 06 May 2021 00:00:00 GMT","content":"Czym jest Opbox i jakie wyzwania przed nim stoją? Jak w Allegro angażujemy się w rozwój kultury Open Source? Ile mamy projektów na GitHubie i jak świętujemy Hacktoberfest? W jaki sposób można rozwinąć się od inżyniera do lidera? Na te pytania w najnowszym Allegro Tech Podcast odpowie Bartek Gałek, Team Leader w Allegro.","contentSnippet":"Czym jest Opbox i jakie wyzwania przed nim stoją? Jak w Allegro angażujemy się w rozwój kultury Open Source? Ile mamy projektów na GitHubie i jak świętujemy Hacktoberfest? W jaki sposób można rozwinąć się od inżyniera do lidera? Na te pytania w najnowszym Allegro Tech Podcast odpowie Bartek Gałek, Team Leader w Allegro.","guid":"https://podcast.allegro.tech/od_inzyniera_do_lidera_w_allegro/","isoDate":"2021-05-06T00:00:00.000Z"}]},"__N_SSG":true},"page":"/","query":{},"buildId":"7NeFYoooUiLSluflm6XKZ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>