<!DOCTYPE html><html lang="pl"><head><meta charSet="utf-8"/><link rel="prefetch" href="https://allegrotechio.disqus.com/count.js"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="description" content="Allegro Tech to miejsce, w którym nasi inżynierowie dzielą się wiedzą oraz case study z wybranych projektów w firmie - w formie artykułów, podcastów oraz eventów."/><title>Allegro Tech</title><meta property="og:site_name" content="allegro.tech"/><meta property="og:title" content="allegro.tech"/><meta property="og:url" content="https://allegro.tech"/><meta property="og:type" content="site"/><meta property="og:image" content="https://allegro.tech/images/allegro-tech.png"/><link rel="shortcut icon" href="favicon.ico"/><link rel="canonical" href="https://allegro.tech" itemProp="url"/><link rel="preload" href="images/splash.jpg" as="image"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1M1FJ5PXWW"></script><script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    gtag('js', new Date());
                    gtag('config', 'G-1M1FJ5PXWW');
                </script><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/f90f7240cef95199c2b1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f90f7240cef95199c2b1.css" data-n-g=""/><link rel="preload" href="/_next/static/css/bab806b57e265845b5ec.css" as="style"/><link rel="stylesheet" href="/_next/static/css/bab806b57e265845b5ec.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-fb76148cfcfb42ca18eb.js" defer=""></script><script src="/_next/static/chunks/framework-0441fae7fd130f37dee1.js" defer=""></script><script src="/_next/static/chunks/main-a220dc5659b4b5150eca.js" defer=""></script><script src="/_next/static/chunks/pages/_app-7f59b0547fcfd7939f7d.js" defer=""></script><script src="/_next/static/chunks/682-97b125405c243e8ea066.js" defer=""></script><script src="/_next/static/chunks/pages/index-46ee502816c6919ffdf5.js" defer=""></script><script src="/_next/static/k1XFheZIDivoZwZGeY7HS/_buildManifest.js" defer=""></script><script src="/_next/static/k1XFheZIDivoZwZGeY7HS/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card Header_navbar__2vWRp m-color-bg_card"><nav class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-display-flex m-flex-justify-between m-flex-items-center"><a href="/"><img src="images/logo.svg" alt="Allegro Tech" width="205" height="45"/></a><div><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0 m-display-flex@lg m-display-none"><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://blog.allegro.tech">Blog</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://ml.allegro.tech">Machine Learning</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://podcast.allegro.tech">Podcast</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://github.com/Allegro">Open Source</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://www.meetup.com/allegrotech/events">Wydarzenia</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://praca.allegro.pl">Praca</a></li></ul><button class="m-display-none@lg m-height_40 m-line-height_40 m-border-style-top_none m-border-style-right_none m-border-style-bottom_none m-border-style-left_none m-border-radius-top-left_2 m-border-radius-top-right_2 m-border-radius-bottom-left_2 m-border-radius-bottom-right_2 m-cursor_pointer m-overflow_hidden m-appearance_none m-padding-left_4 m-padding-right_4 m-padding-top_4 m-padding-bottom_4 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button" style="background:transparent" aria-label="Otwórz menu"><img src="https://assets.allegrostatic.com/metrum/icon/menu-23e046bf68.svg" alt="" class="m-icon" width="32" height="32"/></button></div></nav></header><div class="Header_hero__n5PN5"><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-display-flex m-flex-column m-flex-justify-end Header_image__15JNc"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-color-bg_desk"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text  m-font-weight_100 m-font-size_32 m-font-size_43_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125">O nas</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Allegro to jedna z najbardziej zaawansowanych technologicznie firm w naszej części Europy. Allegro to również ponad 1000 specjalistów IT, różnych specjalizacji, rozwijających nasz serwis. Unikatowa skala i złożoność problemów, które rozwiązujemy na co dzień, dają nam możliwość rozwoju przy bardzo różnorodnych projektach. Allegro Tech to miejsce, w którym nasi inżynierowie dzielą się wiedzą oraz case study z wybranych projektów w firmie – w formie artykułów, podcastów oraz eventów.</p></div></div></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Blog</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2021/12/clean-architecture-story.html" title="Clean Architecture Story"><img width="388" src="images/post-headers/default.jpg" alt="Clean Architecture Story" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2021/12/clean-architecture-story.html" title="Clean Architecture Story" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Clean Architecture Story</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">8 dni temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/tech">#<!-- -->tech</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/architecture">#<!-- -->architecture</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/clean-architecture">#<!-- -->clean-architecture</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/ddd">#<!-- -->ddd</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/kotlin">#<!-- -->kotlin</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">The Clean Architecture concept has been
around for some time and keeps surfacing in one place or another, yet it is not widely adopted. In this…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__1CeVw"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Michał Kowalcze" src="https://blog.allegro.tech/img/authors/michal.kowalcze.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/michal.kowalcze">Michał Kowalcze</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2021/12/clean-architecture-story.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2021/12/clean-architecture-story.html">przejdź do wpisu</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2021/12/choose-your-skills.html" title="Which skills to choose in order to be more valuable"><img width="388" src="images/post-headers/default.jpg" alt="Which skills to choose in order to be more valuable" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2021/12/choose-your-skills.html" title="Which skills to choose in order to be more valuable" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Which skills to choose in order to be more valuable</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">12 dni temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/tech">#<!-- -->tech</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/education">#<!-- -->education</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/skills">#<!-- -->skills</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/startup">#<!-- -->startup</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/lean startup">#<!-- -->lean startup</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/mvp">#<!-- -->mvp</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">At some point in your career, you realize that it’s time to try to advance through the hierarchy. You think you are
doing a good job.…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__1CeVw"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Piotr Prusiński" src="https://blog.allegro.tech/img/authors/piotr.prusinski.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/piotr.prusinski">Piotr Prusiński</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2021/12/choose-your-skills.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2021/12/choose-your-skills.html">przejdź do wpisu</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2021/11/micronaut.html" title="Moving towards Micronaut"><img width="388" src="images/post-headers/default.jpg" alt="Moving towards Micronaut" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2021/11/micronaut.html" title="Moving towards Micronaut" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Moving towards Micronaut</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">29 dni temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/tech">#<!-- -->tech</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/backend">#<!-- -->backend</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/performance">#<!-- -->performance</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/micronaut">#<!-- -->micronaut</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/kotlin">#<!-- -->kotlin</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/graalvm">#<!-- -->graalvm</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">Micronaut is one of the new application frameworks that have recently sprung up. It promises
low memory usage and faster application startup. At Allegro we decided…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__1CeVw"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Konrad Kamiński" src="https://blog.allegro.tech/img/authors/konrad.kaminski.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/konrad.kaminski">Konrad Kamiński</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2021/11/micronaut.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2021/11/micronaut.html">przejdź do wpisu</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2021/11/oauth-rate-limiting.html" title="OAuth rate-limiting"><img width="388" src="images/post-headers/default.jpg" alt="OAuth rate-limiting" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2021/11/oauth-rate-limiting.html" title="OAuth rate-limiting" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">OAuth rate-limiting</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">około miesiąc temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/tech">#<!-- -->tech</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/architecture">#<!-- -->architecture</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/oauth">#<!-- -->oauth</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/microservices">#<!-- -->microservices</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">Every e-commerce platform needs some kind of central authorization system. At Allegro we use
OAuth and have our own implementation that stays true to the
RFC. Allegro…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__1CeVw"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:2"><img alt="Marek Walkowiak" src="https://blog.allegro.tech/img/authors/marek.walkowiak.jpg" class="MuiAvatar-img" width="32" height="32"/></div><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Daniel Faderski" src="https://blog.allegro.tech/img/authors/daniel.faderski.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/marek.walkowiak">Marek Walkowiak…</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2021/11/oauth-rate-limiting.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2021/11/oauth-rate-limiting.html">przejdź do wpisu</a></div></article></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech">Zobacz więcej wpisów</a></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Podcasty</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/rola_architekta_w_allegro" title="Rola architekta w Allegro"><img src="images/podcast.png" alt="Rola architekta w Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/rola_architekta_w_allegro" title="Rola architekta w Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Rola architekta w Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">6 miesięcy temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Od kodowania do tworzenia strategii technicznej... Jak wygląda rola architekta w Allegro? Ile takich osób pracuje w naszej firmie i dlaczego ta rola jest tak różnorodna? Czym jest Andamio i jak rozwijamy naszą platformę – o tym wszystkim opowie Piotr Betkier – Inżynier, Architekt Platformy Technicznej w Allegro oraz twórca piosenek o IT :)</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/rola_architekta_w_allegro">Posłuchaj odcinka</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/infrastruktura_Allegro" title="Infrastruktura Allegro"><img src="images/podcast.png" alt="Infrastruktura Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/infrastruktura_Allegro" title="Infrastruktura Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Infrastruktura Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">7 miesięcy temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Jak jest zbudowane środowisko uruchomienia aplikacji Allegro? Jak działają serwerownie firmy i ile ich potrzeba, a które elementy Allegro działają w chmurze publicznej? Jak przebiegała transformacja w Allegro i co zmieniało się przez lata? Jak wzrost biznesu wpływa na wielkość infrastruktury i jak infrastruktura Allegro odczuła przyjście pandemii? O tym, a także o rozwoju liderów technologii w Allegro oraz o historii powstania dżingla do naszych podcastów, opowie Piotr Michoński - menadżer Zespołów tworzących infrastrukturę Allegro.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/infrastruktura_Allegro">Posłuchaj odcinka</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/praca_architekta_ekosystemu_big_data_w_Allegro" title="Praca architekta ekosystemu big data w Allegro"><img src="images/podcast.png" alt="Praca architekta ekosystemu big data w Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/praca_architekta_ekosystemu_big_data_w_Allegro" title="Praca architekta ekosystemu big data w Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Praca architekta ekosystemu big data w Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">7 miesięcy temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Jak wygląda praca architekta ekosystemu big data w Allegro? Jakie zadania realizuje nasz zespół odpowiedzialny za narzędzia i infrastrukturę dla przetwarzania danych? Kiedy możemy mówić o dużych danych i ile petabajtów przetwarza Allegro? Skąd pochodzą dane Allegro i dlaczego jest ich tak dużo oraz z jakiego powodu dopiero teraz przenosimy się do chmury? O tym wszystkim opowie zdobywca statuetki Allegro Tech Hero - Dariusz Eliasz – Team Manager &amp; Platform Architect w Allegro.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/praca_architekta_ekosystemu_big_data_w_Allegro">Posłuchaj odcinka</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/od_inzyniera_do_lidera_w_allegro" title="Od inżyniera do lidera w Allegro"><img src="images/podcast.png" alt="Od inżyniera do lidera w Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/od_inzyniera_do_lidera_w_allegro" title="Od inżyniera do lidera w Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Od inżyniera do lidera w Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">8 miesięcy temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Czym jest Opbox i jakie wyzwania przed nim stoją? Jak w Allegro angażujemy się w rozwój kultury Open Source? Ile mamy projektów na GitHubie i jak świętujemy Hacktoberfest? W jaki sposób można rozwinąć się od inżyniera do lidera? Na te pytania w najnowszym Allegro Tech Podcast odpowie Bartek Gałek, Team Leader w Allegro.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/od_inzyniera_do_lidera_w_allegro">Posłuchaj odcinka</a></div></article></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech">Zobacz więcej podcastów</a></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Wydarzenia</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/282421464/" title="Allegro Tech Labs #9 Online: System design workshop" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Labs #9 Online: System design workshop"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/282421464/" title="Allegro Tech Labs #9 Online: System design workshop" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Labs #9 Online: System design workshop</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">6 dni temu<!-- -->, Online event</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">❗NA WYDARZENIE OBOWIĄZUJE REJESTRACJA: Liczba miejsc jest organiczona: https://app.evenea.pl/event/allegro-tech-labs-9/ ❗ To już druga edycja naszych warsztatów System Design Workshop! Czy chcesz poznać tajniki tworzenia systemów?…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/282421464/">Szczegóły</a></article></div></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/281692274/" title="Allegro Tech Live #23 - Przygody backendowców w C#" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Live #23 - Przygody backendowców w C#"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/281692274/" title="Allegro Tech Live #23 - Przygody backendowców w C#" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Live #23 - Przygody backendowców w C#</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">około 2 miesiące temu</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">------ Rejestracja: https://app.evenea.pl/event/allegro-tech-live-23/------- Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Kiedyś spotykaliśmy się w naszych biurach, a teraz…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/281692274/">Szczegóły</a></article></div></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/281441586/" title="Allegro Tech Live #22 - Jak wygląda codzienność lidera w Allegro?" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Live #22 - Jak wygląda codzienność lidera w Allegro?"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/281441586/" title="Allegro Tech Live #22 - Jak wygląda codzienność lidera w Allegro?" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Live #22 - Jak wygląda codzienność lidera w Allegro?</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">około 2 miesiące temu<!-- -->, Online event</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">!!!! Rejestracja: https://app.evenea.pl/event/allegro-tech-live-22/ !!!! Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/281441586/">Szczegóły</a></article></div></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/281199452/" title="Allegro Tech Live #21 - Jak zautomatyzować bezpieczeństwo IT?" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Live #21 - Jak zautomatyzować bezpieczeństwo IT?"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/281199452/" title="Allegro Tech Live #21 - Jak zautomatyzować bezpieczeństwo IT?" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Live #21 - Jak zautomatyzować bezpieczeństwo IT?</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">2 miesiące temu</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to my…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/281199452/">Szczegóły</a></article></div></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/">Zobacz więcej wydarzeń</a></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Oferty pracy</h2><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto"><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Research Engineer - Machine Learning (Reinforcement Learning)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Kraków, Poznań, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999785422127-research-engineer-machine-learning-reinforcement-learning?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Research Engineer - Machine Learning (Ranking and Recommendations)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Poznań, Kraków, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999785421861-research-engineer-machine-learning-ranking-and-recommendations?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Chief Architect</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Kraków, Poznań, Toruń, Gdańsk, Łódź, Katowice, Lublin</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999779485268-chief-architect?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Research Engineer - Machine Learning (Reinforcement Learning)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Kraków, Poznań, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999779448775-research-engineer-machine-learning-reinforcement-learning?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Research Engineer - Machine Learning (Ranking and Recommendations)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Poznań, Kraków, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999779448676-research-engineer-machine-learning-ranking-and-recommendations?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://allegro.pl/praca">Zobacz więcej ofert</a></div><footer class="m-color-bg_navy m-margin-top-32"><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24 m-padding-bottom-24 m-display-flex@sm m-flex-justify-between m-flex-items-center m-text-align_center"><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-color_white m-padding-left-24@sm">Proudly built by Allegro Tech engineers</p><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0 m-display-flex m-flex-justify-center"><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://github.com/allegro"><img src="https://assets.allegrostatic.com/metrum/icon/github-6a18df1729.svg" alt="Github" class="m-icon"/></a></li><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://www.facebook.com/allegro.tech/"><img src="https://assets.allegrostatic.com/metrum/icon/facebook-a2b92f9dcb.svg" alt="Facebook" class="m-icon"/></a></li><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/allegrotech"><img src="https://assets.allegrostatic.com/metrum/icon/twitter-25164a58aa.svg" alt="Twitter" class="m-icon"/></a></li></ul></div></footer><div style="visibility:hidden;height:0;overflow:hidden;position:relative"><img alt="doubleclick" width="1" height="1" style="position:absolute" src="https://pubads.g.doubleclick.net/activity;dc_iu=/21612525419/DFPAudiencePixel;ord=3026038956578.6606;dc_seg=507368552?"/><img alt="fb" height="1" width="1" style="position:absolute" src="https://www.facebook.com/tr?id=1650870088530325&amp;ev=PageView&amp;noscript=1"/></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"title":"Clean Architecture Story","link":"https://blog.allegro.tech/2021/12/clean-architecture-story.html","pubDate":"Mon, 13 Dec 2021 00:00:00 +0100","authors":{"author":[{"name":["Michał Kowalcze"],"photo":["https://blog.allegro.tech/img/authors/michal.kowalcze.jpg"],"url":["https://blog.allegro.tech/authors/michal.kowalcze"]}]},"content":"\u003cp\u003e\u003ca href=\"https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html\"\u003eThe Clean Architecture\u003c/a\u003e concept has been\naround for some time and keeps surfacing in one place or another, yet it is not widely adopted. In this post I would\nlike to introduce this topic in a less conventional way: starting with customer’s needs and going through various\nstages to present a solution that is clean enough to satisfy concepts from the aforementioned blog (or\n\u003ca href=\"https://www.goodreads.com/book/show/18043011-clean-architecture\"\u003ethe book\u003c/a\u003e with the same name).\u003c/p\u003e\n\n\u003ch2 id=\"the-perspective\"\u003eThe perspective\u003c/h2\u003e\n\u003cp\u003eWhy do we need software architecture? What is it anyway? An extensive definition can be found in a place a bit unexpected\nfor an agile world — an enterprise-architecture definition from \u003ca href=\"https://en.wikipedia.org/wiki/The_Open_Group_Architecture_Framework\"\u003eTOGAF\u003c/a\u003e:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eThe fundamental concepts or properties of a system in its environment embodied in its elements, relationships, and\nin the principles of its design and evolution. (Source: ISO/IEC/IEEE 42010:2011)\u003c/li\u003e\n  \u003cli\u003eThe structure of components, their inter-relationships, and the principles and guidelines governing their design and\nevolution over time.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAnd what do we need such a governing structure or shape for? Basically it allows us to make cost/time-efficient choices\nwhen it comes to development. And deployment. And operation. And maintenance.\u003c/p\u003e\n\n\u003cp\u003eIt also allows us to keep as many options open as possible, so our future choices are not limited by an overcommitment\nfrom the past.\u003c/p\u003e\n\n\u003cp\u003eSo — we have our perspective defined. Let’s dive into a real-world problem!\u003c/p\u003e\n\n\u003ch2 id=\"the-challenge\"\u003eThe challenge\u003c/h2\u003e\n\u003cp\u003eYou are a young, promising programmer sitting in a dorm and one afternoon a stranger appears. “I run a small company\nthat delivers packages from furniture shops to customers. I need a database that will allow reservation of slots. Is it\nsomething you are able to deliver?” “Of course!” — what else could a young, promising programmer answer?\u003c/p\u003e\n\n\u003ch2 id=\"the-false-start\"\u003eThe false start\u003c/h2\u003e\n\u003cp\u003eThe customer needs a database, so what can we start with? The database schema, of course! We can identify entities with\nease: a transport slot, a schedule, a user (we need some authentication, right?), a … something? Okay, perhaps it is\nnot the easiest way. So why don’t we start with something else?\u003c/p\u003e\n\n\u003cp\u003eLet’s choose the technology to use! Let’s go with React frontend, Java+Spring backend, some SQL as persistence. To\npresent a clickable version to our customer we need some warm-up work to set up an environment, create a deployable\nservice version or GUI mockups, configure persistence and so on. In general: to pay attention to technical details —\ncode necessary to set up something working, of which non-devs are usually not aware. It simply has to be done before we\nstart talking about nitty-gritty for business logic.\u003c/p\u003e\n\n\u003ch2 id=\"the-use-case-driven-approach\"\u003eThe use-case-driven approach\u003c/h2\u003e\n\u003cp\u003eWhat if instead of starting with what we already know — how to visualize relationships, how to build a web-system — we\nstarted with what we didn’t know? Simply — by asking questions such as: How is the system going to be used? By whom?\u003c/p\u003e\n\n\u003ch2 id=\"use-cases\"\u003eUse cases\u003c/h2\u003e\n\u003cp\u003eIn other words — what are the use cases for the system? Let’s define the challenge once more using high-level actors\nand interactions: \u003cimg src=\"/img/articles/2021-12-13-clean-architecture-story/use_cases.png\" alt=\"Use cases\" /\u003e and pick the first\nrequired interaction: shop makes a reservation. What is required to make a reservation? Hmm, I think that it would be\ngood to get the current schedule in the first place. Why am I using “get” instead of “display”? “Display” already\nsuggests a way of delivering output, when we hear “display” a computer screen comes to our minds, with a web\napplication. Single page web app, of course. “Get” is more neutral, it does not constrain our vision by a specific\npresentation method. Frankly — is there anything wrong with delivering the current schedule over the phone, for\nexample?\u003c/p\u003e\n\n\u003ch3 id=\"getting-the-schedule\"\u003eGetting the schedule\u003c/h3\u003e\n\u003cp\u003eSo, we can start thinking about our schedule model — let it be a single instance representing a day with slots inside.\nGreat, we have our entities! How to get one? Well, we need to check if there is already a stored schedule and if so\n— retrieve it from the repository. If the schedule is not available we have to create one. Based on…? Exactly — we do\nnot know yet, all we can say is that it will probably be something flexible. Something to discuss with our customer\n— but this does not prevent us from going forward with our first use case. Logic is indeed simple:\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003egetSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escheduleDay\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eLocalDate\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eDaySchedule\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003edaySchedule\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edaySchedulerRepository\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escheduleDay\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edaySchedule\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edaySchedule\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003enewSchedule\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edayScheduleCreator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ecreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escheduleDay\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edaySchedulerRepository\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enewSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(full commit: \u003ca href=\"https://github.com/michal-kowalcze/clean-architecture-example/commit/6dfeee53554a4ccf37e81aa50a2bd24af7e02cce\"\u003eGitHub\u003c/a\u003e)\u003c/p\u003e\n\n\u003cp\u003eAnd even with this simple logic we identified a hidden assumption regarding the schedule definition: that there is a\nrecipe for creating a daily schedule. What is more we can test retrieval of a schedule — with definition of schedule\ncreator if required — without any irrelevant details, like database, UI, framework and so on. Test only business rules,\nwithout unnecessary details.\u003c/p\u003e\n\n\u003ch2 id=\"reserving-the-slot\"\u003eReserving the slot\u003c/h2\u003e\n\u003cp\u003eTo finish the reservation we have to add at least one more use case — one for reservation of a free slot. Provided that\nwe re-use existing logic, the interaction is still simple:\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003ereserve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eslotId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eSlotId\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eDaySchedule\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003edaySchedule\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egetScheduleUseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escheduleDay\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eslotId\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eday\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003emodifiedSchedule\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edaySchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ereserveSlot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eslotId\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edayScheduleRepository\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodifiedSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(full commit: \u003ca href=\"https://github.com/michal-kowalcze/clean-architecture-example/commit/7b7961b28107c3c89d40ce69a8383bf9f32337b0\"\u003eGitHub\u003c/a\u003e)\u003c/p\u003e\n\n\u003cp\u003eAnd, as we can see — the slot reservation business rule (and constraint) is implemented at the domain model itself — so\nwe are safe, that any other interaction, any other use case, is not going to break these rules. This approach also\nsimplifies testing, as business rules can be verified in separation from the use case interaction logic.\u003c/p\u003e\n\n\u003ch2 id=\"where-is-the-clean-architecture\"\u003eWhere is the “Clean Architecture”?\u003c/h2\u003e\n\u003cp\u003eLet‘s stop with business logic for a moment. We created quite thoughtful, extensible code for sure, but why are we\ntalking about “Clean” architecture? We already used Domain-Driven Design and Hexagonal architecture concepts. Is there\nanything more? Imagine that another person is going to help us with implementation. She is not aware of the source code\nyet and simply would like to take a look at the codebase. And she sees: \u003cimg src=\"/img/articles/2021-12-13-clean-architecture-story/use_case_classes.png\" alt=\"Use case classes\" /\u003e\nIt looks like something to her, doesn‘t it? A kind of reservation system! It is not yet another domain service with\nsome methods that have no clear connection with possible uses — the list of classes itself describes what the system\ncan do.\u003c/p\u003e\n\n\u003ch2 id=\"the-first-assumption\"\u003eThe first assumption\u003c/h2\u003e\n\u003cp\u003eWe have a mocked implementation as the schedule creator. It is OK to test logic at the unit test level, but not enough\nto run a prototype.\u003c/p\u003e\n\n\u003cp\u003eAfter a short call with our customer we know more about the daily schedule — there are six slots, two hours each,\nstarting at 8:oo a.m. We also know that this recipe for the daily schedule is very, very simple and it is going to be\nchanged soon (e.g. to accommodate for holidays, etc.). All these issues will be solved later, now we are at the\nprototype stage and our desired outcome is to have a working demo for our stranger.\u003c/p\u003e\n\n\u003cp\u003eWhere to put this simple implementation of the schedule creator? So far, the domain used an interface for that. Are we\ngoing to put an implementation of this interface to the infrastructure package and treat it as something outside the\ndomain? Certainly not! It is not complicated and this is part of the domain itself, we simply replace the mocked\nimplementation of the schedule creator with class specification.\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epackage\u003c/span\u003e \u003cspan class=\"nn\"\u003eeu.kowalcze.michal.arch.clean.example.domain.model\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDayScheduleCreator\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003ecreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escheduleDay\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eLocalDate\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eDaySchedule\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eDaySchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003escheduleDay\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003ecreateStandardSlots\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(full commit: \u003ca href=\"https://github.com/michal-kowalcze/clean-architecture-example/commit/2792fc31e98d76a610561636f03073dee73fbb47\"\u003eGitHub\u003c/a\u003e)\u003c/p\u003e\n\n\u003ch2 id=\"the-prototype\"\u003eThe prototype\u003c/h2\u003e\n\u003cp\u003eI will not be original here — for the first prototype version the REST API sounds like something reasonable. Do we care\nabout other infrastructure at the moment? Persistence? No! In the previous commits a map-based persistence layer is\nused for unit tests and this solution is good enough to start with. As long as the system is not restarted, of course.\u003c/p\u003e\n\n\u003cp\u003eWhat is important at this stage? We are introducing an \u003cstrong\u003eAPI\u003c/strong\u003e — this is a separate layer, so it is crucial to ensure\nthat domain classes are not exposed to the outside world — and that we do not introduce a dependency on the API into\nthe domain.\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epackage\u003c/span\u003e \u003cspan class=\"nn\"\u003eeu.kowalcze.michal.arch.clean.example.api\u003c/span\u003e\n\n\u003cspan class=\"nd\"\u003e@Controller\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eGetScheduleEndpoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003egetScheduleUseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eGetScheduleUseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"nd\"\u003e@GetMapping\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"/schedules/{localDate}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003egetSchedules\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nd\"\u003e@PathVariable\u003c/span\u003e \u003cspan class=\"n\"\u003elocalDate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eDayScheduleDto\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003escheduleDay\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eLocalDate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eparse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elocalDate\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003edaySchedule\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egetScheduleUseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escheduleDay\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edaySchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etoApi\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(full commit: \u003ca href=\"https://github.com/michal-kowalcze/clean-architecture-example/commit/b1d1c3fe3901d9328bdfaf560331d35131f8224b\"\u003eGitHub\u003c/a\u003e)\u003c/p\u003e\n\n\u003ch2 id=\"the-abstractions\"\u003eThe abstractions\u003c/h2\u003e\n\u003ch3 id=\"use-case\"\u003eUse Case\u003c/h3\u003e\n\u003cp\u003eChecking the implementation of endpoints (see comments in the code) we can see that conceptually each endpoint executes\nlogic according to the same structure: \u003cimg src=\"/img/articles/2021-12-13-clean-architecture-story/use_case_flow.png\" alt=\"Use case flow\" /\u003e\nWell, why don’t we make some abstraction for this? Sounds like a crazy idea? Let‘s check! Based on our code and the\ndiagram above we can identify the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eUseCase\u003c/code\u003e abstraction — something that takes some input (domain input, to be precise)\nand converts it to a (domain) output.\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eUseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eINPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eOUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003eapply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eINPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eOUTPUT\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(full commit: \u003ca href=\"https://github.com/michal-kowalcze/clean-architecture-example/commit/006811b49ae4531b96b300c964d3a66d725183bf\"\u003eGitHub\u003c/a\u003e)\u003c/p\u003e\n\n\u003ch3 id=\"use-case-executor\"\u003eUse Case Executor\u003c/h3\u003e\n\u003cp\u003eGreat! We have use cases and I just realized that I would like to have an email in my inbox each time an exception is\nthrown — and I do not want to depend on a spring-specific mechanism to do this. A common \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eUseCaseExecutor\u003c/code\u003e will be a\ngreat help to address this non-functional requirement.\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUseCaseExecutor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003enotificationGateway\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eNotificationGateway\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eINPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eOUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eUseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eINPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eOUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;,\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eINPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eOUTPUT\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003euseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eapply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eException\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003enotificationGateway\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enotify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(full commit: \u003ca href=\"https://github.com/michal-kowalcze/clean-architecture-example/commit/54d3187aed94427bb60af9781d0eec573c8c8db0\"\u003eGitHub\u003c/a\u003e)\u003c/p\u003e\n\n\u003ch3 id=\"framework-independent-response\"\u003eFramework-independent response\u003c/h3\u003e\n\u003cp\u003eIn order to handle the next requirements in our plan we have to change the logic a bit — add the possibility of returning\nspring-specific response entities from the executor itself. To make our code reusable in a non-spring world (ktor,\nanyone?) we separated the plain executor from spring specific decorator, so that it is possible to use this code easily\nin other frameworks.\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003edata class\u003c/span\u003e \u003cspan class=\"nc\"\u003eUseCaseApiResult\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eAPI_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003eresponseCode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eAPI_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSpringUseCaseExecutor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003euseCaseExecutor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eUseCaseExecutor\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eDOMAIN_INPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDOMAIN_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eAPI_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003euseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eUseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eDOMAIN_INPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDOMAIN_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eDOMAIN_INPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etoApiConversion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edomainOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eDOMAIN_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eUseCaseApiResult\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eAPI_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eResponseEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eAPI_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003euseCaseExecutor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etoApiConversion\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003etoSpringResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eAPI_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eUseCaseApiResult\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eAPI_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"nf\"\u003etoSpringResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nc\"\u003eResponseEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eAPI_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"nc\"\u003eResponseEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresponseCode\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(full commit: \u003ca href=\"https://github.com/michal-kowalcze/clean-architecture-example/commit/d44f7f993fab2e749e3048561b3ac4d3cff6fd88\"\u003eGitHub\u003c/a\u003e)\u003c/p\u003e\n\n\u003ch3 id=\"handle-domain-exceptions\"\u003eHandle domain exceptions\u003c/h3\u003e\n\u003cp\u003eOoops. Our prototype is running and we observe exceptions resulting in HTTP 500 errors. It would be nice to convert\nthese to dedicated response codes in a reasonable way yet without using much of spring infrastructure, for simplified\nmaintenance (and possible future changes). This can be easily achieved by adding another parameter to use case\nexecution, like this:\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUseCaseExecutor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003enotificationGateway\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eNotificationGateway\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eDOMAIN_INPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDOMAIN_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003euseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eUseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eDOMAIN_INPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDOMAIN_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eDOMAIN_INPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etoApiConversion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edomainOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eDOMAIN_OUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eUseCaseApiResult\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"err\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ehandledExceptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eExceptionHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.()\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eAny\u003c/span\u003e\u003cspan class=\"p\"\u003e)?\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eUseCaseApiResult\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"err\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003edomainOutput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003euseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eapply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003etoApiConversion\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edomainOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eException\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// conceptual logic\u003c/span\u003e\n            \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003eexceptionHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eExceptionHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ehandledExceptions\u003c/span\u003e\u003cspan class=\"o\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003elet\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eexceptionHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ehandledExceptions\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nc\"\u003eUseCaseApiResult\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresponseCodeIfExceptionIsHandled\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eexceptionHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e?:\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(full commit: \u003ca href=\"https://github.com/michal-kowalcze/clean-architecture-example/commit/ac6763f19e2f3f61adc1f8b02bab6cb1e1a65c11\"\u003eGitHub\u003c/a\u003e)\u003c/p\u003e\n\n\u003ch3 id=\"handle-dto-conversion-exceptions\"\u003eHandle DTO conversion exceptions\u003c/h3\u003e\n\u003cp\u003eBy simply replacing input with:\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003einputProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eAny\u003c/span\u003e\u003cspan class=\"p\"\u003e.()\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eDOMAIN_INPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(full commit: \u003ca href=\"https://github.com/michal-kowalcze/clean-architecture-example/commit/a9ef4bb835977a4bd4a62eb754d8563340bd3d4e\"\u003eGitHub\u003c/a\u003e)\u003c/p\u003e\n\n\u003cp\u003ewe are able to handle exceptions raised during creation of input domain objects in a uniform way, without any\nadditional try/catches at the endpoint level.\u003c/p\u003e\n\n\u003ch2 id=\"the-outcome\"\u003eThe outcome\u003c/h2\u003e\n\n\u003cp\u003eWhat is the result of our journey across some functional requirements and a bit more non-functional requirements? By\nlooking at the definition of an endpoint we have full documentation of its behaviour, including exceptions. Our code is\neasily portable to some different API (e.g. EJB), we have fully-auditable modifications, and we can exchange layers\nquite freely. Also analysis of whole service is simplified, as possible use cases are explicitely stated.\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nd\"\u003e@PutMapping\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"/schedules/{localDate}/{index}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eproduces\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"application/json\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003econsumes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"application/json\"\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003egetSchedules\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nd\"\u003e@PathVariable\u003c/span\u003e \u003cspan class=\"n\"\u003elocalDate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nd\"\u003e@PathVariable\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eResponseEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"err\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euseCaseExecutor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003euseCase\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereserveSlotUseCase\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003einputProvider\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nc\"\u003eSlotId\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eLocalDate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eparse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elocalDate\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etoApiConversion\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003edayScheduleDto\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etoApi\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"nc\"\u003eUseCaseApiResult\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eHttpServletResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eSC_ACCEPTED\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edayScheduleDto\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ehandledExceptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eexception\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eInvalidSlotIndexException\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eUNPROCESSABLE_ENTITY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"INVALID-SLOT-ID\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eexception\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eSlotAlreadyReservedException\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eCONFLICT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"SLOT-ALREADY-RESERVED\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(repository: \u003ca href=\"https://github.com/michal-kowalcze/clean-architecture-example\"\u003eGitHub\u003c/a\u003e)\u003c/p\u003e\n\n\u003cp\u003eA simple evaluation of our solution with measures mentioned at the beginning:\u003c/p\u003e\n\n\u003ctable\u003e\n  \u003cthead\u003e\n    \u003ctr\u003e\n      \u003cth style=\"text-align: left\"\u003eAspect\u003c/th\u003e\n      \u003cth style=\"text-align: left\"\u003eEvaluation\u003c/th\u003e\n      \u003cth style=\"text-align: center\"\u003eHas advantage\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: left\"\u003eDevelopment\u003c/td\u003e\n      \u003ctd style=\"text-align: left\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eUseCase\u003c/code\u003e abstraction forces unification of approach across different teams in a more significant way than standard service approach.\u003c/td\u003e\n      \u003ctd style=\"text-align: center\"\u003e✓\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: left\"\u003eDeployment\u003c/td\u003e\n      \u003ctd style=\"text-align: left\"\u003eWe did not consider deployment in our example. It certainly is not going to be different/harder than in case of hexagonal architecture.\u003c/td\u003e\n      \u003ctd style=\"text-align: center\"\u003e \u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: left\"\u003eOperation\u003c/td\u003e\n      \u003ctd style=\"text-align: left\"\u003eUse case-based approach reveals operation of the system, which reduces learning curve for both development and maintenance.\u003c/td\u003e\n      \u003ctd style=\"text-align: center\"\u003e✓\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: left\"\u003eMaintenance\u003c/td\u003e\n      \u003ctd style=\"text-align: left\"\u003eEntry threshold might be lower compared to hexagonal approach, as service is separated horizontally (into layers) and vertically (into use cases with common domain model).\u003c/td\u003e\n      \u003ctd style=\"text-align: center\"\u003e✓\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: left\"\u003eKeeping options open\u003c/td\u003e\n      \u003ctd style=\"text-align: left\"\u003eSimilar to hexagonal architecture approach.\u003c/td\u003e\n      \u003ctd style=\"text-align: center\"\u003e \u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch3 id=\"tldr\"\u003eTL;DR\u003c/h3\u003e\n\u003cp\u003eIt is like hexagonal architecture with one additional dimension, composed of use cases, giving better insight into\noperations of a system and streamlining development and maintenance. Solution that was created during this narrative\nallows for creation of a self-documenting API endpoint.\u003c/p\u003e\n\n\u003ch2 id=\"high-level-overview\"\u003eHigh-level overview\u003c/h2\u003e\n\u003cp\u003eWith all this read we can switch our view to the high-level perspective:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-12-13-clean-architecture-story/clean_architecture_diagram.png\" alt=\"The Clean Architecture Diagram\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eand describe abstractions. Starting from the inside we have:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003e\u003cstrong\u003eDomain Model\u003c/strong\u003e, \u003cstrong\u003eServices\u003c/strong\u003e and \u003cstrong\u003eGateways\u003c/strong\u003e, which are responsible for defining\nbusiness rules for the domain.\u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003eUseCase\u003c/strong\u003e, which orchestrates execution of business rules.\u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003eUseCaseExecutor\u003c/strong\u003e providing common behavior for all use cases.\u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003eAPI\u003c/strong\u003e connecting service with the outside world.\u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003eImplementation of gateways\u003c/strong\u003e, which connects with other services or persistence providers.\u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003eConfiguration\u003c/strong\u003e, responsible for gluing all elements together.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eI hope that you enjoy this simple story and find the concept of\n\u003ca href=\"https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html\"\u003ethe Clean Architecture\u003c/a\u003e useful.\nThank you for reading!\u003c/p\u003e\n","contentSnippet":"The Clean Architecture concept has been\naround for some time and keeps surfacing in one place or another, yet it is not widely adopted. In this post I would\nlike to introduce this topic in a less conventional way: starting with customer’s needs and going through various\nstages to present a solution that is clean enough to satisfy concepts from the aforementioned blog (or\nthe book with the same name).\nThe perspective\nWhy do we need software architecture? What is it anyway? An extensive definition can be found in a place a bit unexpected\nfor an agile world — an enterprise-architecture definition from TOGAF:\nThe fundamental concepts or properties of a system in its environment embodied in its elements, relationships, and\nin the principles of its design and evolution. (Source: ISO/IEC/IEEE 42010:2011)\nThe structure of components, their inter-relationships, and the principles and guidelines governing their design and\nevolution over time.\nAnd what do we need such a governing structure or shape for? Basically it allows us to make cost/time-efficient choices\nwhen it comes to development. And deployment. And operation. And maintenance.\nIt also allows us to keep as many options open as possible, so our future choices are not limited by an overcommitment\nfrom the past.\nSo — we have our perspective defined. Let’s dive into a real-world problem!\nThe challenge\nYou are a young, promising programmer sitting in a dorm and one afternoon a stranger appears. “I run a small company\nthat delivers packages from furniture shops to customers. I need a database that will allow reservation of slots. Is it\nsomething you are able to deliver?” “Of course!” — what else could a young, promising programmer answer?\nThe false start\nThe customer needs a database, so what can we start with? The database schema, of course! We can identify entities with\nease: a transport slot, a schedule, a user (we need some authentication, right?), a … something? Okay, perhaps it is\nnot the easiest way. So why don’t we start with something else?\nLet’s choose the technology to use! Let’s go with React frontend, Java+Spring backend, some SQL as persistence. To\npresent a clickable version to our customer we need some warm-up work to set up an environment, create a deployable\nservice version or GUI mockups, configure persistence and so on. In general: to pay attention to technical details —\ncode necessary to set up something working, of which non-devs are usually not aware. It simply has to be done before we\nstart talking about nitty-gritty for business logic.\nThe use-case-driven approach\nWhat if instead of starting with what we already know — how to visualize relationships, how to build a web-system — we\nstarted with what we didn’t know? Simply — by asking questions such as: How is the system going to be used? By whom?\nUse cases\nIn other words — what are the use cases for the system? Let’s define the challenge once more using high-level actors\nand interactions:  and pick the first\nrequired interaction: shop makes a reservation. What is required to make a reservation? Hmm, I think that it would be\ngood to get the current schedule in the first place. Why am I using “get” instead of “display”? “Display” already\nsuggests a way of delivering output, when we hear “display” a computer screen comes to our minds, with a web\napplication. Single page web app, of course. “Get” is more neutral, it does not constrain our vision by a specific\npresentation method. Frankly — is there anything wrong with delivering the current schedule over the phone, for\nexample?\nGetting the schedule\nSo, we can start thinking about our schedule model — let it be a single instance representing a day with slots inside.\nGreat, we have our entities! How to get one? Well, we need to check if there is already a stored schedule and if so\n— retrieve it from the repository. If the schedule is not available we have to create one. Based on…? Exactly — we do\nnot know yet, all we can say is that it will probably be something flexible. Something to discuss with our customer\n— but this does not prevent us from going forward with our first use case. Logic is indeed simple:\n\nfun getSchedule(scheduleDay: LocalDate): DaySchedule {\n  val daySchedule = daySchedulerRepository.get(scheduleDay)\n  if (daySchedule != null) {\n    return daySchedule\n  }\n\n  val newSchedule = dayScheduleCreator.create(scheduleDay)\n  return daySchedulerRepository.save(newSchedule)\n}\n\n\n(full commit: GitHub)\nAnd even with this simple logic we identified a hidden assumption regarding the schedule definition: that there is a\nrecipe for creating a daily schedule. What is more we can test retrieval of a schedule — with definition of schedule\ncreator if required — without any irrelevant details, like database, UI, framework and so on. Test only business rules,\nwithout unnecessary details.\nReserving the slot\nTo finish the reservation we have to add at least one more use case — one for reservation of a free slot. Provided that\nwe re-use existing logic, the interaction is still simple:\n\nfun reserve(slotId: SlotId): DaySchedule {\n  val daySchedule = getScheduleUseCase.getSchedule(scheduleDay = slotId.day)\n\n  val modifiedSchedule = daySchedule.reserveSlot(slotId.index)\n\n  return dayScheduleRepository.save(modifiedSchedule)\n}\n\n\n(full commit: GitHub)\nAnd, as we can see — the slot reservation business rule (and constraint) is implemented at the domain model itself — so\nwe are safe, that any other interaction, any other use case, is not going to break these rules. This approach also\nsimplifies testing, as business rules can be verified in separation from the use case interaction logic.\nWhere is the “Clean Architecture”?\nLet‘s stop with business logic for a moment. We created quite thoughtful, extensible code for sure, but why are we\ntalking about “Clean” architecture? We already used Domain-Driven Design and Hexagonal architecture concepts. Is there\nanything more? Imagine that another person is going to help us with implementation. She is not aware of the source code\nyet and simply would like to take a look at the codebase. And she sees: \nIt looks like something to her, doesn‘t it? A kind of reservation system! It is not yet another domain service with\nsome methods that have no clear connection with possible uses — the list of classes itself describes what the system\ncan do.\nThe first assumption\nWe have a mocked implementation as the schedule creator. It is OK to test logic at the unit test level, but not enough\nto run a prototype.\nAfter a short call with our customer we know more about the daily schedule — there are six slots, two hours each,\nstarting at 8:oo a.m. We also know that this recipe for the daily schedule is very, very simple and it is going to be\nchanged soon (e.g. to accommodate for holidays, etc.). All these issues will be solved later, now we are at the\nprototype stage and our desired outcome is to have a working demo for our stranger.\nWhere to put this simple implementation of the schedule creator? So far, the domain used an interface for that. Are we\ngoing to put an implementation of this interface to the infrastructure package and treat it as something outside the\ndomain? Certainly not! It is not complicated and this is part of the domain itself, we simply replace the mocked\nimplementation of the schedule creator with class specification.\n\npackage eu.kowalcze.michal.arch.clean.example.domain.model\n\nclass DayScheduleCreator {\n    fun create(scheduleDay: LocalDate): DaySchedule = DaySchedule(\n        scheduleDay,\n        createStandardSlots()\n    )\n//...\n}\n\n\n(full commit: GitHub)\nThe prototype\nI will not be original here — for the first prototype version the REST API sounds like something reasonable. Do we care\nabout other infrastructure at the moment? Persistence? No! In the previous commits a map-based persistence layer is\nused for unit tests and this solution is good enough to start with. As long as the system is not restarted, of course.\nWhat is important at this stage? We are introducing an API — this is a separate layer, so it is crucial to ensure\nthat domain classes are not exposed to the outside world — and that we do not introduce a dependency on the API into\nthe domain.\n\npackage eu.kowalcze.michal.arch.clean.example.api\n\n@Controller\nclass GetScheduleEndpoint(private val getScheduleUseCase: GetScheduleUseCase) {\n\n    @GetMapping(\"/schedules/{localDate}\")\n    fun getSchedules(@PathVariable localDate: String): DayScheduleDto {\n        val scheduleDay = LocalDate.parse(localDate)\n        val daySchedule = getScheduleUseCase.getSchedule(scheduleDay)\n        return daySchedule.toApi()\n    }\n\n}\n\n\n(full commit: GitHub)\nThe abstractions\nUse Case\nChecking the implementation of endpoints (see comments in the code) we can see that conceptually each endpoint executes\nlogic according to the same structure: \nWell, why don’t we make some abstraction for this? Sounds like a crazy idea? Let‘s check! Based on our code and the\ndiagram above we can identify the UseCase abstraction — something that takes some input (domain input, to be precise)\nand converts it to a (domain) output.\n\ninterface UseCase\u003cINPUT, OUTPUT\u003e {\n    fun apply(input: INPUT): OUTPUT\n}\n\n\n(full commit: GitHub)\nUse Case Executor\nGreat! We have use cases and I just realized that I would like to have an email in my inbox each time an exception is\nthrown — and I do not want to depend on a spring-specific mechanism to do this. A common UseCaseExecutor will be a\ngreat help to address this non-functional requirement.\n\nclass UseCaseExecutor(private val notificationGateway: NotificationGateway) {\n    fun \u003cINPUT, OUTPUT\u003e execute(useCase: UseCase\u003cINPUT, OUTPUT\u003e, input: INPUT): OUTPUT {\n        try {\n            return useCase.apply(input)\n        } catch (e: Exception) {\n            notificationGateway.notify(useCase, e)\n            throw e\n        }\n    }\n}\n\n\n(full commit: GitHub)\nFramework-independent response\nIn order to handle the next requirements in our plan we have to change the logic a bit — add the possibility of returning\nspring-specific response entities from the executor itself. To make our code reusable in a non-spring world (ktor,\nanyone?) we separated the plain executor from spring specific decorator, so that it is possible to use this code easily\nin other frameworks.\n\ndata class UseCaseApiResult\u003cAPI_OUTPUT\u003e(\n    val responseCode: Int,\n    val output: API_OUTPUT,\n)\n\nclass SpringUseCaseExecutor(private val useCaseExecutor: UseCaseExecutor) {\n    fun \u003cDOMAIN_INPUT, DOMAIN_OUTPUT, API_OUTPUT\u003e execute(\n        useCase: UseCase\u003cDOMAIN_INPUT, DOMAIN_OUTPUT\u003e,\n        input: DOMAIN_INPUT,\n        toApiConversion: (domainOutput: DOMAIN_OUTPUT) -\u003e UseCaseApiResult\u003cAPI_OUTPUT\u003e\n    ): ResponseEntity\u003cAPI_OUTPUT\u003e {\n        return useCaseExecutor.execute(useCase, input, toApiConversion).toSpringResponse()\n    }\n}\n\nprivate fun \u003cAPI_OUTPUT\u003e UseCaseApiResult\u003cAPI_OUTPUT\u003e.toSpringResponse(): ResponseEntity\u003cAPI_OUTPUT\u003e =\n    ResponseEntity.status(responseCode).body(output)\n\n\n(full commit: GitHub)\nHandle domain exceptions\nOoops. Our prototype is running and we observe exceptions resulting in HTTP 500 errors. It would be nice to convert\nthese to dedicated response codes in a reasonable way yet without using much of spring infrastructure, for simplified\nmaintenance (and possible future changes). This can be easily achieved by adding another parameter to use case\nexecution, like this:\n\nclass UseCaseExecutor(private val notificationGateway: NotificationGateway) {\n    fun \u003cDOMAIN_INPUT, DOMAIN_OUTPUT\u003e execute(\n        useCase: UseCase\u003cDOMAIN_INPUT, DOMAIN_OUTPUT\u003e,\n        input: DOMAIN_INPUT,\n        toApiConversion: (domainOutput: DOMAIN_OUTPUT) -\u003e UseCaseApiResult\u003c*\u003e,\n        handledExceptions: (ExceptionHandler.() -\u003e Any)? = null,\n    ): UseCaseApiResult\u003c*\u003e {\n\n        try {\n            val domainOutput = useCase.apply(input)\n            return toApiConversion(domainOutput)\n        } catch (e: Exception) {\n            // conceptual logic\n            val exceptionHandler = ExceptionHandler(e)\n            handledExceptions?.let { exceptionHandler.handledExceptions() }\n            return UseCaseApiResult(responseCodeIfExceptionIsHandled, exceptionHandler.message ?: e.message)\n        }\n    }\n}\n\n\n(full commit: GitHub)\nHandle DTO conversion exceptions\nBy simply replacing input with:\n\ninputProvider: Any.() -\u003e DOMAIN_INPUT,\n\n\n(full commit: GitHub)\nwe are able to handle exceptions raised during creation of input domain objects in a uniform way, without any\nadditional try/catches at the endpoint level.\nThe outcome\nWhat is the result of our journey across some functional requirements and a bit more non-functional requirements? By\nlooking at the definition of an endpoint we have full documentation of its behaviour, including exceptions. Our code is\neasily portable to some different API (e.g. EJB), we have fully-auditable modifications, and we can exchange layers\nquite freely. Also analysis of whole service is simplified, as possible use cases are explicitely stated.\n\n@PutMapping(\"/schedules/{localDate}/{index}\", produces = [\"application/json\"], consumes = [\"application/json\"])\nfun getSchedules(@PathVariable localDate: String, @PathVariable index: Int): ResponseEntity\u003c*\u003e =\n    useCaseExecutor.execute(\n        useCase = reserveSlotUseCase,\n        inputProvider = { SlotId(LocalDate.parse(localDate), index) },\n        toApiConversion = {\n            val dayScheduleDto = it.toApi()\n            UseCaseApiResult(HttpServletResponse.SC_ACCEPTED, dayScheduleDto)\n        },\n        handledExceptions = {\n            exception(InvalidSlotIndexException::class, UNPROCESSABLE_ENTITY, \"INVALID-SLOT-ID\")\n            exception(SlotAlreadyReservedException::class, CONFLICT, \"SLOT-ALREADY-RESERVED\")\n        },\n    )\n\n\n(repository: GitHub)\nA simple evaluation of our solution with measures mentioned at the beginning:\nAspect\n      Evaluation\n      Has advantage\n    \nDevelopment\n      UseCase abstraction forces unification of approach across different teams in a more significant way than standard service approach.\n      ✓\n    \nDeployment\n      We did not consider deployment in our example. It certainly is not going to be different/harder than in case of hexagonal architecture.\n       \n    \nOperation\n      Use case-based approach reveals operation of the system, which reduces learning curve for both development and maintenance.\n      ✓\n    \nMaintenance\n      Entry threshold might be lower compared to hexagonal approach, as service is separated horizontally (into layers) and vertically (into use cases with common domain model).\n      ✓\n    \nKeeping options open\n      Similar to hexagonal architecture approach.\n       \n    \nTL;DR\nIt is like hexagonal architecture with one additional dimension, composed of use cases, giving better insight into\noperations of a system and streamlining development and maintenance. Solution that was created during this narrative\nallows for creation of a self-documenting API endpoint.\nHigh-level overview\nWith all this read we can switch our view to the high-level perspective:\n\nand describe abstractions. Starting from the inside we have:\nDomain Model, Services and Gateways, which are responsible for defining\nbusiness rules for the domain.\nUseCase, which orchestrates execution of business rules.\nUseCaseExecutor providing common behavior for all use cases.\nAPI connecting service with the outside world.\nImplementation of gateways, which connects with other services or persistence providers.\nConfiguration, responsible for gluing all elements together.\nI hope that you enjoy this simple story and find the concept of\nthe Clean Architecture useful.\nThank you for reading!","guid":"https://blog.allegro.tech/2021/12/clean-architecture-story.html","categories":["tech","architecture","clean-architecture","ddd","kotlin"],"isoDate":"2021-12-12T23:00:00.000Z","thumbnail":"images/post-headers/default.jpg"},{"title":"Which skills to choose in order to be more valuable","link":"https://blog.allegro.tech/2021/12/choose-your-skills.html","pubDate":"Thu, 09 Dec 2021 00:00:00 +0100","authors":{"author":[{"name":["Piotr Prusiński"],"photo":["https://blog.allegro.tech/img/authors/piotr.prusinski.jpg"],"url":["https://blog.allegro.tech/authors/piotr.prusinski"]}]},"content":"\u003cp\u003eAt some point in your career, you realize that it’s time to try to advance through the hierarchy. You think you are\ndoing a good job. You are constantly developing and learning something new. But at the same time, someone you know, with\nmuch less experience and knowledge than you, has long been higher up the hierarchy than you. Then you ask yourself:\n\u003cem\u003ewhat is wrong with me\u003c/em\u003e? In my case, the answer turned out to be properly gathering the expectations concerning my skills\nand work.\u003c/p\u003e\n\n\u003cp\u003eBelow, you can read my insight about it. You will find out how you can steer your development, so that you become much\nmore valuable to your team, leader or company and how to combine all this with your talents and interests.\u003c/p\u003e\n\n\u003ch2 id=\"how-to-start-the-development\"\u003eHow to start the development\u003c/h2\u003e\n\n\u003cp\u003eAs a member of a project team, you want to deliver a fully valuable solution. The key to success is to discover what’s\nbehind the word \u003cem\u003evaluable\u003c/em\u003e to your client. Is it enough to gather requirements? Unfortunately not. To find out exactly\nwhat stands behind the word \u003cem\u003evaluable\u003c/em\u003e you need to use a prototyping method, such as an iterative\n\u003ca href=\"https://www.wikipedia.org/wiki/Minimum_viable_product\"\u003eMVP\u003c/a\u003e (Minimum Viable Product) approach. For example, suppose you\nhave to paint your daughter’s room. You have several choices. You can choose the colour by yourself and paint the room\nwithout asking her for her opinion. The chance she will like the colour is small. So you will make a non-compliant\nproduct. You can bring her a sampler and ask her to choose a colour. The final colour when applied to the wall, may turn\nout to be different and then, the product will also not be as expected. You can also ask her about the colour and buy a\nfew samplers, paint a piece of wall with them and ask if any meet the requirements, if yes then paint the whole room\nwith the chosen colour, if not, buy another 5 colours and so on over and over until you get it right. This is the MVP\nprocess. First you gather requirements, then you prototype, which means you make a real product. You present it and\nreceive feedback (you learn) and decide what to do next. You repeat this process until you meet the client’s\nexpectations. This approach gives you the assurance that you have done exactly what was needed.\u003c/p\u003e\n\n\u003cp\u003eImagine that your skills and the work you do are products. We already know that to make a valuable product you need to\ngather requirements and prototype with the client. Your customer who cares most about your work and skills are the team,\nthe leader and the company you work for. However, what you do must also suit you. If you want your work and your\nknowledge to be of value to them, you need to gather their requirements first. Then quickly show the result and make\nsure it’s what they wanted. You are probably wondering what this prototyping is for in the case of your work? You have\ndone some work, it has been accepted so what more is there to talk about. There could be lots of reasons. You could have\nspent too much time on it, it’s even possible that what you did is wrong. You would have to put in a huge amount of time\nand work to improve it, which is why it was accepted as it is. Without prototyping, your work might appear to be of good\nquality to you, but the team might not be happy with it.\u003c/p\u003e\n\n\u003cp\u003eLet’s start with requirements gathering. Unfortunately it is impossible to gather universal requirements for a given\nposition since these requirements are different at different companies and even teams. The same person who has certain\nskills and performs certain tasks may be a senior in one company, where in another, he or she may be a junior. In one of\nthe companies I worked for, a good programmer was required to know the products and the business, then the tenure at the\ncompany mattered as well and being a support for the business. Performing a large number of tasks was not so important.\nIn another company, there were people who knew their product very well and were an excellent support to the business.\nHowever, they did not perform their tasks on time and did not take on issues that required them to undertake a lot of\nresponsibility. They still had junior or mid-level status.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-12-09-choose-your-skills/expectations.png\" alt=\"Expectations\" /\u003e\nThis begs the question: how do I gather my skills requirements?\u003c/p\u003e\n\n\u003ch2 id=\"assess-yourself-with-some-evaluation-sheets\"\u003eAssess yourself with some evaluation sheets\u003c/h2\u003e\n\n\u003cp\u003eAt Allegro, in the case of programmers and testers, we have a list of expectations prepared within the leadership\ncommunity. With such a list, it is much easier to collect requirements and talk about your own development towards\npromotion (in the team or in the company).\u003c/p\u003e\n\n\u003cp\u003eIn my case, after working at Allegro for a while, I decided that it might be a good idea to finally get my development\non track. My leader asked me to assess myself using a requirements sheet. This allowed me to identify the current stage\nI was at. The same sheet about me was completed by my leader. Then we calibrated ourselves. This sheet is divided into 3\nmain parts:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eTechnical knowledge\u003c/li\u003e\n  \u003cli\u003eAttitude\u003c/li\u003e\n  \u003cli\u003eProduct knowledge\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eEach part has a list of skills, each with an extensive description. For example, one of the descriptions of technical\nknowledge looked like this:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eYou know your technological stack very well (systems, applications, languages, tools). Having a technical problem to\nsolve, you know what your technological abilities are, and you know how to use them to achieve your goal.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eI rated each skill on a scale of 1 to 5. Ideally, I would like each skill to be close to a 5. If I rated myself\nsomewhere at a 4 and my leader rated me a 3, during calibration, I found out that the requirements for that skill were\ndifferent from what I thought. He said, there were things I hadn’t used yet. To have a 4 at this point I need to know\nthem e.g. Cassandra database. With that I learned the first relevant requirement that I didn’t know about. After the\nwhole process of gathering requirements this way, I already knew what I needed to work on. Now all I had to do was\nselect a few of them and start working. But how to choose these requirements, which I will implement with passion and\nactually do them well?\u003c/p\u003e\n\n\u003ch2 id=\"how-to-choose-skills-to-improve\"\u003eHow to choose skills to improve?\u003c/h2\u003e\n\n\u003cp\u003eThere are many strategies on how to choose skills to develop. All in all, you need to use the right method for the right\ntype of skill to get a good result. The first step is to get a mentor. Usually it will be your leader, but it can also\nbe an experienced team member, e.g. a senior.\u003c/p\u003e\n\n\u003cp\u003eLeaders at Allegro gain their development knowledge from many available training sessions. You should find a similar\nperson in your environment. Such a person will help you on your way and will simulate the customer of the product that\nyou will be making. Show him or her a list of things you should develop. Ask them which are the most important for your\nteam. It is possible that the list of things will become very short. Now just pick two or three things and prepare\nprototypes. You can choose them intuitively or match them with your talents. Just take a Gallup\ntest (\u003ca href=\"https://www.gallup.com/cliftonstrengths/en/home.aspx\"\u003eCliftonStrengths\u003c/a\u003e) to discover them. This test will help\nyou choose a strategy for developing a particular skill. This test will work well for soft skills. For hard skills\na \u003ca href=\"https://en.wikipedia.org/wiki/Lean_startup\"\u003elean startup strategy\u003c/a\u003e may be better. Below are two examples of what this\ncan look like in practice.\u003c/p\u003e\n\n\u003ch2 id=\"how-gallup-test-can-help-you-find-activities-that-improve-you\"\u003eHow Gallup test can help you find activities that improve you\u003c/h2\u003e\n\n\u003cp\u003eThe \u003ca href=\"https://www.gallup.com/cliftonstrengths/en/home.aspx\"\u003eGallup test\u003c/a\u003e\nhelps you find activities that you naturally enjoy doing. This natural response to certain types of information,\nsituations and people in the context of the Gallup test is called a talent. The test result is divided into four main\ndomains:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eExecuting\u003c/li\u003e\n  \u003cli\u003eInfluencing\u003c/li\u003e\n  \u003cli\u003eRelationship Building\u003c/li\u003e\n  \u003cli\u003eStrategic Thinking\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eSome of these will have a direct impact on your work, others will not. For example a description of your character in\nthe context of building relationships with people will be interesting information and will certainly raise your\nawareness, but will not help us in our challenge. Other talents that come out of the challenge may fit into the skill\nyou are developing or show how you should develop it.\u003c/p\u003e\n\n\u003cp\u003eOf course with these talents, the knowledge itself that you have a talent does not immediately translate into skills,\nfor example finding out that you have a talent for standing on your head, it does not mean that you will immediately\nstand on your head. You have to develop this talent, and you probably are already doing similar things because you\nsimply have a talent for it, and you enjoy it. So the Gallup test shows the things you should focus on. They are so\ngeneric that you can easily match them to your problems.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-12-09-choose-your-skills/gallup.png\" alt=\"Gallup\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eHere’s what it was like for me. I did the Gallup test, and it came out that I am a learner. I like to learn, and I\nshould share knowledge - which should make me happy. Comparing this talent to the list of skills I should develop, I\nfound out that I don’t share knowledge with others. I decided that a good form of knowledge transfer is to make\npresentations. I completed training in making presentations. I also estimated the time for preparation and set a\ndeadline. While preparing, I realized that this knowledge sharing strategy was not for me. I finished this presentation\nand decided to change my knowledge sharing strategy. Such a change in strategy is called a pivot. I discussed the\nproblem with my mentor and decided to make a pivot towards writing articles. Being in this situation you have two\nchoices: either you do a pivot, which means you change your strategy, or you persevere, which means you continue to\ndevelop using your current strategy, after getting proper feedback from your mentor and team of course. Let us now look\nat the second type of skill.\u003c/p\u003e\n\n\u003ch2 id=\"how-startup-method-can-help-you-develop-your-skills\"\u003eHow startup method can help you develop your skills\u003c/h2\u003e\n\n\u003cp\u003eLet us divide hard skills into two groups. In the first group there are skills you acquire while learning by yourself,\ne.g. a new programming language. For this you need internal motivation and discipline to achieve the expected high\nlevel. The second group is the one where you acquire skills automatically e.g. you use some framework in your project.\nFor the first group you can use the startup method.\n\u003cimg src=\"/img/articles/2021-12-09-choose-your-skills/startup.png\" alt=\"Startup\" /\u003e\nAn example scenario of what the process of developing hard skills might look like:\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003eChoose one skill with your mentor (the order does not matter). Additionally, collect the requirements.\u003c/li\u003e\n  \u003cli\u003eEstimate how long it will take you to develop that skill. Put it on your calendar.\u003c/li\u003e\n  \u003cli\u003eTogether with your mentor, set a first stage, i.e. the first prototype of your work and work on it for e.g. 2-3\nweeks.\u003c/li\u003e\n  \u003cli\u003eAfter this time, show what you have done to your mentor or the whole team.\u003c/li\u003e\n  \u003cli\u003eDraw conclusions. Collect feedback. Do you like doing it? Did the result meet their expectations?\u003c/li\u003e\n  \u003cli\u003eIf not, make a pivot to another strategy or take another skill. If so, improve what you collected during the feedback\nand keep developing.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eIn the worst case scenario you will go through all the skills. You will then have a fairly broad knowledge base. I have\nnever heard the opinion that someone learned something and now regrets it. In a positive scenario you will probably find\nsomething you do well and enjoy it.\u003c/p\u003e\n\n\u003cp\u003eWe will now look at the second group of skills, which you develop automatically while working on a project. Here again,\nyou should first consult with your mentor on the best strategy to follow. There are two strategies in such cases: to\ngain deep knowledge in one of these skills or to learn a little about all of them. The mentor should know what the team\nexpects from a specialist in the given position. This automatically affects the implementation of the tasks in the\nproject:\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003eYou perform tasks only in the domain you know and after some time you become a specialist in this area, but you do\nnot take tasks from another domain that is new to you. Your value is the speed of task completion.\u003c/li\u003e\n  \u003cli\u003eYou always take tasks from a new domain, you are brave and not afraid of challenges. You will then have a broad\ngeneral knowledge of all products but will complete tasks much more slowly.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThis is just one example. It is important that the mentor is clear about his requirements and that he gives you feedback\nafter you have done a few of these tasks to make sure that this is what you wanted.\u003c/p\u003e\n\n\u003ch2 id=\"pivot-or-persevere\"\u003ePivot or persevere\u003c/h2\u003e\n\n\u003cp\u003eFinally, let me explain the startup terms for pivot. The term pivot means to change from one strategy to another. For\nexample, I did one pivot during my development process. I was developing the skill of knowledge sharing. I had several\nstrategies to choose from:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eMaking presentations\u003c/li\u003e\n  \u003cli\u003eWriting articles\u003c/li\u003e\n  \u003cli\u003eTraining preparation\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eI made a presentation and after collecting feedback I had to make a \u003ccode class=\"language-plaintext highlighter-rouge\"\u003epivot\u003c/code\u003e and changed my strategy to another one. I\nchose to share knowledge by writing articles. This article is the result of that. If this strategy works for me then I\nwill do a \u003ccode class=\"language-plaintext highlighter-rouge\"\u003epersevere\u003c/code\u003e and continue using the chosen strategy.\u003c/p\u003e\n\n\u003ch2 id=\"summary\"\u003eSummary\u003c/h2\u003e\n\n\u003cp\u003eIf you feel that you should already be in a higher position it is likely that the expectations for your job are quite\ndifferent than you think. To change this you should first find a mentor and then, with their help, gather the\nrequirements. A good place to start is with a list of requirements or a list of skills to begin discussing with your\nmentor. From this list you should select a few skills and then choose appropriate strategies for their development. To\nmake it easier for you to choose a strategy, do a Gallup test. Additionally, you can use the startup MVP approach.\nUltimately, the key to success is to gather requirements from your leader, team or entire company and then show the\nresults as quickly as possible. If the chosen skill or strategy doesn’t suit you or the feedback collected is strongly\nnegative, don’t worry, make a pivot and choose something else. After a few iterations you will definitely achieve your\ngoal.\u003c/p\u003e\n","contentSnippet":"At some point in your career, you realize that it’s time to try to advance through the hierarchy. You think you are\ndoing a good job. You are constantly developing and learning something new. But at the same time, someone you know, with\nmuch less experience and knowledge than you, has long been higher up the hierarchy than you. Then you ask yourself:\nwhat is wrong with me? In my case, the answer turned out to be properly gathering the expectations concerning my skills\nand work.\nBelow, you can read my insight about it. You will find out how you can steer your development, so that you become much\nmore valuable to your team, leader or company and how to combine all this with your talents and interests.\nHow to start the development\nAs a member of a project team, you want to deliver a fully valuable solution. The key to success is to discover what’s\nbehind the word valuable to your client. Is it enough to gather requirements? Unfortunately not. To find out exactly\nwhat stands behind the word valuable you need to use a prototyping method, such as an iterative\nMVP (Minimum Viable Product) approach. For example, suppose you\nhave to paint your daughter’s room. You have several choices. You can choose the colour by yourself and paint the room\nwithout asking her for her opinion. The chance she will like the colour is small. So you will make a non-compliant\nproduct. You can bring her a sampler and ask her to choose a colour. The final colour when applied to the wall, may turn\nout to be different and then, the product will also not be as expected. You can also ask her about the colour and buy a\nfew samplers, paint a piece of wall with them and ask if any meet the requirements, if yes then paint the whole room\nwith the chosen colour, if not, buy another 5 colours and so on over and over until you get it right. This is the MVP\nprocess. First you gather requirements, then you prototype, which means you make a real product. You present it and\nreceive feedback (you learn) and decide what to do next. You repeat this process until you meet the client’s\nexpectations. This approach gives you the assurance that you have done exactly what was needed.\nImagine that your skills and the work you do are products. We already know that to make a valuable product you need to\ngather requirements and prototype with the client. Your customer who cares most about your work and skills are the team,\nthe leader and the company you work for. However, what you do must also suit you. If you want your work and your\nknowledge to be of value to them, you need to gather their requirements first. Then quickly show the result and make\nsure it’s what they wanted. You are probably wondering what this prototyping is for in the case of your work? You have\ndone some work, it has been accepted so what more is there to talk about. There could be lots of reasons. You could have\nspent too much time on it, it’s even possible that what you did is wrong. You would have to put in a huge amount of time\nand work to improve it, which is why it was accepted as it is. Without prototyping, your work might appear to be of good\nquality to you, but the team might not be happy with it.\nLet’s start with requirements gathering. Unfortunately it is impossible to gather universal requirements for a given\nposition since these requirements are different at different companies and even teams. The same person who has certain\nskills and performs certain tasks may be a senior in one company, where in another, he or she may be a junior. In one of\nthe companies I worked for, a good programmer was required to know the products and the business, then the tenure at the\ncompany mattered as well and being a support for the business. Performing a large number of tasks was not so important.\nIn another company, there were people who knew their product very well and were an excellent support to the business.\nHowever, they did not perform their tasks on time and did not take on issues that required them to undertake a lot of\nresponsibility. They still had junior or mid-level status.\n\nThis begs the question: how do I gather my skills requirements?\nAssess yourself with some evaluation sheets\nAt Allegro, in the case of programmers and testers, we have a list of expectations prepared within the leadership\ncommunity. With such a list, it is much easier to collect requirements and talk about your own development towards\npromotion (in the team or in the company).\nIn my case, after working at Allegro for a while, I decided that it might be a good idea to finally get my development\non track. My leader asked me to assess myself using a requirements sheet. This allowed me to identify the current stage\nI was at. The same sheet about me was completed by my leader. Then we calibrated ourselves. This sheet is divided into 3\nmain parts:\nTechnical knowledge\nAttitude\nProduct knowledge\nEach part has a list of skills, each with an extensive description. For example, one of the descriptions of technical\nknowledge looked like this:\nYou know your technological stack very well (systems, applications, languages, tools). Having a technical problem to\nsolve, you know what your technological abilities are, and you know how to use them to achieve your goal.\nI rated each skill on a scale of 1 to 5. Ideally, I would like each skill to be close to a 5. If I rated myself\nsomewhere at a 4 and my leader rated me a 3, during calibration, I found out that the requirements for that skill were\ndifferent from what I thought. He said, there were things I hadn’t used yet. To have a 4 at this point I need to know\nthem e.g. Cassandra database. With that I learned the first relevant requirement that I didn’t know about. After the\nwhole process of gathering requirements this way, I already knew what I needed to work on. Now all I had to do was\nselect a few of them and start working. But how to choose these requirements, which I will implement with passion and\nactually do them well?\nHow to choose skills to improve?\nThere are many strategies on how to choose skills to develop. All in all, you need to use the right method for the right\ntype of skill to get a good result. The first step is to get a mentor. Usually it will be your leader, but it can also\nbe an experienced team member, e.g. a senior.\nLeaders at Allegro gain their development knowledge from many available training sessions. You should find a similar\nperson in your environment. Such a person will help you on your way and will simulate the customer of the product that\nyou will be making. Show him or her a list of things you should develop. Ask them which are the most important for your\nteam. It is possible that the list of things will become very short. Now just pick two or three things and prepare\nprototypes. You can choose them intuitively or match them with your talents. Just take a Gallup\ntest (CliftonStrengths) to discover them. This test will help\nyou choose a strategy for developing a particular skill. This test will work well for soft skills. For hard skills\na lean startup strategy may be better. Below are two examples of what this\ncan look like in practice.\nHow Gallup test can help you find activities that improve you\nThe Gallup test\nhelps you find activities that you naturally enjoy doing. This natural response to certain types of information,\nsituations and people in the context of the Gallup test is called a talent. The test result is divided into four main\ndomains:\nExecuting\nInfluencing\nRelationship Building\nStrategic Thinking\nSome of these will have a direct impact on your work, others will not. For example a description of your character in\nthe context of building relationships with people will be interesting information and will certainly raise your\nawareness, but will not help us in our challenge. Other talents that come out of the challenge may fit into the skill\nyou are developing or show how you should develop it.\nOf course with these talents, the knowledge itself that you have a talent does not immediately translate into skills,\nfor example finding out that you have a talent for standing on your head, it does not mean that you will immediately\nstand on your head. You have to develop this talent, and you probably are already doing similar things because you\nsimply have a talent for it, and you enjoy it. So the Gallup test shows the things you should focus on. They are so\ngeneric that you can easily match them to your problems.\n\nHere’s what it was like for me. I did the Gallup test, and it came out that I am a learner. I like to learn, and I\nshould share knowledge - which should make me happy. Comparing this talent to the list of skills I should develop, I\nfound out that I don’t share knowledge with others. I decided that a good form of knowledge transfer is to make\npresentations. I completed training in making presentations. I also estimated the time for preparation and set a\ndeadline. While preparing, I realized that this knowledge sharing strategy was not for me. I finished this presentation\nand decided to change my knowledge sharing strategy. Such a change in strategy is called a pivot. I discussed the\nproblem with my mentor and decided to make a pivot towards writing articles. Being in this situation you have two\nchoices: either you do a pivot, which means you change your strategy, or you persevere, which means you continue to\ndevelop using your current strategy, after getting proper feedback from your mentor and team of course. Let us now look\nat the second type of skill.\nHow startup method can help you develop your skills\nLet us divide hard skills into two groups. In the first group there are skills you acquire while learning by yourself,\ne.g. a new programming language. For this you need internal motivation and discipline to achieve the expected high\nlevel. The second group is the one where you acquire skills automatically e.g. you use some framework in your project.\nFor the first group you can use the startup method.\n\nAn example scenario of what the process of developing hard skills might look like:\nChoose one skill with your mentor (the order does not matter). Additionally, collect the requirements.\nEstimate how long it will take you to develop that skill. Put it on your calendar.\nTogether with your mentor, set a first stage, i.e. the first prototype of your work and work on it for e.g. 2-3\nweeks.\nAfter this time, show what you have done to your mentor or the whole team.\nDraw conclusions. Collect feedback. Do you like doing it? Did the result meet their expectations?\nIf not, make a pivot to another strategy or take another skill. If so, improve what you collected during the feedback\nand keep developing.\nIn the worst case scenario you will go through all the skills. You will then have a fairly broad knowledge base. I have\nnever heard the opinion that someone learned something and now regrets it. In a positive scenario you will probably find\nsomething you do well and enjoy it.\nWe will now look at the second group of skills, which you develop automatically while working on a project. Here again,\nyou should first consult with your mentor on the best strategy to follow. There are two strategies in such cases: to\ngain deep knowledge in one of these skills or to learn a little about all of them. The mentor should know what the team\nexpects from a specialist in the given position. This automatically affects the implementation of the tasks in the\nproject:\nYou perform tasks only in the domain you know and after some time you become a specialist in this area, but you do\nnot take tasks from another domain that is new to you. Your value is the speed of task completion.\nYou always take tasks from a new domain, you are brave and not afraid of challenges. You will then have a broad\ngeneral knowledge of all products but will complete tasks much more slowly.\nThis is just one example. It is important that the mentor is clear about his requirements and that he gives you feedback\nafter you have done a few of these tasks to make sure that this is what you wanted.\nPivot or persevere\nFinally, let me explain the startup terms for pivot. The term pivot means to change from one strategy to another. For\nexample, I did one pivot during my development process. I was developing the skill of knowledge sharing. I had several\nstrategies to choose from:\nMaking presentations\nWriting articles\nTraining preparation\nI made a presentation and after collecting feedback I had to make a pivot and changed my strategy to another one. I\nchose to share knowledge by writing articles. This article is the result of that. If this strategy works for me then I\nwill do a persevere and continue using the chosen strategy.\nSummary\nIf you feel that you should already be in a higher position it is likely that the expectations for your job are quite\ndifferent than you think. To change this you should first find a mentor and then, with their help, gather the\nrequirements. A good place to start is with a list of requirements or a list of skills to begin discussing with your\nmentor. From this list you should select a few skills and then choose appropriate strategies for their development. To\nmake it easier for you to choose a strategy, do a Gallup test. Additionally, you can use the startup MVP approach.\nUltimately, the key to success is to gather requirements from your leader, team or entire company and then show the\nresults as quickly as possible. If the chosen skill or strategy doesn’t suit you or the feedback collected is strongly\nnegative, don’t worry, make a pivot and choose something else. After a few iterations you will definitely achieve your\ngoal.","guid":"https://blog.allegro.tech/2021/12/choose-your-skills.html","categories":["tech","education","skills","startup","lean startup","mvp"],"isoDate":"2021-12-08T23:00:00.000Z","thumbnail":"images/post-headers/default.jpg"},{"title":"Moving towards Micronaut","link":"https://blog.allegro.tech/2021/11/micronaut.html","pubDate":"Mon, 22 Nov 2021 00:00:00 +0100","authors":{"author":[{"name":["Konrad Kamiński"],"photo":["https://blog.allegro.tech/img/authors/konrad.kaminski.jpg"],"url":["https://blog.allegro.tech/authors/konrad.kaminski"]}]},"content":"\u003cp\u003e\u003ca href=\"https://micronaut.io\"\u003eMicronaut\u003c/a\u003e is one of the new application frameworks that have recently sprung up. It promises\nlow memory usage and faster application startup. At \u003ca href=\"https://allegro.tech/\"\u003eAllegro\u003c/a\u003e we decided to give it a try. In this article we’ll learn what\ncame out of it and if it’s worth considering when creating microservices-based systems.\u003c/p\u003e\n\n\u003ch2 id=\"paradise-city\"\u003eParadise city\u003c/h2\u003e\n\u003cp\u003eAt Allegro we run a few hundred microservices, most of which use Spring Framework. We also have services created in other technologies.\nAnd to make things more complicated we run them on a few different types of clouds - our own \u003ca href=\"http://mesos.apache.org/\"\u003eMesos\u003c/a\u003e-based as well as private and public \u003ca href=\"https://kubernetes.io/\"\u003ek8s\u003c/a\u003e-based ones.\nTherefore in order for all of it to work consistently and smoothly we created a number of supporting libraries and at the same time we defined a kind of\ncontract for all services. This way, if there is ever a need or will to create a service with a new shiny technology, it should be feasible with as little\nwork as possible. You can read more about this approach in \u003ca href=\"https://blog.allegro.tech/2020/07/common-code-approach.html\"\u003ea great article by Piotr Betkier\u003c/a\u003e.\u003c/p\u003e\n\n\u003ch2 id=\"you-gotta-fight-for-your-right-to-party\"\u003e(You Gotta) Fight for Your Right (To Party!)\u003c/h2\u003e\n\u003cp\u003eIn order to be up to date with current technologies, at Allegro we run hackathons where we try out the “trendy” solutions. Over a year ago\nwe decided to taste Micronaut. The framework represents one of the new approaches to some of the inherent problems of existing solutions:\nit steers clear of using Java Reflection and does as much as it can at compile or rather build time. Major things achieved this way are:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003elower memory usage - Java Reflection in most current JDK implementations is a memory hog; Micronaut has its own implementation of Java Reflection-like API\nwhich doesn’t suffer from that problem,\u003c/li\u003e\n  \u003cli\u003efaster startup - Java Reflection is also not a speed daemon; doing things ahead of time means less has to be done at runtime,\u003c/li\u003e\n  \u003cli\u003eability to create native apps - \u003ca href=\"https://www.graalvm.org\"\u003eGraalVM\u003c/a\u003e, another new kid on the block, allows creating native binaries out of a JVM-based application; however, there\nare some caveats and one of them is… Java Reflection (basically if your application uses it, it has to provide some metadata for the native compiler). Since\nMicronaut has its own implementation, the problem is simply non-existent.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWe wanted to see how difficult it is to create a new microservice with Micronaut that would run on our on-premise cloud and do something meaningful. So during\nour hackathon we defined the following goals for our simple app:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003eit should be possible to deploy the app on our on-premise cloud,\u003c/li\u003e\n  \u003cli\u003ethe app should provide and use basic functionalities, such as:\n    \u003cul\u003e\n      \u003cli\u003etelemetry,\u003c/li\u003e\n      \u003cli\u003econfiguration management,\u003c/li\u003e\n      \u003cli\u003eREST endpoints,\u003c/li\u003e\n      \u003cli\u003eability to call other microservices,\u003c/li\u003e\n      \u003cli\u003eability to send messages to \u003ca href=\"https://github.com/allegro/hermes\"\u003eHermes\u003c/a\u003e,\u003c/li\u003e\n      \u003cli\u003edatabase access (we voted for MongoDB),\u003c/li\u003e\n      \u003cli\u003e(optionally) ability to be compiled into a native binary with GraalVM.\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAfter a very satisfying hackathon we carried the day. Our microservice had all the above-mentioned functionalities - some of them obviously\nin a makeshift form, but that didn’t matter. We achieved all the goals.\u003c/p\u003e\n\n\u003ch2 id=\"highway-to-hell\"\u003eHighway to Hell\u003c/h2\u003e\n\u003cp\u003eThe result of the hackathon pushed us forward to make something even bolder. We wanted to have a real Micronaut-based application in our production environment.\nTo make things harder - we wanted to convert an existing Spring-based system to a Micronaut-based one. Though we reached our destination, the road\nwas quite bumpy. Let’s see what awaits those who take that path.\u003c/p\u003e\n\n\u003ch3 id=\"paranoid\"\u003eParanoid\u003c/h3\u003e\n\u003cp\u003eTo ease a migration from Spring a special \u003ca href=\"https://micronaut-projects.github.io/micronaut-spring/latest/guide/\"\u003emicronaut-spring\u003c/a\u003e project has been created.\nIt supports a limited selection of Spring annotations and functionality so that in theory one can just replace Spring dependencies with Micronaut ones.\nSpecifically among the most interesting features are:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003estandard inversion of control annotations: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@Component\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@Service\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@Repository\u003c/code\u003e,\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@Bean\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@Autowired\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@Configuration\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@Primary\u003c/code\u003e and many others\nare converted into their Micronaut counterparts,\u003c/li\u003e\n  \u003cli\u003estandard Spring interfaces: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@Environment\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@ApplicationEventPublisher\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@ApplicationContext\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@BeanFactory\u003c/code\u003e and their \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@*Aware\u003c/code\u003e versions are also\nadapted to their Micronaut counterparts,\u003c/li\u003e\n  \u003cli\u003eMVC controller annotations: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@RestController\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@GetMapping\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@PostMapping\u003c/code\u003e and many others are converted into their Micronaut counterparts.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThis makes the whole exercise simpler, but unfortunately it also comes at a price. Not all features are supported (e.g. Spring’s \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@PathVariable\u003c/code\u003e is not)\nand for those which are, they sometimes have subtle differences. For this reason oftentimes you simply have to revert to the regular manual code\nconversion. The problem is that this kind of approach will lead you to a mixed solution - you’ll have both Micronaut and Spring annotations in your code.\nAnd then a question arises: which annotations should I use for the newly created code? Do we stick with the old Spring annotations if there is even\none instance of it in the current codebase? Or maybe treat this old code as a “necessary evil” and always put Micronaut annotations for the added functionality?\u003c/p\u003e\n\n\u003cp\u003eWe came to the conclusion that we did not want to use \u003cem\u003emicronaut-spring\u003c/em\u003e at all. This\nof course led to more work, but in the end we think it was worth it. The converted application does not have any Spring dependencies, no “technical debt”.\u003c/p\u003e\n\n\u003ch3 id=\"sad-but-true\"\u003eSad but True\u003c/h3\u003e\n\n\u003cp\u003eOne of the things not covered at all by \u003cem\u003emicronaut-spring\u003c/em\u003e is exception handling in MVC.\nIn Spring our handlers looked something like this:\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.springframework.http.HttpStatus.BAD_REQUEST\u003c/span\u003e\n\n\u003cspan class=\"nd\"\u003e@ControllerAdvice\u003c/span\u003e\n\u003cspan class=\"nd\"\u003e@Order\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eOrdered\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eHIGHEST_PRECEDENCE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDefaultExceptionHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"nd\"\u003e@ExceptionHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eSomeException\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nd\"\u003e@ResponseBody\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003ehandleSomeException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eSomeException\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eResponseEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"err\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eResponseEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eApiError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eBAD_REQUEST\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIn Micronaut exception handling can be done locally (i.e. functions handling exception will only be used for the exceptions thrown by the controller the\nfunctions are defined in) or globally. Since our Spring handlers acted globally, the equivalent Micronaut code is as follows:\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eio.micronaut.http.HttpStatus.BAD_REQUEST\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eio.micronaut.http.annotation.Error\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nc\"\u003eHttpError\u003c/span\u003e\n\n\u003cspan class=\"nd\"\u003e@Controller\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDefaultExceptionHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"nd\"\u003e@Error\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eglobal\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003ehandleSomeException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eSomeException\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eHttpResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"err\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"nc\"\u003eHttpResponseFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eINSTANCE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eBAD_REQUEST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eApiError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"dirty-deeds-done-dirt-cheap\"\u003eDirty Deeds Done Dirt Cheap\u003c/h3\u003e\n\n\u003cp\u003eAt Allegro we use many different types of databases. The application of this exercise used MongoDB. As it turned out we couldn’t have chosen worse. Don’t get me\nwrong - Micronaut supports most of the databases out there, but not all are treated equally well.\u003c/p\u003e\n\n\u003cp\u003eSince our system used \u003ca href=\"https://spring.io/projects/spring-data\"\u003eSpring Data\u003c/a\u003e, we tried to find something similar from the Micronaut world. \u003ca href=\"https://micronaut-projects.github.io/micronaut-data/latest/guide/\"\u003eMicronaut Data\u003c/a\u003e\nis - as its authors say - “inspired by \u003cem\u003eGORM\u003c/em\u003e and \u003cem\u003eSpring Data\u003c/em\u003e”. Unfortunately the inspiration doesn’t go too far. And in case of MongoDB it actually \u003ca href=\"https://github.com/micronaut-projects/micronaut-data/issues/220\"\u003edoesn’t even\ntake a step\u003c/a\u003e. Instead, we used \u003ca href=\"https://micronaut-projects.github.io/micronaut-mongodb/latest/guide/\"\u003eMicronaut MongoDB\u003c/a\u003e library. This simple project will provide\nyour services only with either a \u003ca href=\"https://mongodb.github.io/mongo-java-driver/4.3/apidocs/mongodb-driver-legacy/com/mongodb/MongoClient.html\"\u003eblocking MongoClient\u003c/a\u003e or a\n\u003ca href=\"https://mongodb.github.io/mongo-java-driver/4.3/apidocs/mongodb-driver-reactivestreams/com/mongodb/reactivestreams/client/MongoClient.html\"\u003ereactive MongoClient\u003c/a\u003e\nalong with some healthchecks. Not enough even for a modest application.\u003c/p\u003e\n\n\u003cp\u003eFortunately some good people created \u003ca href=\"https://litote.org/kmongo/\"\u003ekmongo\u003c/a\u003e - a little library that helped us a lot in converting the database access part of our app.\nAt the end of the day, however, we had to create some support code to ease the migration.\u003c/p\u003e\n\n\u003cp\u003eThe original application database access code was in the form of reactive repositories:\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.springframework.data.annotation.Id\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.springframework.data.mongodb.core.mapping.Document\u003c/span\u003e\n\n\u003cspan class=\"nd\"\u003e@Document\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecollection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"users\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003edata class\u003c/span\u003e \u003cspan class=\"nc\"\u003eUser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"nd\"\u003e@Id\u003c/span\u003e \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUserRepository\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eReactiveMongoRepository\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eUser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003efindFirstByTypeOrderByNameDesc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eMono\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eUser\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWe wanted to preserve the interface and as much code as possible. Here is what we had to do to get this effect.\u003c/p\u003e\n\n\u003cp\u003eFirst we decided that our components would use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eMongoDatabase\u003c/code\u003e rather than \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eMongoClient\u003c/code\u003e offered by \u003cem\u003eMicronaut MongoDB\u003c/em\u003e.\nWe had only one database so that was an obvious choice.\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nd\"\u003e@Factory\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMongoConfig\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nd\"\u003e@Singleton\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003emongoDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emongoClient\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eMongoClient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econfiguration\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eDefaultMongoConfiguration\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eMongoDatabase\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emongoClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econfiguration\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econnectionString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003edatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThen there was the question of configuring \u003cem\u003ekmongo\u003c/em\u003e. It wasn’t as straightforward as we’d thought it would be. Let’s take a look at the\nfinal code.\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nd\"\u003e@Factory\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eKMongoFactory\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"nd\"\u003e@Singleton\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003ekCodecRegistry\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nc\"\u003eCodecRegistry\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nc\"\u003eObjectMappingConfiguration\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eaddCustomCodec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eJodaDateSerializationCodec\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 1 - custom Joda DateTime coded\u003c/span\u003e\n        \u003cspan class=\"nc\"\u003eKMongoConfiguration\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eregisterBsonModule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eJodaModule\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e                  \u003cspan class=\"c1\"\u003e// 2 - register default Joda module\u003c/span\u003e\n        \u003cspan class=\"nc\"\u003eKMongoConfiguration\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eregisterBsonModule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eJodaDateSerializationModule\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// 3 - register custom Joda module\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eKMongoConfiguration\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebsonMapper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efactory\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nc\"\u003eBsonFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e         \u003cspan class=\"c1\"\u003e// 4 - change BigDecimal handling\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003edisable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eBsonGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eFeature\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eWRITE_BIGDECIMALS_AS_DECIMAL128\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eenable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eBsonGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eFeature\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eWRITE_BIGDECIMALS_AS_STRINGS\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nc\"\u003eClassMappingType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ecodecRegistry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eMongoClientSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetDefaultCodecRegistry\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eMongoDB\u003c/code\u003e driver expects a \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eCodecRegistry\u003c/code\u003e which defines how to encode a Java object into Mongo \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eBSON\u003c/code\u003e, so that it can be persisted in a database. By default\n\u003cem\u003ekmongo\u003c/em\u003e supports a simple, \u003ca href=\"https://github.com/FasterXML/jackson\"\u003eJackson\u003c/a\u003e based converter. However, there were a few issues in\nour application which forced us to create some customizations:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ca href=\"https://www.joda.org/joda-time/\"\u003eJoda\u003c/a\u003e date types in entity classes - our app has a long history and it still uses \u003cem\u003eJoda\u003c/em\u003e date types.\nUnfortunately they do not work with \u003cem\u003ekmongo\u003c/em\u003e, so we had to teach it how to handle them. It required a few steps.\n    \u003cul\u003e\n      \u003cli\u003e\n        \u003cp\u003e(1) \u003cem\u003ekmongo\u003c/em\u003e had to know how to serialize a \u003cem\u003eJoda\u003c/em\u003e date type to a \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eMongoDB\u003c/code\u003e date type:\u003c/p\u003e\n\n        \u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eobject\u003c/span\u003e \u003cspan class=\"nc\"\u003eJodaDateSerializationCodec\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eCodec\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003eencode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eBsonWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"n\"\u003eencoderContext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eEncoderContext\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ewriteNull\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ewriteDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emillis\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003egetEncoderClass\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nc\"\u003eClass\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejava\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eBsonReader\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edecoderContext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eDecoderContext\u003c/span\u003e\u003cspan class=\"p\"\u003e?):\u003c/span\u003e \u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ereadDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e        \u003c/div\u003e\n      \u003c/li\u003e\n      \u003cli\u003e(2) \u003cem\u003eJackson\u003c/em\u003e used by \u003cem\u003ekmongo\u003c/em\u003e also had to know how to handle \u003cem\u003eJoda\u003c/em\u003e date types,\u003c/li\u003e\n      \u003cli\u003e\n        \u003cp\u003e(3) to make things harder sometimes we stored a datetime as a long value, therefore we had to add support for that as well:\u003c/p\u003e\n\n        \u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eobject\u003c/span\u003e \u003cspan class=\"nc\"\u003eJodaDateSerializationModule\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eSimpleModule\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003einit\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eaddSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejava\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eJodaDateSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eaddDeserializer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejava\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eJodaDateDeserializer\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eJodaDateSerializer\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eJsonSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003eserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003egen\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eJsonGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eserializers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eSerializerProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003egen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ewriteObject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etoDate\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eJodaDateDeserializer\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eJsonDeserializer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003edeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparser\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eJsonParser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ectxt\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eDeserializationContext\u003c/span\u003e\u003cspan class=\"p\"\u003e?):\u003c/span\u003e \u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewhen\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrentToken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nc\"\u003eJsonToken\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eVALUE_NUMBER_INT\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ereadValueAs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejava\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003elet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ereadValueAs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eDate\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejava\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003elet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"nc\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e        \u003c/div\u003e\n      \u003c/li\u003e\n      \u003cli\u003e(4) finally we stored \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eBigDecimal\u003c/code\u003e values as plain \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eString\u003c/code\u003e, which is not a default behaviour of \u003cem\u003ekmongo\u003c/em\u003e, so we had to change it.\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAs you can see some of the problems we had to face came from using either old technologies or not using them properly. It turned out there were more issues.\u003c/p\u003e\n\n\u003cp\u003eFor our entity IDs we usually used an artificial \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eString\u003c/code\u003e value. \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eMongoDB\u003c/code\u003e has special support for it in a form of \u003ca href=\"https://docs.mongodb.com/manual/reference/method/ObjectId/\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eObjectId\u003c/code\u003e\u003c/a\u003e\ntype, which we gladly used in our application. But, here a new issue came up - in order to make our integration tests easier to read and write we used \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eString\u003c/code\u003e-type IDs\nnot conformant to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eObjectId\u003c/code\u003e restrictions (so for example our user IDs were \u003ccode class=\"language-plaintext highlighter-rouge\"\u003euser-1\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003euser-2\u003c/code\u003e, etc.).\n\u003cem\u003eSpring Data\u003c/em\u003e handles this transparently, but here we had to introduce one more customization. Our entity classes now\nhad to contain a special annotation indicating what serializer to use for our ID fields:\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.bson.codecs.pojo.annotations.BsonId\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003edata class\u003c/span\u003e \u003cspan class=\"nc\"\u003eUser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"nd\"\u003e@BsonId\u003c/span\u003e \u003cspan class=\"nd\"\u003e@JsonSerialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eCustomIdJsonSerializer\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eCustomIdJsonSerializer\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eStdScalarSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejava\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003eserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"n\"\u003egen\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eJsonGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eserializers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eSerializerProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nc\"\u003eObjectId\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisValid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003egen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ewriteObjectId\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eObjectId\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003egen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ewriteString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003eserializeWithType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"n\"\u003egen\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eJsonGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eserializers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eSerializerProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"n\"\u003etypeSer\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eTypeSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003egen\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eserializers\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003eisEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eBoolean\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003eacceptJsonFormatVisitor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evisitor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eJsonFormatVisitorWrapper\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"n\"\u003etypeHint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eJavaType\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003evisitStringFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evisitor\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etypeHint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWith the basics set up we could now focus on how to make the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e*Repository\u003c/code\u003e classes work with as little effort as possible. We decided to create a base \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eBaseRepository\u003c/code\u003e\nclass letting us write concrete \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e*Repository\u003c/code\u003e classes easier:\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBaseRepository\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003emongoDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eMongoDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003ecollectionName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003eclazz\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eClass\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eopen\u003c/span\u003e \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003efindById\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eMono\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003efindOne\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eeq\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003emaybeObjectId\u003c/span\u003e\u003cspan class=\"p\"\u003e()))\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003efindOne\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eBson\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eMono\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003ewithCollection\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003etoMono\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003ewithCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eMongoCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.()\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eR\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eR\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emongoDatabase\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecollectionName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eclazz\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003elet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eFinally we wrote the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e*Repository\u003c/code\u003e classes. A rewritten version of the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eUserRepository\u003c/code\u003e mentioned at the beginning of this section looked like this:\u003c/p\u003e\n\n\u003cdiv class=\"language-kotlin highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nd\"\u003e@Context\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUserRepository\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emongoDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eMongoDatabase\u003c/span\u003e\n\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eBaseRepository\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eUser\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003emongoDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"users\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eUser\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejava\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003efindFirstByTypeOrderByNameDesc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nc\"\u003eMono\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eUser\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003ewithCollection\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eeq\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"type\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esort\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003edescending\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003elimit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etoMono\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"fear-of-the-dark\"\u003eFear of the Dark\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://spockframework.org/spock/docs/2.0/index.html\"\u003eSpock\u003c/a\u003e is our framework of choice for writing tests. We still tend to use it even in \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eKotlin\u003c/code\u003e applications,\nalthough sometimes the resulting code is not as clear as it’d be if not for \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eGroovy\u003c/code\u003e (`coroutines!). So how does\n\u003cem\u003eMicronaut\u003c/em\u003e work with \u003cem\u003eSpock\u003c/em\u003e? Actually, quite well.\u003c/p\u003e\n\n\u003cp\u003eFor testing there is a \u003ca href=\"https://github.com/micronaut-projects/micronaut-test\"\u003emicronaut-test\u003c/a\u003e project, which provides testing extensions for \u003cem\u003eSpock\u003c/em\u003e\nand many other testing libraries. \u003ca href=\"https://docs.spring.io/spring-framework/docs/current/reference/html/testing.html\"\u003eThe general approach to writing test cases with Spring\u003c/a\u003e which we were familiar with,\nis very similar in \u003cem\u003emicronaut-test\u003c/em\u003e. Let’s have a look at a simple test case:\u003c/p\u003e\n\n\u003cdiv class=\"language-groovy highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nd\"\u003e@MicronautTest\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 1\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSimpleIntSpec\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"n\"\u003eSpecification\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nd\"\u003e@Inject\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 2\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eUserService\u003c/span\u003e \u003cspan class=\"n\"\u003euserService\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003edef\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"should persist a user\"\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nl\"\u003egiven:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003euserService\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ecreateUser\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"user-1\"\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"John\"\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Doe\"\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"nl\"\u003ewhen:\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003euserService\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetUser\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"user-1\"\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"nl\"\u003ethen:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003efirstName\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"John\"\u003c/span\u003e\n        \u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003elastName\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Doe\"\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThere are two interesting things in this test case:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003e(1) \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@MicronautTest\u003c/code\u003e is an annotation you have to put in your test classes to start \u003cem\u003eMicronaut\u003c/em\u003e application,\u003c/li\u003e\n  \u003cli\u003e(2) \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@Inject\u003c/code\u003e is \u003ca href=\"https://micronaut.io/\"\u003eMicronaut\u003c/a\u003e’s version of \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@Autowired\u003c/code\u003e (or… \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@Inject\u003c/code\u003e, which is also supported by \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eSpring\u003c/code\u003e). Be aware that since\n\u003cem\u003eMicronaut\u003c/em\u003e \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e3.0.0\u003c/code\u003e you should use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@jakarta.inject.Inject\u003c/code\u003e annotation instead of the former \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@javax.inject.Inject\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIf your tests make API calls to your application via REST endpoints, and you run your web container on a random port (which is common), then the way to retrieve it\nis through the use of the injected \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eEmbeddedServer\u003c/code\u003e:\u003c/p\u003e\n\n\u003cdiv class=\"language-groovy highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nd\"\u003e@MicronautTest\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eApiIntSpec\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"n\"\u003eSpecification\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nd\"\u003e@Inject\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eEmbeddedServer\u003c/span\u003e \u003cspan class=\"n\"\u003eserver\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003edef\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"should create a user using API call\"\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nl\"\u003egiven:\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"http://localhost:{$server.port}/users\"\u003c/span\u003e\n\n        \u003cspan class=\"nl\"\u003ewhen:\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// here goes your test...\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"money\"\u003eMoney\u003c/h2\u003e\n\n\u003cp\u003eAs a side effect, an additional benefit you get when you use \u003cem\u003eMicronaut\u003c/em\u003e is a faster development cycle. As stated at the\nbeginning of this post, one of the main features of this framework is faster startup. Therefore, when writing test cases and then running tests,\ntheir execution time is lower than their Spring equivalent. This may not be significant if your tests are few, but sooner or later\ntheir number will grow and then the speed will become more visible and important. For large codebases time savings can be really impressive.\u003c/p\u003e\n\n\u003ch2 id=\"should-i-stay-or-should-i-go\"\u003eShould I stay or should I go\u003c/h2\u003e\n\n\u003cp\u003eThe experience we gained during migration to \u003cem\u003eMicronaut\u003c/em\u003e gave us more courage and assurance. So when the time came to decide what technology\nto use for a quite large greenfield project, we didn’t hesitate (well, we actually did, but not for long).\nSix months later with the system running in the production environment we’re happy we started that long journey. And if you’re considering\n\u003cem\u003eMicronaut\u003c/em\u003e for one of your projects, I can wholeheartedly recommend: go for it.\u003c/p\u003e\n","contentSnippet":"Micronaut is one of the new application frameworks that have recently sprung up. It promises\nlow memory usage and faster application startup. At Allegro we decided to give it a try. In this article we’ll learn what\ncame out of it and if it’s worth considering when creating microservices-based systems.\nParadise city\nAt Allegro we run a few hundred microservices, most of which use Spring Framework. We also have services created in other technologies.\nAnd to make things more complicated we run them on a few different types of clouds - our own Mesos-based as well as private and public k8s-based ones.\nTherefore in order for all of it to work consistently and smoothly we created a number of supporting libraries and at the same time we defined a kind of\ncontract for all services. This way, if there is ever a need or will to create a service with a new shiny technology, it should be feasible with as little\nwork as possible. You can read more about this approach in a great article by Piotr Betkier.\n(You Gotta) Fight for Your Right (To Party!)\nIn order to be up to date with current technologies, at Allegro we run hackathons where we try out the “trendy” solutions. Over a year ago\nwe decided to taste Micronaut. The framework represents one of the new approaches to some of the inherent problems of existing solutions:\nit steers clear of using Java Reflection and does as much as it can at compile or rather build time. Major things achieved this way are:\nlower memory usage - Java Reflection in most current JDK implementations is a memory hog; Micronaut has its own implementation of Java Reflection-like API\nwhich doesn’t suffer from that problem,\nfaster startup - Java Reflection is also not a speed daemon; doing things ahead of time means less has to be done at runtime,\nability to create native apps - GraalVM, another new kid on the block, allows creating native binaries out of a JVM-based application; however, there\nare some caveats and one of them is… Java Reflection (basically if your application uses it, it has to provide some metadata for the native compiler). Since\nMicronaut has its own implementation, the problem is simply non-existent.\nWe wanted to see how difficult it is to create a new microservice with Micronaut that would run on our on-premise cloud and do something meaningful. So during\nour hackathon we defined the following goals for our simple app:\nit should be possible to deploy the app on our on-premise cloud,\nthe app should provide and use basic functionalities, such as:\n    \ntelemetry,\nconfiguration management,\nREST endpoints,\nability to call other microservices,\nability to send messages to Hermes,\ndatabase access (we voted for MongoDB),\n(optionally) ability to be compiled into a native binary with GraalVM.\nAfter a very satisfying hackathon we carried the day. Our microservice had all the above-mentioned functionalities - some of them obviously\nin a makeshift form, but that didn’t matter. We achieved all the goals.\nHighway to Hell\nThe result of the hackathon pushed us forward to make something even bolder. We wanted to have a real Micronaut-based application in our production environment.\nTo make things harder - we wanted to convert an existing Spring-based system to a Micronaut-based one. Though we reached our destination, the road\nwas quite bumpy. Let’s see what awaits those who take that path.\nParanoid\nTo ease a migration from Spring a special micronaut-spring project has been created.\nIt supports a limited selection of Spring annotations and functionality so that in theory one can just replace Spring dependencies with Micronaut ones.\nSpecifically among the most interesting features are:\nstandard inversion of control annotations: @Component, @Service, @Repository,@Bean, @Autowired, @Configuration, @Primary and many others\nare converted into their Micronaut counterparts,\nstandard Spring interfaces: @Environment, @ApplicationEventPublisher, @ApplicationContext, @BeanFactory and their @*Aware versions are also\nadapted to their Micronaut counterparts,\nMVC controller annotations: @RestController, @GetMapping, @PostMapping and many others are converted into their Micronaut counterparts.\nThis makes the whole exercise simpler, but unfortunately it also comes at a price. Not all features are supported (e.g. Spring’s @PathVariable is not)\nand for those which are, they sometimes have subtle differences. For this reason oftentimes you simply have to revert to the regular manual code\nconversion. The problem is that this kind of approach will lead you to a mixed solution - you’ll have both Micronaut and Spring annotations in your code.\nAnd then a question arises: which annotations should I use for the newly created code? Do we stick with the old Spring annotations if there is even\none instance of it in the current codebase? Or maybe treat this old code as a “necessary evil” and always put Micronaut annotations for the added functionality?\nWe came to the conclusion that we did not want to use micronaut-spring at all. This\nof course led to more work, but in the end we think it was worth it. The converted application does not have any Spring dependencies, no “technical debt”.\nSad but True\nOne of the things not covered at all by micronaut-spring is exception handling in MVC.\nIn Spring our handlers looked something like this:\n\nimport org.springframework.http.HttpStatus.BAD_REQUEST\n\n@ControllerAdvice\n@Order(Ordered.HIGHEST_PRECEDENCE)\nclass DefaultExceptionHandler {\n\n    @ExceptionHandler(SomeException::class)\n    @ResponseBody\n    fun handleSomeException(e: SomeException): ResponseEntity\u003c*\u003e = ResponseEntity(ApiError(e.message), BAD_REQUEST)\n}\n\n\nIn Micronaut exception handling can be done locally (i.e. functions handling exception will only be used for the exceptions thrown by the controller the\nfunctions are defined in) or globally. Since our Spring handlers acted globally, the equivalent Micronaut code is as follows:\n\nimport io.micronaut.http.HttpStatus.BAD_REQUEST\nimport io.micronaut.http.annotation.Error as HttpError\n\n@Controller\nclass DefaultExceptionHandler {\n\n    @Error(global = true)\n    fun handleSomeException(e: SomeException): HttpResponse\u003c*\u003e =\n        HttpResponseFactory.INSTANCE.status(BAD_REQUEST, ApiError(e.message))\n}\n\n\nDirty Deeds Done Dirt Cheap\nAt Allegro we use many different types of databases. The application of this exercise used MongoDB. As it turned out we couldn’t have chosen worse. Don’t get me\nwrong - Micronaut supports most of the databases out there, but not all are treated equally well.\nSince our system used Spring Data, we tried to find something similar from the Micronaut world. Micronaut Data\nis - as its authors say - “inspired by GORM and Spring Data”. Unfortunately the inspiration doesn’t go too far. And in case of MongoDB it actually doesn’t even\ntake a step. Instead, we used Micronaut MongoDB library. This simple project will provide\nyour services only with either a blocking MongoClient or a\nreactive MongoClient\nalong with some healthchecks. Not enough even for a modest application.\nFortunately some good people created kmongo - a little library that helped us a lot in converting the database access part of our app.\nAt the end of the day, however, we had to create some support code to ease the migration.\nThe original application database access code was in the form of reactive repositories:\n\nimport org.springframework.data.annotation.Id\nimport org.springframework.data.mongodb.core.mapping.Document\n\n@Document(collection = \"users\")\ndata class User(\n    @Id val id: String,\n    val name: String,\n    val type: String\n)\n\nclass UserRepository: ReactiveMongoRepository\u003cUser, String\u003e {\n    fun findFirstByTypeOrderByNameDesc(type: String): Mono\u003cUser\u003e\n}\n\n\nWe wanted to preserve the interface and as much code as possible. Here is what we had to do to get this effect.\nFirst we decided that our components would use MongoDatabase rather than MongoClient offered by Micronaut MongoDB.\nWe had only one database so that was an obvious choice.\n\n@Factory\nclass MongoConfig {\n    @Singleton\n    fun mongoDatabase(mongoClient: MongoClient, configuration: DefaultMongoConfiguration): MongoDatabase =\n        mongoClient.getDatabase(configuration.connectionString.get().database)\n}\n\n\nThen there was the question of configuring kmongo. It wasn’t as straightforward as we’d thought it would be. Let’s take a look at the\nfinal code.\n\n@Factory\nclass KMongoFactory {\n\n    @Singleton\n    fun kCodecRegistry(): CodecRegistry {\n        ObjectMappingConfiguration.addCustomCodec(JodaDateSerializationCodec) // 1 - custom Joda DateTime coded\n        KMongoConfiguration.registerBsonModule(JodaModule())                  // 2 - register default Joda module\n        KMongoConfiguration.registerBsonModule(JodaDateSerializationModule)   // 3 - register custom Joda module\n        with(KMongoConfiguration.bsonMapper.factory as BsonFactory) {         // 4 - change BigDecimal handling\n            disable(BsonGenerator.Feature.WRITE_BIGDECIMALS_AS_DECIMAL128)\n            enable(BsonGenerator.Feature.WRITE_BIGDECIMALS_AS_STRINGS)\n        }\n        return ClassMappingType.codecRegistry(MongoClientSettings.getDefaultCodecRegistry())\n    }\n}\n\n\nMongoDB driver expects a CodecRegistry which defines how to encode a Java object into Mongo BSON, so that it can be persisted in a database. By default\nkmongo supports a simple, Jackson based converter. However, there were a few issues in\nour application which forced us to create some customizations:\nJoda date types in entity classes - our app has a long history and it still uses Joda date types.\nUnfortunately they do not work with kmongo, so we had to teach it how to handle them. It required a few steps.\n    \n(1) kmongo had to know how to serialize a Joda date type to a MongoDB date type:\n\nobject JodaDateSerializationCodec : Codec\u003cDateTime\u003e {\n    override fun encode(writer: BsonWriter, value: DateTime?, encoderContext: EncoderContext?) {\n        if (value == null) {\n            writer.writeNull()\n        } else {\n            writer.writeDateTime(value.millis)\n        }\n    }\n\n    override fun getEncoderClass(): Class\u003cDateTime\u003e {\n        return DateTime::class.java\n    }\n\n    override fun decode(reader: BsonReader, decoderContext: DecoderContext?): DateTime {\n        return DateTime(reader.readDateTime())\n    }\n}\n\n        \n(2) Jackson used by kmongo also had to know how to handle Joda date types,\n(3) to make things harder sometimes we stored a datetime as a long value, therefore we had to add support for that as well:\n\nobject JodaDateSerializationModule : SimpleModule() {\n    init {\n        addSerializer(DateTime::class.java, JodaDateSerializer())\n        addDeserializer(DateTime::class.java, JodaDateDeserializer())\n    }\n}\n\nclass JodaDateSerializer : JsonSerializer\u003cDateTime\u003e() {\n    override fun serialize(value: DateTime, gen: JsonGenerator, serializers: SerializerProvider?) {\n        gen.writeObject(value.toDate())\n    }\n}\n\nclass JodaDateDeserializer : JsonDeserializer\u003cDateTime\u003e() {\n    override fun deserialize(parser: JsonParser, ctxt: DeserializationContext?): DateTime =\n        when (parser.currentToken) {\n            JsonToken.VALUE_NUMBER_INT -\u003e parser.readValueAs(Long::class.java).let(::DateTime)\n            else -\u003e parser.readValueAs(Date::class.java).let(::DateTime)\n        }\n}\n\n        \n(4) finally we stored BigDecimal values as plain String, which is not a default behaviour of kmongo, so we had to change it.\nAs you can see some of the problems we had to face came from using either old technologies or not using them properly. It turned out there were more issues.\nFor our entity IDs we usually used an artificial String value. MongoDB has special support for it in a form of ObjectId\ntype, which we gladly used in our application. But, here a new issue came up - in order to make our integration tests easier to read and write we used String-type IDs\nnot conformant to ObjectId restrictions (so for example our user IDs were user-1, user-2, etc.).\nSpring Data handles this transparently, but here we had to introduce one more customization. Our entity classes now\nhad to contain a special annotation indicating what serializer to use for our ID fields:\n\nimport org.bson.codecs.pojo.annotations.BsonId\n\ndata class User(\n    @BsonId @JsonSerialize(using = CustomIdJsonSerializer::class) val id: String,\n    val name: String,\n    val type: String\n)\n\nclass CustomIdJsonSerializer : StdScalarSerializer\u003cString\u003e(String::class.java, false) {\n    override fun serialize(value: String?, gen: JsonGenerator, serializers: SerializerProvider?) =\n        if (value != null \u0026\u0026 ObjectId.isValid(value)) { gen.writeObjectId(ObjectId(value)) }\n        else { gen.writeString(value) }\n\n    override fun serializeWithType(value: String?, gen: JsonGenerator, serializers: SerializerProvider?, typeSer: TypeSerializer?) =\n        serialize(value, gen, serializers)\n\n    override fun isEmpty(value: String): Boolean = value.isEmpty()\n\n    override fun acceptJsonFormatVisitor(visitor: JsonFormatVisitorWrapper?, typeHint: JavaType?) = visitStringFormat(visitor, typeHint)\n}\n\n\nWith the basics set up we could now focus on how to make the *Repository classes work with as little effort as possible. We decided to create a base BaseRepository\nclass letting us write concrete *Repository classes easier:\n\nabstract class BaseRepository\u003cT\u003e(\n    private val mongoDatabase: MongoDatabase,\n    private val collectionName: String,\n    private val clazz: Class\u003cT\u003e\n) {\n    open fun findById(id: String): Mono\u003cT\u003e = findOne(eq(\"_id\", id.maybeObjectId()))\n\n    fun findOne(filter: Bson): Mono\u003cT\u003e = withCollection {\n        find(filter).toMono()\n    }\n\n    fun \u003cR\u003e withCollection(fn: MongoCollection\u003cT\u003e.() -\u003e R): R =\n                mongoDatabase\n                    .getCollection(collectionName, clazz)\n                    .let(fn)\n}\n\n\nFinally we wrote the *Repository classes. A rewritten version of the UserRepository mentioned at the beginning of this section looked like this:\n\n@Context\nclass UserRepository(\n    mongoDatabase: MongoDatabase\n): BaseRepository\u003cUser\u003e(mongoDatabase, \"users\", User::class.java) {\n\n    fun findFirstByTypeOrderByNameDesc(type: String): Mono\u003cUser\u003e =\n        withCollection {\n            find(and(eq(\"type\", type)))\n                .sort(descending(\"name\"))\n                .limit(1)\n                .toMono()\n        }\n}\n\n\nFear of the Dark\nSpock is our framework of choice for writing tests. We still tend to use it even in Kotlin applications,\nalthough sometimes the resulting code is not as clear as it’d be if not for Groovy (`coroutines!). So how does\nMicronaut work with Spock? Actually, quite well.\nFor testing there is a micronaut-test project, which provides testing extensions for Spock\nand many other testing libraries. The general approach to writing test cases with Spring which we were familiar with,\nis very similar in micronaut-test. Let’s have a look at a simple test case:\n\n@MicronautTest // 1\nclass SimpleIntSpec extends Specification {\n    @Inject // 2\n    UserService userService\n\n    def \"should persist a user\"() {\n        given:\n        userService.createUser(\"user-1\", \"John\", \"Doe\")\n\n        when:\n        def user = userService.getUser(\"user-1\")\n\n        then:\n        user.firstName == \"John\"\n        user.lastName == \"Doe\"\n    }\n}\n\n\nThere are two interesting things in this test case:\n(1) @MicronautTest is an annotation you have to put in your test classes to start Micronaut application,\n(2) @Inject is Micronaut’s version of @Autowired (or… @Inject, which is also supported by Spring). Be aware that since\nMicronaut 3.0.0 you should use @jakarta.inject.Inject annotation instead of the former @javax.inject.Inject.\nIf your tests make API calls to your application via REST endpoints, and you run your web container on a random port (which is common), then the way to retrieve it\nis through the use of the injected EmbeddedServer:\n\n@MicronautTest\nclass ApiIntSpec extends Specification {\n    @Inject\n    EmbeddedServer server\n\n    def \"should create a user using API call\"() {\n        given:\n        def url = \"http://localhost:{$server.port}/users\"\n\n        when:\n        // here goes your test...\n    }\n}\n\n\nMoney\nAs a side effect, an additional benefit you get when you use Micronaut is a faster development cycle. As stated at the\nbeginning of this post, one of the main features of this framework is faster startup. Therefore, when writing test cases and then running tests,\ntheir execution time is lower than their Spring equivalent. This may not be significant if your tests are few, but sooner or later\ntheir number will grow and then the speed will become more visible and important. For large codebases time savings can be really impressive.\nShould I stay or should I go\nThe experience we gained during migration to Micronaut gave us more courage and assurance. So when the time came to decide what technology\nto use for a quite large greenfield project, we didn’t hesitate (well, we actually did, but not for long).\nSix months later with the system running in the production environment we’re happy we started that long journey. And if you’re considering\nMicronaut for one of your projects, I can wholeheartedly recommend: go for it.","guid":"https://blog.allegro.tech/2021/11/micronaut.html","categories":["tech","backend","performance","micronaut","kotlin","graalvm"],"isoDate":"2021-11-21T23:00:00.000Z","thumbnail":"images/post-headers/default.jpg"},{"title":"OAuth rate-limiting","link":"https://blog.allegro.tech/2021/11/oauth-rate-limiting.html","pubDate":"Tue, 09 Nov 2021 00:00:00 +0100","authors":{"author":[{"name":["Marek Walkowiak"],"photo":["https://blog.allegro.tech/img/authors/marek.walkowiak.jpg"],"url":["https://blog.allegro.tech/authors/marek.walkowiak"]},{"name":["Daniel Faderski"],"photo":["https://blog.allegro.tech/img/authors/daniel.faderski.jpg"],"url":["https://blog.allegro.tech/authors/daniel.faderski"]}]},"content":"\u003cp\u003eEvery e-commerce platform needs some kind of central authorization system. At \u003ca href=\"https://allegro.tech/\"\u003eAllegro\u003c/a\u003e we use\nOAuth and have our own implementation that stays true to the\n\u003ca href=\"https://datatracker.ietf.org/doc/html/rfc6749\"\u003eRFC\u003c/a\u003e. Allegro has millions of users. There are also a lot of requests\nthat go through OAuth services. At some point there comes a need to have better control over how much traffic we want to\nallow in a certain time window, while maintaining full performance of the platform. Here is where the idea of\nrate-limiting comes in handy.\u003c/p\u003e\n\n\u003ch2 id=\"prologue\"\u003ePrologue\u003c/h2\u003e\n\n\u003cp\u003eAccording to OAuth RFC, to use OAuth you need to be a registered client. Some clients are very small external\nintegrators (simple shops), while others are in a different league and can produce millions of requests per day (Allegro\nmobile and other large partner apps). Every user can create their own OAuth client and use it to integrate with\nDevelopers API. Unfortunately, not all of them do that correctly as per RFC.\u003c/p\u003e\n\n\u003cp\u003eNormally such clients are not a big issue, but in certain cases they can generate a lot of unwanted and unneeded\ntraffic. This traffic includes, but is not limited to, creating huge numbers of new access tokens that are then thrown\naway instead of being reused.\u003c/p\u003e\n\n\u003cp\u003eAccording to the RFC, the access tokens generated with most grant types (e.g. authorization code grant) should be reused\nup until their expiration period. When they expire, the\nprovided \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc6749#section-1.5\"\u003erefresh token\u003c/a\u003e should be used to receive a new\naccess token via refresh token grant.\u003c/p\u003e\n\n\u003cp\u003eSome of the clients rarely refresh tokens or even don’t reuse them at all. This causes a lot of unnecessary traffic (\noften in the form of sudden spikes)\nthat can lead to potential issues on both sides. We had pretty good monitoring of this issue, but we needed better tools\nto deal with that problem as well as to educate the clients to make proper use of OAuth.\u003c/p\u003e\n\n\u003ch2 id=\"planning-the-solution\"\u003ePlanning the solution\u003c/h2\u003e\n\n\u003cp\u003eBefore tackling the problem directly we needed a little more information and careful planning. Firstly, we wanted to\nmake sure that our solution would solve the problem. Secondly, blocking too many clients could end up in disaster. To be\ncertain that our solution was error-free, we started by making sure that we knew what we want to achieve. Here are the\nproperties we expected from our solution:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eIt cannot block trusted clients such as Allegro apps.\u003c/li\u003e\n  \u003cli\u003eIt should not negatively affect performance.\u003c/li\u003e\n  \u003cli\u003eIt should be configurable per client since different clients have different traffic characteristics.\u003c/li\u003e\n  \u003cli\u003eIt should be able to distinguish between user and non-user use of OAuth. Client credentials grant used without context\nof a user, for example should be treated differently than user-based authorization code grant. In effect, the limiting\n“per user” should be introduced in the second case.\u003c/li\u003e\n  \u003cli\u003eIt should directly cause an improvement in traffic spikes.\u003c/li\u003e\n  \u003cli\u003eIt should work well in a highly distributed environment with dozens of service instances and database nodes.\u003c/li\u003e\n  \u003cli\u003eIt cannot be too costly or require too much additional infrastructure like additional databases, external systems,\netc.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"tackling-the-problem\"\u003eTackling the problem\u003c/h2\u003e\n\n\u003cp\u003eTo meet those needs we needed a robust solution. Since RFC leaves a lot of room for implementation by end-users, it does\nnot specify how such rate-limiting should work.\u003c/p\u003e\n\n\u003cp\u003eAs with every problem of such kind, it’s worth starting with in-depth research of existing solutions. There are various\nstrategies and approaches to this problem in many different scenarios, but only a few of them were applicable to our\ncase and enabled us to fulfill our goals.\u003c/p\u003e\n\n\u003cp\u003eAs usual, we also explored the existing implementations of such solutions in the form of enterprise or open-source\nlibraries and frameworks. Unfortunately, we did not find any that would meet all of our needs and at the same time be\nflexible enough to easily integrate into our ecosystem. It’s also worth noting that we were limited by certain\nconstraints such as long-term costs of additional resources.\u003c/p\u003e\n\n\u003cp\u003eIn the end, we decided to go with implementing our own solution. There were several algorithms to choose from that could\nserve as its base:\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003ePrecise query-based per-user counter — query the database for a token count for each request. Not suitable, because\nit would cause way too much database traffic.\u003c/li\u003e\n  \u003cli\u003eFixed window based on TTL documents — uses a rate-limit counter that is cleared every fixed period. While less\nchallenging for the database, it shares a common vulnerability with the first algorithm: sudden TTL-caused spikes in\nallowed requests that consequently cause all of the following requests to be blocked (rate-limit exhaustion).\u003c/li\u003e\n  \u003cli\u003eSliding window log — stores all requests as a timestamped log entry in a database, that are later aggregated when\nneeded. Too costly, because again it would cause too heavy a load on the database.\u003c/li\u003e\n  \u003cli\u003eSliding window — uses a rate-limit counter that is a time-based weighted moving window. It has the advantage of\nrelatively low database load of the fixed window algorithm without its spike-related flaws.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eWe carefully weighed the pros and cons of each of those options and finally decided to make a PoC of the fourth option:\nthe sliding window algorithm.\u003c/p\u003e\n\n\u003cp\u003eThe algorithm is based on counters that each hold a count of requests in their respective time frames. At each point of\ntime, an abstract window is calculated from two neighboring frames: current and previous. The further away the window is\nfrom the previous frame, the more important the counter from the current frame is. The weight is based strictly on\nproportions. If, for example, the span of the current window is 75% of the previous frame and 25% of the current frame,\nthen the value of the current rate-limit counter is a sum of 75% of the previous frame counter and 25% of the current\nframe counter. The results are put into a hashmap with users as keys and counters as values, which acts as a cache.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-11-09-oauth-rate-limiting/sliding-window-algorithm.png\" alt=\"Sliding window algorithm\" /\u003e\nIn the picture above the current counter value would be:\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003evalue = previousCounter * partOfPreviousFrame + currentCounter * partOfCurrentFrame\nvalue = 12 * 0.75 + 5 * 0.25 = 10.25\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe time complexity of the sliding window algorithm is O(1) since it’s a simple hashmap get operation, while its space\ncomplexity is O(n) where n is the number of user counters held by an instance. It works well in distributed systems\nbecause it’s based on simple counters that are relatively easy to synchronize. Its cost is low since we only need to\nstore simple counters and can easily minimize database queries, as well as improve performance with caching in a\nstraightforward manner. Thanks to the fact that the sliding window takes into account the time relative to the current\ntimestamp, we can flatten the token creation spikes. Its main disadvantage is that it indirectly relies on the even\ndistribution of requests in time, which makes it less sensitive to spike traffic within one time window.\u003c/p\u003e\n\n\u003ch2 id=\"following-the-plan\"\u003eFollowing the plan\u003c/h2\u003e\n\n\u003ch3 id=\"remote-state-synchronization\"\u003eRemote state synchronization\u003c/h3\u003e\n\n\u003cp\u003eThere are two kinds of states that need to be tracked for the rate-limiting to work. The first one is the global state.\nIt’s basically a global counter of all requests made by a client to rate-limited OAuth endpoints within a certain\nperiod. This state is persisted in the database and from its perspective represents the most recent rate-limit status.\u003c/p\u003e\n\n\u003cp\u003eThe second type is the local state of each instance, one part of which is the local counter of incoming requests for a\nclient within a time window. Since instances are not directly connected to the client and every one of them can make\nrequests to different instances concurrently, the local counter of each instance for that client will most probably have\na different value. Rate-limiting is a global functionality in the sense that we are interested in the value of global\ncounters and not of individual counters. Consider the following scenario: we would like to set a rate limit of 50 RPS\nfor a client while having 10 instances. If we relied only on local counters to do the rate-limiting, it would be\npossible for the traffic of 500 RPS to be split evenly between instances and not trigger rate-limiting - and that’s not\nthe result we are aiming for.\u003c/p\u003e\n\n\u003cp\u003eTo decide whether to reject an incoming request or not, the local instance needs a second part of the state - a global\ncounter. When making a decision, it sums both the local and the global ones to check whether new requests would go\nbeyond the rate-limit boundaries.\u003c/p\u003e\n\n\u003cp\u003eConsequently, the instances need to be aware of the requests made to the others and for that to work, the global counter\nneeds to be updated regularly. Each instance will periodically try to flush the sum of global and local counters from\ntheir state to the database. Here is where things get tricky. If several instances are trying to save different global\ncounters, there is a risk that one of them will attempt to overwrite the changes that were just saved by the other. To\ncounter that, we use a mechanism called optimistic locking that is\ndescribed \u003ca href=\"#resolving-the-conflicts\"\u003elater in this post\u003c/a\u003e. Once the state is persisted successfully, the local state is\ncleared. At this point, it consists of the incoming requests counter that is equal to 0 and the global snapshot counter\nthat is equal to the value persisted in the database for that client.\u003c/p\u003e\n\n\u003ch3 id=\"caching-clients-global-state\"\u003eCaching clients’ global state\u003c/h3\u003e\n\n\u003cp\u003eAny instance should be aware of the rate limit state for the whole cluster. It represents the global number of requests\nmade by a particular client and its users. We keep a mapping between a pair (client_id, username) and the number of\nrequests made in memory, which makes our algorithm efficient. There is one caveat: keeping all the clients and their\nusers would take too much space, so we only keep those clients and users who are actively making requests to the OAuth\nserver. As soon as they stop calling our servers we delete them from the instance’s cache.\u003c/p\u003e\n\n\u003ch3 id=\"sharing-the-state\"\u003eSharing the state\u003c/h3\u003e\n\n\u003cp\u003eOur internal OAuth service works in a distributed manner. There are many instances of the OAuth servers and we should\nhave mechanisms to coordinate rate-limiting between them. In practice, it means that if a client is making a request to\nserver instance A, the server instance B should consider it when calculating the allowed number of requests in the\ncurrent time window. Below are the key points that sum up this description:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eWe have a global request counter per each client/user.\u003c/li\u003e\n  \u003cli\u003eThe counter is stored in the Mongo database.\u003c/li\u003e\n  \u003cli\u003eEach instance shares the counter - it reads and writes its current value.\u003c/li\u003e\n  \u003cli\u003eThe counter depicts the window in the current timestamp.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"clientId\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"some-client\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"username\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"some-user\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eNumberLong(\u003c/span\u003e\u003cspan class=\"mi\"\u003e405\u003c/span\u003e\u003cspan class=\"err\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"expire\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eISODate(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"2021-05-29T14:24:01.376Z\"\u003c/span\u003e\u003cspan class=\"err\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"requestCounters\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"1622211780\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"1622211840\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe counter consists of a few fields:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e_id\u003c/code\u003e - to uniquely identify the client and the user connected with the request.\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eversion\u003c/code\u003e - for the optimistic locking purposes.\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eexpire\u003c/code\u003e - used to remove the counter if it has no updates, which means that the client is not currently creating new\ntokens.\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003erequestCounters\u003c/code\u003e - mapping of the number of requests at consecutive points in time.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe counter is cached so we don’t have to fetch it each time the request from the client is made, since it would kill\nperformance. Each instance refreshes the counter asynchronously - reads and writes to the Mongo database are made in a\ndedicated thread. Each one also holds the counters only for the clients they have to handle. A particular instance\nremoves the client’s state after it stops sending requests.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-11-09-oauth-rate-limiting/sharing-the-state.png\" alt=\"Sharing the state example\" /\u003e\n\u003cimg src=\"/img/articles/2021-11-09-oauth-rate-limiting/sharing-the-state-table.png\" alt=\"Sharing the state example table\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eThis table depicts an example flow of counters on two instances (A, B) of our OAuth service. Each of them has its own\ncounter\n(accordingly \u003cstrong\u003ecnt1\u003c/strong\u003e and \u003cstrong\u003ecnt2\u003c/strong\u003e), \u003cstrong\u003emng\u003c/strong\u003e is a state in the sharded Mongo database and \u003cstrong\u003etotal req\u003c/strong\u003e is the sum of\nall requests made to all instances.\u003c/p\u003e\n\n\u003cp\u003eThe state of each instance consists of two counters (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eg\u003c/code\u003e / \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ei\u003c/code\u003e). The first one (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eg\u003c/code\u003e for “global”) describes how many\nrequests have been globally made and are persisted in the database. The second one tracks how many requests have come to\nthat instance since the last flush (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ei\u003c/code\u003e for “in-flight”). The total number of requests from its perspective is the sum\nof \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eg\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ei\u003c/code\u003e and it is the value that is going to be persisted.\u003c/p\u003e\n\n\u003cp\u003eBelow is the description of what happens in this scenario, step by step:\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003eThere is an initial state with no requests made to either instance.\u003c/li\u003e\n  \u003cli\u003eOne request is made to instance A and its i\u003csub\u003eA\u003c/sub\u003e counter is increased to 1.\u003c/li\u003e\n  \u003cli\u003eNext, instance A pushes its total counter to the database, setting its \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eg\u003c/code\u003e counter to 1 and its \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ei\u003c/code\u003e counter to 0.\u003c/li\u003e\n  \u003cli\u003eInstance B periodically pulls the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eg\u003c/code\u003e counter from the database. Now, the new counter is pulled and the instance’s\ncurrent state is \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eg\u003c/code\u003e = 1, i\u003csub\u003eB\u003c/sub\u003e = 0.\u003c/li\u003e\n  \u003cli\u003eNext, instance A receives one request, and at the same time, instance B receives three requests. At this time\ninstance A knows of 2 requests, 1 of which came since the last flush. Instance B knows of 4 requests, 3 of them came\nsince the last flush.\u003c/li\u003e\n  \u003cli\u003eInstance B pushes its total counter (3+1=4) to Mongo. As a consequence, its state is set to (4 / 0). Instance A has\nnot yet flushed its counter to persistent storage. Remember that both instances do it independently whenever a fixed\ninterval passes.\u003c/li\u003e\n  \u003cli\u003eNow, Instance A tries to push its state (1+1=2) to the database. If the push was successful, it would overwrite the\nstate previously written by the instance B (in step 5), resulting in data loss. We want our counters to be precise so\nwe need to use optimistic locking here. It causes the push to fail, if the version of its state differs from the\nversion persisted in the database. If that scenario occurs, the instance knows that it should refresh its global\ncounter before trying to save it again.\u003c/li\u003e\n  \u003cli\u003eInstance A refreshed its state. It is now equal to (4/1), which means 4 requests are persisted in the database and 1\nthat has not been flushed yet. Now it can safely push its total counter (4+1=5) to the database and set its state\nto (5/0).\u003c/li\u003e\n  \u003cli\u003eAt this point both instances have pushed their state to the database. Notice, however, that instance B has not yet\npulled the counter written by instance B in the previous step.\u003c/li\u003e\n  \u003cli\u003eAfter the last pull, the counter states on both instances are consistent with the database state and reflect the\nglobal number of requests made by a client.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch3 id=\"persisting-the-state\"\u003ePersisting the state\u003c/h3\u003e\n\n\u003cp\u003eTo properly persist the state in a distributed environment with minimal impact on application performance, we needed to\ntake several strategies into consideration.\u003c/p\u003e\n\n\u003ch4 id=\"resolving-the-conflicts\"\u003eResolving the conflicts\u003c/h4\u003e\n\n\u003cp\u003eAs we’ve already mentioned we use optimistic locking to prevent the state from being overwritten by the different\ninstances. It’s quite a common problem in a the world of distributed systems. It works by using version numbers kept in\nMongoDB, which designates how many updates have been made from the beginning of its creation. After each update the\nversion increases by one.\u003c/p\u003e\n\n\u003cp\u003eBefore save to the database:\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n   \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e...\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n   \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n   \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"requestCount\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n   \u003c/span\u003e\u003cspan class=\"err\"\u003e...\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAfter the save:\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n   \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e...\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n   \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n   \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"requestCount\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n   \u003c/span\u003e\u003cspan class=\"err\"\u003e...\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eBut how does a particular instance save the document atomically? How does it know that there was an update made by\nanother instance in the meantime? For this purpose, we use a Mongo query to do\nthe \u003ca href=\"https://en.wikipedia.org/wiki/Compare-and-swap\"\u003eCAS\u003c/a\u003e update that looks like:\u003c/p\u003e\n\n\u003cdiv class=\"language-js highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\n\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eratelimits\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eupdate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003efilter\u003c/span\u003e \u003cspan class=\"nx\"\u003equery\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eupdate\u003c/span\u003e \u003cspan class=\"nx\"\u003eoperation\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eratelimits\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eupdate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e_id\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{...},\u003c/span\u003e\n   \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eversion\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eversion\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003erequestCount\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\n \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIf the query returns 0 elements updated we know there was a collision and there was a concurrent save which changed the\nstate. If this happens we need to:\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003eUpdate state from database to local instance,\u003c/li\u003e\n  \u003cli\u003eApply inflight recorded changes (the ones not yet persisted to the database),\u003c/li\u003e\n  \u003cli\u003eSave the state,\u003c/li\u003e\n  \u003cli\u003eIf the query returns 1 element updated, the save was successful without any collisions,\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch4 id=\"saving-in-batches\"\u003eSaving in batches\u003c/h4\u003e\n\n\u003cp\u003eAs we already mentioned, a single instance of the OAuth server handles many clients. So it has to synchronize the state\nfor each of them. Doing the above save operation for each client individually would cause a massive number of queries\nand would quickly saturate our resources. That’s why we\nuse \u003ca href=\"https://docs.mongodb.com/manual/core/bulk-write-operations/#bulk-write-operations\"\u003eMongo bulk operations\u003c/a\u003e. They\nallow defining many operations in a single query.\u003c/p\u003e\n\n\u003ch2 id=\"going-into-production\"\u003eGoing into production\u003c/h2\u003e\n\n\u003ch3 id=\"dry-run\"\u003eDry-run\u003c/h3\u003e\n\n\u003cp\u003eBefore actually blocking the clients we needed a way to check real outputs from our solution. We implemented the dry-run\nmode, which enabled us do this without affecting any clients, while also giving us metrics depicting which of them would\nbe blocked given a particular limit and time window. We took the following steps:\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003eSet high rate limit up to the point when no clients would be blocked (running in dry-run mode all the time).\u003c/li\u003e\n  \u003cli\u003eLowered the threshold to the point that showed us the outstanding clients, while not blocking the others.\u003c/li\u003e\n  \u003cli\u003eCommunicated with clients abusing our future rate limit policy and gave them a chance to optimize the way they use\nthe OAuth server.\u003c/li\u003e\n  \u003cli\u003eSwitched modes from dry-run to actively blocking the clients.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch3 id=\"canary-deployment\"\u003eCanary deployment\u003c/h3\u003e\n\n\u003cp\u003eIt would be risky to deploy this kind of feature to the whole OAuth cluster without ensuring it’s properly working on a\nfew instances. We used canary deployment which allows deploying a version of a service to only a few production\ninstances. During this deployment, we monitored CPU usage and response time metrics. After ensuring there was meaningful\ndisparity we rolled out the full feature to all production instances.\u003c/p\u003e\n\n\u003ch3 id=\"observability\"\u003eObservability\u003c/h3\u003e\n\n\u003cp\u003eTo monitor and verify our solution we needed a bunch of metrics telling us how many clients were affected by rate limit\npolicy and which of them are getting closer to being blocked. In practice, two charts shown below were enough to monitor\ntheir behaviour:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-11-09-oauth-rate-limiting/ratelimit-denied-rate.png\" alt=\"Ratelimit Denied Rate\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eThis chart shows clients and their blocked rate. Each color depicts a different blocked client.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-11-09-oauth-rate-limiting/ratelimit-allowed-rate.png\" alt=\"Ratelimit Allowed Rate\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eThis one on the other hand depicts the allowed rate. The limit line is helpful to see if any client is getting closer to\nit and will be blocked soon. It’s worth mentioning that the default rate limit policy isn’t sufficient for all of the\nclients. Some of them require special treatment and for them we can configure different thresholds, which is why a few\nof them go beyond the actual default limit (the red line).\u003c/p\u003e\n\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\n\u003cp\u003eRate-limiting is a common problem, but surprisingly not so trivial to solve, especially in a high-scale, distributed\nenvironment. Plenty of popular solutions can be found, but most of them deal with it only from a perspective of a single\nmachine and were not well-suited for our system. Coming up with the above approach took quite a bit of research and\nplanning, but in the end, its deployment allowed us to effectively achieve our goal. We are pretty content with the\nfinal product, as it is both effective and fast, but are constantly tweaking it and looking for new ways to optimize\nthat process.\u003c/p\u003e\n","contentSnippet":"Every e-commerce platform needs some kind of central authorization system. At Allegro we use\nOAuth and have our own implementation that stays true to the\nRFC. Allegro has millions of users. There are also a lot of requests\nthat go through OAuth services. At some point there comes a need to have better control over how much traffic we want to\nallow in a certain time window, while maintaining full performance of the platform. Here is where the idea of\nrate-limiting comes in handy.\nPrologue\nAccording to OAuth RFC, to use OAuth you need to be a registered client. Some clients are very small external\nintegrators (simple shops), while others are in a different league and can produce millions of requests per day (Allegro\nmobile and other large partner apps). Every user can create their own OAuth client and use it to integrate with\nDevelopers API. Unfortunately, not all of them do that correctly as per RFC.\nNormally such clients are not a big issue, but in certain cases they can generate a lot of unwanted and unneeded\ntraffic. This traffic includes, but is not limited to, creating huge numbers of new access tokens that are then thrown\naway instead of being reused.\nAccording to the RFC, the access tokens generated with most grant types (e.g. authorization code grant) should be reused\nup until their expiration period. When they expire, the\nprovided refresh token should be used to receive a new\naccess token via refresh token grant.\nSome of the clients rarely refresh tokens or even don’t reuse them at all. This causes a lot of unnecessary traffic (\noften in the form of sudden spikes)\nthat can lead to potential issues on both sides. We had pretty good monitoring of this issue, but we needed better tools\nto deal with that problem as well as to educate the clients to make proper use of OAuth.\nPlanning the solution\nBefore tackling the problem directly we needed a little more information and careful planning. Firstly, we wanted to\nmake sure that our solution would solve the problem. Secondly, blocking too many clients could end up in disaster. To be\ncertain that our solution was error-free, we started by making sure that we knew what we want to achieve. Here are the\nproperties we expected from our solution:\nIt cannot block trusted clients such as Allegro apps.\nIt should not negatively affect performance.\nIt should be configurable per client since different clients have different traffic characteristics.\nIt should be able to distinguish between user and non-user use of OAuth. Client credentials grant used without context\nof a user, for example should be treated differently than user-based authorization code grant. In effect, the limiting\n“per user” should be introduced in the second case.\nIt should directly cause an improvement in traffic spikes.\nIt should work well in a highly distributed environment with dozens of service instances and database nodes.\nIt cannot be too costly or require too much additional infrastructure like additional databases, external systems,\netc.\nTackling the problem\nTo meet those needs we needed a robust solution. Since RFC leaves a lot of room for implementation by end-users, it does\nnot specify how such rate-limiting should work.\nAs with every problem of such kind, it’s worth starting with in-depth research of existing solutions. There are various\nstrategies and approaches to this problem in many different scenarios, but only a few of them were applicable to our\ncase and enabled us to fulfill our goals.\nAs usual, we also explored the existing implementations of such solutions in the form of enterprise or open-source\nlibraries and frameworks. Unfortunately, we did not find any that would meet all of our needs and at the same time be\nflexible enough to easily integrate into our ecosystem. It’s also worth noting that we were limited by certain\nconstraints such as long-term costs of additional resources.\nIn the end, we decided to go with implementing our own solution. There were several algorithms to choose from that could\nserve as its base:\nPrecise query-based per-user counter — query the database for a token count for each request. Not suitable, because\nit would cause way too much database traffic.\nFixed window based on TTL documents — uses a rate-limit counter that is cleared every fixed period. While less\nchallenging for the database, it shares a common vulnerability with the first algorithm: sudden TTL-caused spikes in\nallowed requests that consequently cause all of the following requests to be blocked (rate-limit exhaustion).\nSliding window log — stores all requests as a timestamped log entry in a database, that are later aggregated when\nneeded. Too costly, because again it would cause too heavy a load on the database.\nSliding window — uses a rate-limit counter that is a time-based weighted moving window. It has the advantage of\nrelatively low database load of the fixed window algorithm without its spike-related flaws.\nWe carefully weighed the pros and cons of each of those options and finally decided to make a PoC of the fourth option:\nthe sliding window algorithm.\nThe algorithm is based on counters that each hold a count of requests in their respective time frames. At each point of\ntime, an abstract window is calculated from two neighboring frames: current and previous. The further away the window is\nfrom the previous frame, the more important the counter from the current frame is. The weight is based strictly on\nproportions. If, for example, the span of the current window is 75% of the previous frame and 25% of the current frame,\nthen the value of the current rate-limit counter is a sum of 75% of the previous frame counter and 25% of the current\nframe counter. The results are put into a hashmap with users as keys and counters as values, which acts as a cache.\n\nIn the picture above the current counter value would be:\n\nvalue = previousCounter * partOfPreviousFrame + currentCounter * partOfCurrentFrame\nvalue = 12 * 0.75 + 5 * 0.25 = 10.25\n\n\nThe time complexity of the sliding window algorithm is O(1) since it’s a simple hashmap get operation, while its space\ncomplexity is O(n) where n is the number of user counters held by an instance. It works well in distributed systems\nbecause it’s based on simple counters that are relatively easy to synchronize. Its cost is low since we only need to\nstore simple counters and can easily minimize database queries, as well as improve performance with caching in a\nstraightforward manner. Thanks to the fact that the sliding window takes into account the time relative to the current\ntimestamp, we can flatten the token creation spikes. Its main disadvantage is that it indirectly relies on the even\ndistribution of requests in time, which makes it less sensitive to spike traffic within one time window.\nFollowing the plan\nRemote state synchronization\nThere are two kinds of states that need to be tracked for the rate-limiting to work. The first one is the global state.\nIt’s basically a global counter of all requests made by a client to rate-limited OAuth endpoints within a certain\nperiod. This state is persisted in the database and from its perspective represents the most recent rate-limit status.\nThe second type is the local state of each instance, one part of which is the local counter of incoming requests for a\nclient within a time window. Since instances are not directly connected to the client and every one of them can make\nrequests to different instances concurrently, the local counter of each instance for that client will most probably have\na different value. Rate-limiting is a global functionality in the sense that we are interested in the value of global\ncounters and not of individual counters. Consider the following scenario: we would like to set a rate limit of 50 RPS\nfor a client while having 10 instances. If we relied only on local counters to do the rate-limiting, it would be\npossible for the traffic of 500 RPS to be split evenly between instances and not trigger rate-limiting - and that’s not\nthe result we are aiming for.\nTo decide whether to reject an incoming request or not, the local instance needs a second part of the state - a global\ncounter. When making a decision, it sums both the local and the global ones to check whether new requests would go\nbeyond the rate-limit boundaries.\nConsequently, the instances need to be aware of the requests made to the others and for that to work, the global counter\nneeds to be updated regularly. Each instance will periodically try to flush the sum of global and local counters from\ntheir state to the database. Here is where things get tricky. If several instances are trying to save different global\ncounters, there is a risk that one of them will attempt to overwrite the changes that were just saved by the other. To\ncounter that, we use a mechanism called optimistic locking that is\ndescribed later in this post. Once the state is persisted successfully, the local state is\ncleared. At this point, it consists of the incoming requests counter that is equal to 0 and the global snapshot counter\nthat is equal to the value persisted in the database for that client.\nCaching clients’ global state\nAny instance should be aware of the rate limit state for the whole cluster. It represents the global number of requests\nmade by a particular client and its users. We keep a mapping between a pair (client_id, username) and the number of\nrequests made in memory, which makes our algorithm efficient. There is one caveat: keeping all the clients and their\nusers would take too much space, so we only keep those clients and users who are actively making requests to the OAuth\nserver. As soon as they stop calling our servers we delete them from the instance’s cache.\nSharing the state\nOur internal OAuth service works in a distributed manner. There are many instances of the OAuth servers and we should\nhave mechanisms to coordinate rate-limiting between them. In practice, it means that if a client is making a request to\nserver instance A, the server instance B should consider it when calculating the allowed number of requests in the\ncurrent time window. Below are the key points that sum up this description:\nWe have a global request counter per each client/user.\nThe counter is stored in the Mongo database.\nEach instance shares the counter - it reads and writes its current value.\nThe counter depicts the window in the current timestamp.\n\n{\n  \"_id\" : {\n    \"clientId\" : \"some-client\",\n    \"username\" : \"some-user\"\n  },\n  \"version\" : NumberLong(405),\n  \"expire\" : ISODate(\"2021-05-29T14:24:01.376Z\"),\n  \"requestCounters\" : {\n    \"1622211780\" : 1,\n    \"1622211840\" : 1\n  }\n}\n\n\nThe counter consists of a few fields:\n_id - to uniquely identify the client and the user connected with the request.\nversion - for the optimistic locking purposes.\nexpire - used to remove the counter if it has no updates, which means that the client is not currently creating new\ntokens.\nrequestCounters - mapping of the number of requests at consecutive points in time.\nThe counter is cached so we don’t have to fetch it each time the request from the client is made, since it would kill\nperformance. Each instance refreshes the counter asynchronously - reads and writes to the Mongo database are made in a\ndedicated thread. Each one also holds the counters only for the clients they have to handle. A particular instance\nremoves the client’s state after it stops sending requests.\n\n\nThis table depicts an example flow of counters on two instances (A, B) of our OAuth service. Each of them has its own\ncounter\n(accordingly cnt1 and cnt2), mng is a state in the sharded Mongo database and total req is the sum of\nall requests made to all instances.\nThe state of each instance consists of two counters (g / i). The first one (g for “global”) describes how many\nrequests have been globally made and are persisted in the database. The second one tracks how many requests have come to\nthat instance since the last flush (i for “in-flight”). The total number of requests from its perspective is the sum\nof g and i and it is the value that is going to be persisted.\nBelow is the description of what happens in this scenario, step by step:\nThere is an initial state with no requests made to either instance.\nOne request is made to instance A and its iA counter is increased to 1.\nNext, instance A pushes its total counter to the database, setting its g counter to 1 and its i counter to 0.\nInstance B periodically pulls the g counter from the database. Now, the new counter is pulled and the instance’s\ncurrent state is g = 1, iB = 0.\nNext, instance A receives one request, and at the same time, instance B receives three requests. At this time\ninstance A knows of 2 requests, 1 of which came since the last flush. Instance B knows of 4 requests, 3 of them came\nsince the last flush.\nInstance B pushes its total counter (3+1=4) to Mongo. As a consequence, its state is set to (4 / 0). Instance A has\nnot yet flushed its counter to persistent storage. Remember that both instances do it independently whenever a fixed\ninterval passes.\nNow, Instance A tries to push its state (1+1=2) to the database. If the push was successful, it would overwrite the\nstate previously written by the instance B (in step 5), resulting in data loss. We want our counters to be precise so\nwe need to use optimistic locking here. It causes the push to fail, if the version of its state differs from the\nversion persisted in the database. If that scenario occurs, the instance knows that it should refresh its global\ncounter before trying to save it again.\nInstance A refreshed its state. It is now equal to (4/1), which means 4 requests are persisted in the database and 1\nthat has not been flushed yet. Now it can safely push its total counter (4+1=5) to the database and set its state\nto (5/0).\nAt this point both instances have pushed their state to the database. Notice, however, that instance B has not yet\npulled the counter written by instance B in the previous step.\nAfter the last pull, the counter states on both instances are consistent with the database state and reflect the\nglobal number of requests made by a client.\nPersisting the state\nTo properly persist the state in a distributed environment with minimal impact on application performance, we needed to\ntake several strategies into consideration.\nResolving the conflicts\nAs we’ve already mentioned we use optimistic locking to prevent the state from being overwritten by the different\ninstances. It’s quite a common problem in a the world of distributed systems. It works by using version numbers kept in\nMongoDB, which designates how many updates have been made from the beginning of its creation. After each update the\nversion increases by one.\nBefore save to the database:\n\n{\n   \"_id\" : {...},\n   \"version\" : 0,\n   \"requestCount\": 0,\n   ...\n}\n\n\nAfter the save:\n\n{\n   \"_id\" : {...},\n   \"version\" : 1,\n   \"requestCount\": 5,\n   ...\n}\n\n\nBut how does a particular instance save the document atomically? How does it know that there was an update made by\nanother instance in the meantime? For this purpose, we use a Mongo query to do\nthe CAS update that looks like:\n\n\ndb.ratelimits.update(\n \u003cfilter query\u003e\n \u003cupdate operation\u003e\n)\n\ndb.ratelimits.update(\n {\n   \"_id\": {...},\n   \"version\": 1\n },\n {\n   \"version\": 2,\n   \"requestCount\": 10\n }\n)\n\n\nIf the query returns 0 elements updated we know there was a collision and there was a concurrent save which changed the\nstate. If this happens we need to:\nUpdate state from database to local instance,\nApply inflight recorded changes (the ones not yet persisted to the database),\nSave the state,\nIf the query returns 1 element updated, the save was successful without any collisions,\nSaving in batches\nAs we already mentioned, a single instance of the OAuth server handles many clients. So it has to synchronize the state\nfor each of them. Doing the above save operation for each client individually would cause a massive number of queries\nand would quickly saturate our resources. That’s why we\nuse Mongo bulk operations. They\nallow defining many operations in a single query.\nGoing into production\nDry-run\nBefore actually blocking the clients we needed a way to check real outputs from our solution. We implemented the dry-run\nmode, which enabled us do this without affecting any clients, while also giving us metrics depicting which of them would\nbe blocked given a particular limit and time window. We took the following steps:\nSet high rate limit up to the point when no clients would be blocked (running in dry-run mode all the time).\nLowered the threshold to the point that showed us the outstanding clients, while not blocking the others.\nCommunicated with clients abusing our future rate limit policy and gave them a chance to optimize the way they use\nthe OAuth server.\nSwitched modes from dry-run to actively blocking the clients.\nCanary deployment\nIt would be risky to deploy this kind of feature to the whole OAuth cluster without ensuring it’s properly working on a\nfew instances. We used canary deployment which allows deploying a version of a service to only a few production\ninstances. During this deployment, we monitored CPU usage and response time metrics. After ensuring there was meaningful\ndisparity we rolled out the full feature to all production instances.\nObservability\nTo monitor and verify our solution we needed a bunch of metrics telling us how many clients were affected by rate limit\npolicy and which of them are getting closer to being blocked. In practice, two charts shown below were enough to monitor\ntheir behaviour:\n\nThis chart shows clients and their blocked rate. Each color depicts a different blocked client.\n\nThis one on the other hand depicts the allowed rate. The limit line is helpful to see if any client is getting closer to\nit and will be blocked soon. It’s worth mentioning that the default rate limit policy isn’t sufficient for all of the\nclients. Some of them require special treatment and for them we can configure different thresholds, which is why a few\nof them go beyond the actual default limit (the red line).\nConclusion\nRate-limiting is a common problem, but surprisingly not so trivial to solve, especially in a high-scale, distributed\nenvironment. Plenty of popular solutions can be found, but most of them deal with it only from a perspective of a single\nmachine and were not well-suited for our system. Coming up with the above approach took quite a bit of research and\nplanning, but in the end, its deployment allowed us to effectively achieve our goal. We are pretty content with the\nfinal product, as it is both effective and fast, but are constantly tweaking it and looking for new ways to optimize\nthat process.","guid":"https://blog.allegro.tech/2021/11/oauth-rate-limiting.html","categories":["tech","architecture","oauth","microservices"],"isoDate":"2021-11-08T23:00:00.000Z","thumbnail":"images/post-headers/default.jpg"}],"jobs":[{"id":"743999785422127","name":"Research Engineer - Machine Learning (Reinforcement Learning)","uuid":"229d607a-333b-431b-9abe-78137730f5fd","refNumber":"REF2881V","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-11-08T09:56:17.000Z","location":{"city":"Warszawa, Kraków, Poznań, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572821","label":"IT - Machine Learning"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"606235fe248e6f5bea0815ed","fieldLabel":"Katowice","valueId":"185eb5a9-b884-4ee8-8ebc-0e5f3e852b27","valueLabel":"Tak"},{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"606235bcefbac7156d6a470a","fieldLabel":"Łódź","valueId":"7d33e23d-3fa7-4d7d-86ae-7d7caff54fa9","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"6165609ee6b46b6506c66b63","fieldLabel":"Gdańsk","valueId":"cde0f8e7-5c9d-4d78-9f5c-e1c17ee499a8","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"(Archive) IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15788e4b0614667d59733","fieldLabel":"Błonie","valueId":"25f6cb8c-81b3-434a-93ec-6dc851d5808d","valueLabel":"Nie"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"64818201-cdba-422e-8e8c-8ec633b0d327","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572821","valueLabel":"IT - Machine Learning"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"61656102a169ed164d546c31","fieldLabel":"Lublin","valueId":"02d54f00-48b9-4669-b7b3-10c16ac4bada","valueLabel":"Tak"},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"ML, Machine Learning, Python, Deep Learning, AI, Artificial Intelligence"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999785422127","creator":{"name":"Maciej Matwiejczyk"},"language":{"code":"en","label":"English","labelNative":"English (US)"}},{"id":"743999785421861","name":"Research Engineer - Machine Learning (Ranking and Recommendations)","uuid":"a6b2b59e-28e3-4bfa-89ab-b13ab97f06c8","refNumber":"REF2990T","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-11-08T09:54:52.000Z","location":{"city":"Warszawa, Poznań, Kraków, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572821","label":"IT - Machine Learning"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"60cb31a9c87e511299a3a050","fieldLabel":"Department II","valueId":"b8a4596e-d9ce-42bb-8de5-10995e9ccf99","valueLabel":"IT - Machine Learning"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"(Archive) IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15788e4b0614667d59733","fieldLabel":"Błonie","valueId":"25f6cb8c-81b3-434a-93ec-6dc851d5808d","valueLabel":"Nie"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"64818201-cdba-422e-8e8c-8ec633b0d327","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572821","valueLabel":"IT - Machine Learning"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"ML, AI, Ranking, Research, Machine Learning"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999785421861","creator":{"name":"Maciej Matwiejczyk"},"language":{"code":"en","label":"English","labelNative":"English (US)"}},{"id":"743999779485268","name":"Chief Architect","uuid":"5ea8adaa-e9ae-4cb2-a1dc-b27600247ffb","refNumber":"REF2835R","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-10-14T13:53:22.000Z","location":{"city":"Warszawa, Kraków, Poznań, Toruń, Gdańsk, Łódź, Katowice, Lublin","region":"Masovian Voivodeship","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572787","label":"IT - Technical Platform"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"(Archive) IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"64818201-cdba-422e-8e8c-8ec633b0d327","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572787","valueLabel":"IT - Technical Platform"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"chief architect, architekt, architect, platform, architektura"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999779485268","creator":{"name":"Angelika Szymkiewicz"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999779448775","name":"Research Engineer - Machine Learning (Reinforcement Learning)","uuid":"c8e577cc-c93a-43e7-8e73-e430989798d7","refNumber":"REF2881V","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-10-14T10:29:36.000Z","location":{"city":"Warszawa, Kraków, Poznań, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572821","label":"IT - Machine Learning"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"606235fe248e6f5bea0815ed","fieldLabel":"Katowice","valueId":"185eb5a9-b884-4ee8-8ebc-0e5f3e852b27","valueLabel":"Tak"},{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"606235bcefbac7156d6a470a","fieldLabel":"Łódź","valueId":"7d33e23d-3fa7-4d7d-86ae-7d7caff54fa9","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"6165609ee6b46b6506c66b63","fieldLabel":"Gdańsk","valueId":"cde0f8e7-5c9d-4d78-9f5c-e1c17ee499a8","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"(Archive) IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15788e4b0614667d59733","fieldLabel":"Błonie","valueId":"25f6cb8c-81b3-434a-93ec-6dc851d5808d","valueLabel":"Nie"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"64818201-cdba-422e-8e8c-8ec633b0d327","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572821","valueLabel":"IT - Machine Learning"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"61656102a169ed164d546c31","fieldLabel":"Lublin","valueId":"02d54f00-48b9-4669-b7b3-10c16ac4bada","valueLabel":"Tak"},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"ML, Machine Learning, Python, Deep Learning, AI, Artificial Intelligence"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999779448775","creator":{"name":"Maciej Matwiejczyk"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999779448676","name":"Research Engineer - Machine Learning (Ranking and Recommendations)","uuid":"7cb35dfc-f53c-4b51-81ac-61b683060f4c","refNumber":"REF2990T","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-10-14T10:29:00.000Z","location":{"city":"Warszawa, Poznań, Kraków, Toruń, Wrocław, Gdańsk, Katowice, Łódź, Lublin","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572821","label":"IT - Machine Learning"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"60cb31a9c87e511299a3a050","fieldLabel":"Department II","valueId":"b8a4596e-d9ce-42bb-8de5-10995e9ccf99","valueLabel":"IT - Machine Learning"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"(Archive) IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15788e4b0614667d59733","fieldLabel":"Błonie","valueId":"25f6cb8c-81b3-434a-93ec-6dc851d5808d","valueLabel":"Nie"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"64818201-cdba-422e-8e8c-8ec633b0d327","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572821","valueLabel":"IT - Machine Learning"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"ML, AI, Ranking, Research, Machine Learning"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999779448676","creator":{"name":"Maciej Matwiejczyk"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}}],"events":[{"created":1638356820000,"duration":7200000,"id":"282421464","name":"Allegro Tech Labs #9 Online: System design workshop","date_in_series_pattern":false,"status":"past","time":1639501200000,"local_date":"2021-12-14","local_time":"18:00","updated":1639514166000,"utc_offset":3600000,"waitlist_count":0,"yes_rsvp_count":62,"venue":{"id":26906060,"name":"Online event","repinned":false,"country":"","localized_country_name":""},"is_online_event":true,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/282421464/","description":"❗NA WYDARZENIE OBOWIĄZUJE REJESTRACJA: Liczba miejsc jest organiczona: https://app.evenea.pl/event/allegro-tech-labs-9/ ❗ To już druga edycja naszych warsztatów System Design Workshop! Czy chcesz poznać tajniki tworzenia systemów?…","how_to_find_us":"https://app.evenea.pl/event/allegro-tech-labs-9/","visibility":"public","member_pay_fee":false},{"created":1635344914000,"duration":7200000,"id":"281692274","name":"Allegro Tech Live #23 - Przygody backendowców w C#","date_in_series_pattern":false,"status":"past","time":1636045200000,"local_date":"2021-11-04","local_time":"18:00","updated":1636056125000,"utc_offset":3600000,"waitlist_count":0,"yes_rsvp_count":29,"is_online_event":false,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/281692274/","description":"------ Rejestracja: https://app.evenea.pl/event/allegro-tech-live-23/------- Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Kiedyś spotykaliśmy się w naszych biurach, a teraz…","visibility":"public","member_pay_fee":false},{"created":1634290537000,"duration":5400000,"id":"281441586","name":"Allegro Tech Live #22 - Jak wygląda codzienność lidera w Allegro?","date_in_series_pattern":false,"status":"past","time":1634832000000,"local_date":"2021-10-21","local_time":"18:00","updated":1634841007000,"utc_offset":7200000,"waitlist_count":0,"yes_rsvp_count":67,"venue":{"id":26906060,"name":"Online event","repinned":false,"country":"","localized_country_name":""},"is_online_event":true,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/281441586/","description":"!!!! Rejestracja: https://app.evenea.pl/event/allegro-tech-live-22/ !!!! Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale…","visibility":"public","member_pay_fee":false},{"created":1633336352000,"duration":7200000,"id":"281199452","name":"Allegro Tech Live #21 - Jak zautomatyzować bezpieczeństwo IT?","date_in_series_pattern":false,"status":"past","time":1633622400000,"local_date":"2021-10-07","local_time":"18:00","updated":1633634017000,"utc_offset":7200000,"waitlist_count":0,"yes_rsvp_count":48,"is_online_event":false,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/281199452/","description":"Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to my…","visibility":"public","member_pay_fee":false}],"podcasts":[{"creator":{"name":["Piotr Betkier"]},"title":"Rola architekta w Allegro","link":"https://podcast.allegro.tech/rola_architekta_w_allegro","pubDate":"Wed, 16 Jun 2021 00:00:00 GMT","author":{"name":["Piotr Betkier"]},"enclosure":{"url":"https://www.buzzsprout.com/887914/8712218.mp3","type":"audio/mpeg"},"content":"Od kodowania do tworzenia strategii technicznej... Jak wygląda rola architekta w Allegro? Ile takich osób pracuje w naszej firmie i dlaczego ta rola jest tak różnorodna? Czym jest Andamio i jak rozwijamy naszą platformę – o tym wszystkim opowie Piotr Betkier – Inżynier, Architekt Platformy Technicznej w Allegro oraz twórca piosenek o IT :)","contentSnippet":"Od kodowania do tworzenia strategii technicznej... Jak wygląda rola architekta w Allegro? Ile takich osób pracuje w naszej firmie i dlaczego ta rola jest tak różnorodna? Czym jest Andamio i jak rozwijamy naszą platformę – o tym wszystkim opowie Piotr Betkier – Inżynier, Architekt Platformy Technicznej w Allegro oraz twórca piosenek o IT :)","guid":"https://podcast.allegro.tech/rola_architekta_w_allegro","isoDate":"2021-06-16T00:00:00.000Z","itunes":{"author":"Piotr Betkier","summary":"Od kodowania do tworzenia strategii technicznej... Jak wygląda rola architekta w Allegro? Ile takich osób pracuje w naszej firmie i dlaczego ta rola jest tak różnorodna? Czym jest Andamio i jak rozwijamy naszą platformę – o tym wszystkim opowie Piotr Betkier – Inżynier, Architekt Platformy Technicznej w Allegro oraz twórca piosenek o IT :)","explicit":"false"}},{"creator":{"name":["Piotr Michoński"]},"title":"Infrastruktura Allegro","link":"https://podcast.allegro.tech/infrastruktura_Allegro","pubDate":"Tue, 01 Jun 2021 00:00:00 GMT","author":{"name":["Piotr Michoński"]},"enclosure":{"url":"https://www.buzzsprout.com/887914/8623783-sezon-ii-11-infrastruktura-allegro-piotr-michonski.mp3","type":"audio/mpeg"},"content":"Jak jest zbudowane środowisko uruchomienia aplikacji Allegro? Jak działają serwerownie firmy i ile ich potrzeba, a które elementy Allegro działają w chmurze publicznej? Jak przebiegała transformacja w Allegro i co zmieniało się przez lata? Jak wzrost biznesu wpływa na wielkość infrastruktury i jak infrastruktura Allegro odczuła przyjście pandemii? O tym, a także o rozwoju liderów technologii w Allegro oraz o historii powstania dżingla do naszych podcastów, opowie Piotr Michoński - menadżer Zespołów tworzących infrastrukturę Allegro.","contentSnippet":"Jak jest zbudowane środowisko uruchomienia aplikacji Allegro? Jak działają serwerownie firmy i ile ich potrzeba, a które elementy Allegro działają w chmurze publicznej? Jak przebiegała transformacja w Allegro i co zmieniało się przez lata? Jak wzrost biznesu wpływa na wielkość infrastruktury i jak infrastruktura Allegro odczuła przyjście pandemii? O tym, a także o rozwoju liderów technologii w Allegro oraz o historii powstania dżingla do naszych podcastów, opowie Piotr Michoński - menadżer Zespołów tworzących infrastrukturę Allegro.","guid":"https://podcast.allegro.tech/infrastruktura_Allegro","isoDate":"2021-06-01T00:00:00.000Z","itunes":{"author":"Piotr Michoński","summary":"Jak jest zbudowane środowisko uruchomienia aplikacji Allegro? Jak działają serwerownie firmy i ile ich potrzeba, a które elementy Allegro działają w chmurze publicznej? Jak przebiegała transformacja w Allegro i co zmieniało się przez lata? Jak wzrost biznesu wpływa na wielkość infrastruktury i jak infrastruktura Allegro odczuła przyjście pandemii? O tym, a także o rozwoju liderów technologii w Allegro oraz o historii powstania dżingla do naszych podcastów, opowie Piotr Michoński - menadżer Zespołów tworzących infrastrukturę Allegro.","explicit":"false"}},{"creator":{"name":["Dariusz Eliasz"]},"title":"Praca architekta ekosystemu big data w Allegro","link":"https://podcast.allegro.tech/praca_architekta_ekosystemu_big_data_w_Allegro","pubDate":"Thu, 20 May 2021 00:00:00 GMT","author":{"name":["Dariusz Eliasz"]},"enclosure":{"url":"https://www.buzzsprout.com/887914/8554742-sezon-ii-10-przetwarzanie-danych-w-allegro-dariusz-eliasz.mp3","type":"audio/mpeg"},"content":"Jak wygląda praca architekta ekosystemu big data w Allegro? Jakie zadania realizuje nasz zespół odpowiedzialny za narzędzia i infrastrukturę dla przetwarzania danych? Kiedy możemy mówić o dużych danych i ile petabajtów przetwarza Allegro? Skąd pochodzą dane Allegro i dlaczego jest ich tak dużo oraz z jakiego powodu dopiero teraz przenosimy się do chmury? O tym wszystkim opowie zdobywca statuetki Allegro Tech Hero - Dariusz Eliasz – Team Manager \u0026 Platform Architect w Allegro.","contentSnippet":"Jak wygląda praca architekta ekosystemu big data w Allegro? Jakie zadania realizuje nasz zespół odpowiedzialny za narzędzia i infrastrukturę dla przetwarzania danych? Kiedy możemy mówić o dużych danych i ile petabajtów przetwarza Allegro? Skąd pochodzą dane Allegro i dlaczego jest ich tak dużo oraz z jakiego powodu dopiero teraz przenosimy się do chmury? O tym wszystkim opowie zdobywca statuetki Allegro Tech Hero - Dariusz Eliasz – Team Manager \u0026 Platform Architect w Allegro.","guid":"https://podcast.allegro.tech/praca_architekta_ekosystemu_big_data_w_Allegro","isoDate":"2021-05-20T00:00:00.000Z","itunes":{"author":"Dariusz Eliasz","summary":"Jak wygląda praca architekta ekosystemu big data w Allegro? Jakie zadania realizuje nasz zespół odpowiedzialny za narzędzia i infrastrukturę dla przetwarzania danych? Kiedy możemy mówić o dużych danych i ile petabajtów przetwarza Allegro? Skąd pochodzą dane Allegro i dlaczego jest ich tak dużo oraz z jakiego powodu dopiero teraz przenosimy się do chmury? O tym wszystkim opowie zdobywca statuetki Allegro Tech Hero - Dariusz Eliasz – Team Manager \u0026 Platform Architect w Allegro.","explicit":"false"}},{"creator":{"name":["Bartosz Gałek"]},"title":"Od inżyniera do lidera w Allegro","link":"https://podcast.allegro.tech/od_inzyniera_do_lidera_w_allegro","pubDate":"Thu, 06 May 2021 00:00:00 GMT","author":{"name":["Bartosz Gałek"]},"enclosure":{"url":"https://www.buzzsprout.com/887914/8455586-sezon-ii-9-od-inzyniera-do-lidera-w-allegro-bartosz-galek.mp3","type":"audio/mpeg"},"content":"Czym jest Opbox i jakie wyzwania przed nim stoją? Jak w Allegro angażujemy się w rozwój kultury Open Source? Ile mamy projektów na GitHubie i jak świętujemy Hacktoberfest? W jaki sposób można rozwinąć się od inżyniera do lidera? Na te pytania w najnowszym Allegro Tech Podcast odpowie Bartek Gałek, Team Leader w Allegro.","contentSnippet":"Czym jest Opbox i jakie wyzwania przed nim stoją? Jak w Allegro angażujemy się w rozwój kultury Open Source? Ile mamy projektów na GitHubie i jak świętujemy Hacktoberfest? W jaki sposób można rozwinąć się od inżyniera do lidera? Na te pytania w najnowszym Allegro Tech Podcast odpowie Bartek Gałek, Team Leader w Allegro.","guid":"https://podcast.allegro.tech/od_inzyniera_do_lidera_w_allegro","isoDate":"2021-05-06T00:00:00.000Z","itunes":{"author":"Bartosz Gałek","summary":"Czym jest Opbox i jakie wyzwania przed nim stoją? Jak w Allegro angażujemy się w rozwój kultury Open Source? Ile mamy projektów na GitHubie i jak świętujemy Hacktoberfest? W jaki sposób można rozwinąć się od inżyniera do lidera? Na te pytania w najnowszym Allegro Tech Podcast odpowie Bartek Gałek, Team Leader w Allegro.","explicit":"false"}}]},"__N_SSG":true},"page":"/","query":{},"buildId":"k1XFheZIDivoZwZGeY7HS","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>